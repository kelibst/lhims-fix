<title>LHIMS : Searched Patient Result</title>

<link rel='shortcut icon' href='images/lhims_favicon.ico' type='image/x-icon' >

<script src="js/jquery-1.9.0.js"></script>
<script src="js/jquery-ui-1.10.0.custom.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/common.js?ver=1.6"></script>
<script type="text/javascript" src="js/bootstrap-timepicker.min.js"></script>
<script type="text/javascript" src="js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="lib/ckeditor/ckeditor.js"></script>
<script type="text/javascript" src="assets/select2/dist/js/select2.min.js"></script>
<script type="text/javascript" src="assets/moment/moment.js"></script>
<script type="text/javascript" src="js/jquery.annotate.js"></script>
<script type="text/javascript" src="js/jquery.mortuaryImageMark.js"></script>
<script type="text/javascript" language="javascript" src="js/bootstrap-toggle.min.js"></script>
<script src='js/pnotify.custom.js'></script>


<!-- Added for HelperBuilder -->
<script type="text/javascript" src="js/bootstrap-timepicker.min.js"></script>
<script src="cms/ckeditor/ckeditor.js"></script>
<script type="text/javascript" src="assets/bootstrap-timepicker/js/bootstrap-timepicker.js"></script>
<script type="text/javascript" src="js/moment.js"></script>
<script type ="text/javascript" src="js/bootstrap-datetimepicker.js"></script>
<script type="text/javascript" language="javascript" src="assets/gasparesganga-jquery-loading-overlay/dist/loadingoverlay.min.js"></script>
<!-- above files for HelperBuilder -->
<!-- Load d3.js and c3.js -->
<script src="assets/d3/d3.min.js" charset="utf-8"></script>
<script src="assets/c3/c3.min.js"></script>
<script src="assets/jquery-typeahead/dist/jquery.typeahead.min.js"></script>

	<link rel='stylesheet' href='assets/fullcalendar/dist/fullcalendar.min.css' />
	<script type="text/javascript" src='assets/fullcalendar/dist/fullcalendar.min.js'></script>
	
	<script type="text/javascript" src='ipdVital.js'></script>
	<script src='js/pnotify.custom.js'></script>

<link rel="stylesheet" href="css/jquery-ui-1.10.0.custom.min.css" />
<link type='text/css'  rel='stylesheet' href='css/bootstrap.min.css'/>
<link rel="stylesheet" href='css/bootstrap-combined.min.css' />
<link rel="stylesheet" href="css/bootstrap-responsive.css" />
<link rel="stylesheet" href='css/style_art.css' />
<link rel='stylesheet' media='print' type='text/css' href='css/style_print.css' />
<link rel="stylesheet" type="text/css" href="css/jquery-ui.min.css">
<link rel="stylesheet" href="css/font-awesome.min.css">
<link rel="stylesheet" href="css/jquery.dataTables.min.css">
<link rel="stylesheet" href="css/timeline.css">
<link rel="stylesheet" href="assets/select2/dist/css/select2.min.css">
<link rel="stylesheet" href='css/style.css' />
<link rel="stylesheet" href='css/annotation.css' />
<link rel="stylesheet" type="text/css" href="css/bootstrap-timepicker.min.css">
<link rel="stylesheet" href='css/mortuaryImageMark.css' />
<link rel="stylesheet" type="text/css" href="css/bootstrap-toggle.min.css">
<link href="assets/noty/lib/noty.css" rel="stylesheet">
<link rel="stylesheet" href="css/pnotify.custom.css">

<!-- Added for HelperBuilder -->
<link rel="stylesheet" type="text/css" href="css/bootstrap-timepicker.min.css">		
<link rel="stylesheet" type="text/css" href="css/bootstrap-timepicker.min.css"><!-- removed after confermation -->
<link rel="stylesheet" type="text/css" href="css/bootstrap-datetimepicker.css"><!-- removed after confermation -->
<!-- above files for HelperBuilder -->

<!-- Load c3.css -->
<link href="assets/c3/c3.css" rel="stylesheet">
<link rel="stylesheet" href="css/pnotify.custom.css">
	<!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
	<link rel="stylesheet" href="css/jquery.fileupload.css">
	<!-- <link rel="stylesheet" href="css/jquery.fileupload-ui.css"> -->
	<!-- CSS adjustments for browsers with JavaScript disabled -->
	<noscript><link rel="stylesheet" href="css/jquery.fileupload-noscript.css"></noscript>
	<!-- <noscript><link rel="stylesheet" href="css/jquery.fileupload-ui-noscript.css"></noscript> -->
<link rel='stylesheet' href='assets/jquery-typeahead/dist/jquery.typeahead.min.css' />

<script type="text/javascript">
	const sFluidMonitoringUnit = "ml";
	const iIsChangePasswordRequired = 0;
	const iNumberOfDaysAfterChangePasswordIsRequired = "0";
	(function(){
		if($ && $.ajaxSetup){
			$.ajaxSetup({
				data: { '_isAjax': true },
				statusCode: {
					401: function(){
						window.location.href = 'http://10.10.16.50/lhims_182/login.php';
					}
				}
			});
		}
	})()
</script>
<script type="text/javascript" src='js/itemBillRenderer.js'></script>
<script type="text/javascript" src='js/bedOperations.js'></script>
<script type="text/javascript" src='js/app.js?ver=1.3'></script>
<script type="text/javascript" src='js/ipdNEWSScaleAudit.js'></script>
<script type="text/javascript" src='js/strikeOutNotes.js'></script>
<script type="text/javascript" src='js/walletPayment.js'></script>
<script type="text/javascript" src='js/fluidMonitoring.js'></script><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<script type="text/javascript">
			$("[data-toggle='tooltip']").tooltip({
        		placement : 'top'
      		});
      
      		$(document).ready(function(){
        		$(".classPatientDetailsView").click(function(){
          			//$("#idLoadingModal").modal('show');
        		});

        		$(".classPatientNoAccess").click(function(){
          			alert("You don't have access to this patient");
        		});
      		});
		</script>
	</head>
	<body>
		<div class='classMainContainer' id='idMainContainer'>
			<div class='classHeader'  id='idHeader' > 
          		<div class='classDivStyle classPageHeader'  id='header' > 
	<div>
	<div class='classDivStyle classPageHeaderInfoBox'  id='company'>
		<img alt='Logo' id='logomc' src='images/moh-logo-2.png' />
	</div>
	<div class='classDivStyle classPageHeaderApplicationTitle'  id='banner' > </div>
	<div class='classDivStyle classPageHeaderApplicationVersion'  id='version' > </div>
	<img alt='Logo' id='logo' src='images/Logo_LW1.JPG' />
	<img alt='Logo' id='logo' src='images/org_logo.jpg' />
	</div>
</div>  
<div>
	</div>
<script type="text/javascript">
	$(document).ready(function(){
		$( "#idMiddleColumn .classBreadcrumb_ipd li:last-child" ).addClass( "IPDCurrent" );
	});	
</script>
<script>
	var time_in_minutes = 300;
</script>
<script src='js/sessionLogOut.js?ver=1.2'></script>
		<script type="text/javascript">
			sessionStorage.setItem('sessToken', 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE3NjI2Njc3MTcsImp0aSI6IjVCcVl0bjVHRXZvaHZZcDRZNGVxbW0iLCJleHAiOjE3NjI2ODU3Mjd9.0CTdwEuWihJ_6q046db2l2KBzAzW2moTOfSW2KLvBQA');
			function getAjaxAuthHeaders() {
				return {"Authorization": "Bearer "+sessionStorage.getItem('sessToken')}
			}
		</script>
		        	</div>

			<div class='classBodyContainer'  id='idBodyContainer' >
				<div class='classLeftColumn'  id='idLeftColumn' >
					<link rel="stylesheet" href="css/bootstrap-multiselect.css" type="text/css">
<script type="text/javascript" src="js/bootstrap-multiselect.js"></script>
<style type="text/css">
  ul.multiselect-container.dropdown-menu{max-height: 200px;overflow: auto;}
  div.classSearchPatientModal{width:70%;left:36%;overflow: hidden;}
  .classSelected{background-color: #d9edf7;}
  .redDot {width: 10px;  height: 10px;  background-color: red;  border-radius: 50%;display: inline-block;margin-right: 5px;vertical-align: middle;}
</style>
<div class='classDivStyle'  id='leftWidget' >
    <div class='classDivStyle'  id='head' >
        <table class='classTableFormat' >
            <tr class='classTableRow' >
                <td class='classTableData' ></td>
        <td valign="middle" id="headtitle" class="classTableData classDivStyle">
          Quick Links
        </td>
            </tr>
        </table>
    </div>
            <div class='classDivStyle'  id='ql' >
            <div class='classDivStyle bs-docs-sidebar'  id='leftWidgetContent' >
              <ul class="nav nav-list bs-docs-sidenav">                
                  <li><a  href='userDashboard.php' ><i class="icon-chevron-right"></i>Control Panel</a></li>

                                          <li><a  href='scheduleManager.php?iSchClinicID=2' ><i class="icon-chevron-right"></i> Appointment Calendar</a></li>
                        <li><a  style="display:none;" href='appointmentCalendar.php?iSchClinicID=2' ><i class="icon-chevron-right"></i>New Appointment Calendar</a></li>
                      
                                      <li><a  href='scheduleCalendarFilterSelection.php' title=""><i class="icon-chevron-right"></i>Filter Selection</a></li>
                                      
                                      <li><a  href='searchPatient.php' ><i class="icon-chevron-right"></i> Patient Record Management</a></li>
                  
                  
                                      <li><a  href='view_display_notification.php' style="display:none;"><i class="icon-chevron-right"></i> View Notifications<span class='classMessageIndicator'>&nbsp;</span></a></li>
                  
                  <li><a  href='viewMessageHistory.php' ><i class="icon-chevron-right"></i> View Messages <span class='badge badge-success' title='Unread Messages : 2' style='font-size:7px;'>2</span></a></li>

                                      <li><a  href='manageAlerts.php' ><i class="icon-chevron-right"></i> View Alerts<span class='classMessageIndicator'>&nbsp;</span></a></li>
                                    
                    
                    <li><a  href='labManagement.php' title="Lab Management"><i class="icon-chevron-right"></i>Lab Management</a></li>
                  
                                    <li><a  href='#' onclick=fShowAddAppointmentModal(); ><i class="icon-chevron-right"></i> Add New Appointment</a></li>
                  
                  
                  
                                                                              <li><a  href='actionPlanReport.php' onclick="" ><i class="icon-chevron-right"></i> View Action Plan</a></li>
                      
                                        <li><a  href='taskManager.php'><i class="icon-chevron-right"></i> View Tasks&nbsp;<img style='float:right; padding-top:3px; height:15px; width:15px; display: none;' src='images/GreenDot.png' class="classViewTaskIndicator" title="View Assigned (Pending) Tasks"/></a></li>
                    
                                        <li><a  href='manageCommunicationGroup.php' onclick="" ><i class="icon-chevron-right"></i> View Communication Group</a></li>
                                                                                <li><a  href='manageAdverseReaction.php' onclick="" ><i class="icon-chevron-right"></i> Manage Adverse Reaction</a></li>
                                                              <li><a  href='addPatient.php?iRedirectToRecord=1' ><i class="icon-chevron-right"></i> Add Patient</a></li>
                                          <li><a href='#idDoctorAvailModal' role="button" data-toggle="modal"><i class="icon-chevron-right"></i> View Doctor/Room Availability</a></li>
                                    
                
                                          <li><a  href='ipdMangement.php'><i class="icon-chevron-right"></i>IPD Management</a></li>
                                                                            <!-- Patient enquiry form -->
                                                                 
                  
                  
                                      <li><a href="javascript:void(0)" class="classViewDoctorStats" title="Doctor Stats"><i class="icon-chevron-right"></i>Doctor Stats</a></li>
                                                                              <li><a href='corporateClaim.php'><i class="icon-chevron-right"></i>Corporate Claim</a></li>
                                                           <li><a href="javascript:void(0)" class="classViewDepartmentStock" title="Check Drug Stock Level"><i class="icon-chevron-right"></i>Check Drug Stock Level</a></li>
                                                          <li class="classUnconfirmedCCCReportMainContainer"><a  href='unconfirmedCCCReport.php' title='Unconfirmed Claim Check Code(s)' style="display: inline-block;"><i class="icon-chevron-right"></i>Unconfirmed CCC<div class="redDot"></div></a></li>
                                      
                                                                                      </ul> 
              <br />
                                  &nbsp;&nbsp;
                    <input  class='btn btn-warning' type='button' name='send_message_p2p' id='send_message_p2p' value='Send Message' onclick="activateMessagePanel();"/>
                    

              
            </div>
        </div>

            <br />
  <div class='classDivStyle'  id='leftWidget' >
      <div class='classDivStyle'  id='head' >
          <table class='classTableFormat' >
              <tr class='classTableRow' >
                  <td class='classTableData' ></td>
          <td valign="middle" id="headtitle" class="classTableData classDivStyle"> 
            Days Alerts
          </td>
              </tr>
          </table>
      </div>

      <div class='classDivStyle classDivAlerts'  id='ql' >
          <div class='classDivStyle'  id='leftWidgetContent' >
            <marquee direction=up height='95px' onmouseover="this.stop();" onmouseout="this.start();" scrollamount="2">
                              </marquee>
          </div>
      </div>
  </div>

  <div class='classDivStyle'  id='leftWidget'>
      <div class='classDivStyle'  id='head' >
          <table class='classTableFormat' >
              <tr class='classTableRow' >
                  <td class='classTableData' ></td>
          <td valign="middle" id="headtitle" class="classTableData classDivStyle">
            Login Status
            </td>
              </tr>
          </table>
      </div>
      <div class='classDivStyle'  id='login' >
          <div class='classDivStyle'  id='leftWidgetContentLogin'   >
              <b> Login As:</b> Kekeli Jiresse Dogbevi        <br />
        <b> User Type:</b> Biostatistics Officer        <br />
               
        <b> Logout Timer: </b><a title='Session Timer. Click to reset session expiry!' id='idTimeLeftbar'></a>
        <br />
        <b>Since:</b> 09/11/2025  05:55        <br />
        <!-- <b>UserType:</b>         <br />
        <b>Centre:</b>         <br /> -->
                  <b>Clinic Name: </b>Volta Regional Hospital          <br />
                  
        <!--<a class='classButton classButtonLink' href='logout.php' id='logout'>Logout</a>-->
        <input  class='btn btn-primary' type='button' name='Logout' id='logout' value='Logout' onclick="window.location.href='ehrLogout.php';"/>
        <br />
      </div>
    </div>
  </div>
</div>

<!-- Send Message Modal-->
<div id="p2pMessagingSendPanel" class="modal hide" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="myModalForP2PMessagesLabel1" aria-hidden="true" title="Send Message" style="width: 1100px;margin-left: -530px;">
  <div>
    <div class="modal-header special-modal-header">
          <h3 id="myModalForP2PMessagesLabel1">Send Message</h3>
      </div>

      <div class="modal-body classModalLarge">
        <form id="sendP2PMessageForm" class="form-horizontal">
            <input type="hidden" name="idSenderUserTypeID" id="idSenderUserTypeID" value="11" />
            <input type="hidden" name="idSenderCPHUserID" id="idSenderCPHUserID" value="411" />
            <input type="hidden" name="idSenderClinicID" id="idSenderClinicID" value="2" />
            <input type="hidden" name="idSenderUserID" id="idSenderUserID" value="411" />
            <div class="control-group">
                <label class="control-label" for="inputP2PReceipientType">Recipient Type:</label>
                <div class="controls">
                    <select name="inputP2PReceipientType" id="inputP2PReceipientType" style="margin: 0 auto; width:100%;">
                        <option value="1">User</option>
                        <option value="2">User Type</option>
                        <option value="3">Sub User Type</option>
                        <option value="4">Pharmacy Department</option>
                    </select>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label" for="inputP2PReceipient">Recipient:</label>
                <div class="controls">
                    <select name="inputP2PReceipient[]" id="inputP2PReceipient" style="margin: 0 auto; width:100%;" multiple="multiple"></select>
                </div>
            </div>        
        
            <div class="control-group">
                <label class="control-label" for="inputP2PMessageToSend">Message:</label>
              <br />
                <div class="controls">
                    <textarea name="inputP2PMessageToSend" id="inputP2PMessageToSend" style="margin: 0 auto; width:100%;" rows="10" ></textarea>
                </div>
            </div>        
        </form>
      </div>

      <div class="modal-footer">
          <button class="btn btn-danger" id="btnCloseMessageBox" aria-hidden="true">Close</button>
          <button type="button" class="btn btn-primary" id="sendP2PMessage">Send</button>
      </div>
    </div>
</div>

<!-- MIS Modal -->
<div id="idMisDash" class="modal hide classDashboardModal" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="myModalForMisDashLabel" aria-hidden="true">
    <div class="modal-header special-modal-header">
        <!--<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>-->
        <h3 id="myModalForMisDashLabel">MIS</h3>
    </div>
    <div class="modal-body classModalSmall">
        <div class='classDashbaordModalDiv' align='center'>
                            <input  class='btn btn-warning classDashboardModalButton' type='button' id='idWorkSheetReport' onClick="window.location.href='dailyVisitReport.php';" value='Daily Visit Report' />
                
                                            <input  class='btn btn-warning classDashboardModalButton' type='button' id='idOPDBillReport' onClick="window.location.href='searchOPDBillReport.php';" value='OPD Bill Report' />
                        
                    

                    
                                            <input  class='btn btn-warning classDashboardModalButton classHidden' type='button' onClick="window.location.href='dailyCollectionReport.php';" value='Daily Collection report' />
                                                  

                    <input  class='btn btn-warning classDashboardModalButton ' type='button' onClick="window.location.href='clientOverviewReport.php';" value='Client Overview Report' />

                                            <input  class='btn btn-warning classDashboardModalButton classHidden' type='button' onClick="window.location.href='paymentBounceReport.php';" value='Payment Bounce Report' />
                                            
                    <input  class='btn btn-warning classDashboardModalButton classHidden' type='button' onClick="window.location.href='recallListReport.php';" value='Recall List Report' />

                                            <input  class='btn btn-warning classDashboardModalButton ' type='button' onClick="window.location.href='searchDoctorSignatureReport.php';" value='Doctor Signature Report' />
                                        
                        
                        <input  class='btn btn-warning classDashboardModalButton classHidden' type='button' onClick="window.location.href='labVerificationReport.php';" value='Lab Verification Report' />
                                            
                    <input  class='btn btn-warning classDashboardModalButton ' type='button' onClick="window.location.href='worksheetRegisterReport.php';" value='Worksheet Register Report' />
                                        <input  class='btn btn-warning classDashboardModalButton classHidden' type='button' onClick="window.location.href='worksheetRegisterReportWithoutParameter.php';" value='Worksheet Register Report' />
                    
                    <input  class='btn btn-warning classDashboardModalButton ' type='button' onClick="window.location.href='tat_mis_report.php';" value='TAT Report' />
                                        <input  class='btn btn-warning classDashboardModalButton classHidden' type='button' onClick="window.location.href='customer_tat_report.php';" value='TAT Report' />
                                        <input  class='btn btn-warning classDashboardModalButton ' type='button' onClick="window.location.href='paymentMISReport.php';" value='Payment Report' />
                    <input  class='btn btn-warning classDashboardModalButton classHidden' type='button' onClick="window.location.href='healthPackageMISReport.php';" value='Health Package MIS Report' />
                    <input  class='btn btn-warning classDashboardModalButton classHidden' type='button' onClick="window.location.href='inActivePatientMISReport.php';" value='In-Active Patient Report' />
                    <input  class='btn btn-warning classDashboardModalButton classHidden' type='button' onClick="window.location.href='patientAppointmentMISReport.php';" value='Patient Appointment Report' />
                    <input  class='btn btn-warning classDashboardModalButton classHidden' type='button' onClick="window.location.href='searchInsuranceDueStatementReport.php';" value='Insurance Due Statement Report' />
                    <input  class='btn btn-warning classDashboardModalButton ' type='button' onClick="window.location.href='patientDeathReport.php';" value='Patient Death Report' />
                                        <input  class='btn btn-warning classDashboardModalButton classHidden' type='button' onClick="window.location.href='crossed_tat_mis_report.php';" value='Crossed TAT Report' />
                    <input  class='btn btn-warning classDashboardModalButton classHidden' type='button' onClick="window.location.href='ConsolidatedCrossTatMisReport.php';" value='Consolidated Crossed TAT Report'/>
                                        <input  class='btn btn-warning classDashboardModalButton ' type='button' onClick="window.location.href='patientAdmissionScheduleDetailsMISReport.php';" value='Patient Consultation MIS Report' />
                    <input  class='btn btn-warning classDashboardModalButton ' type='button' onClick="window.location.href='unconfirmedPatientReport.php';" value='Unconfirmed Patient Report' />
                    <input  class='btn btn-warning classDashboardModalButton ' type='button' onClick="window.location.href='unconfirmedNHIAPatientBillListing.php';" value='Unconfirmed Patient Bill Report' />
                                                                            <input  class='btn btn-warning classDashboardModalButton' type='button' id='idDailyTransactionReport' onClick="window.location.href='searchDailyTransactionReport.php';" value='Daily Transaction Report' />
                    
                                    <input  class='btn btn-warning classDashboardModalButton' type='button' id='idPatientServiceReport' onClick="window.location.href='searchPatientServiceReport.php';" value='Patient Procedure Report' />
                
                                        <input  class='btn btn-warning classDashboardModalButton' type='button' id='idDoctorsMonthlyReport' onClick="window.location.href='searchDoctorMonthlyReport.php';" value='Doctor Amount Owned Report' />
                    
                                    <input class='btn btn-warning classDashboardModalButton' type='button' id=' idServiceReport' onClick="window.location.href='searchServiceReport.php';" value='Procedure Report' />
                
                <input class='btn btn-warning classDashboardModalButton classHidden' type='button' id='idNetLabMonthlyReport' onClick="window.location.href='searchNetLabMonthlyReport.php';" value='Network Lab Amount Owned Report' />

                                    <input class='btn btn-warning classDashboardModalButton' type='button' id='idCphOpsWorksheet' onClick="window.location.href='search_nd_appmt_by_date.php';" value='Network Doctor Appointments' />
                                                    <input class='btn btn-warning classDashboardModalButton' type='button' name='caseDashboard' id='idCaseDashboard' value='Case Dashboard'  onClick="window.location.href='caseDashboardSearch.php';" >
                
            <!-- Cancelled appointments report -->
                            <input  class='btn btn-warning classDashboardModalButton' type='button' id='idCancelledAppointmentRepirt' onClick="window.location.href='cancelledAppointments.php';" value='Cancelled Appointments' />
            
            <!-- Anniversary MIS -->
            
            <!-- Team Helper MIS -->
            
            
            <!-- Package Edit Log -->
            
            <!-- Package Edit Log -->
            
            <!-- Sales report -->
            
            <!-- Appointment MIS report -->
            
            <!-- Patient Referral MIS report -->
            

            <!-- DSR MIS report -->
            
            <!-- Service Register details MIS report -->
            
            <!-- Service Register details MIS report -->
            
            <!-- Monthly Clinic wise target report -->
            
            <!-- Monthly Super Service wise target report -->
            
            <!-- Consolidated Performance Super Service wise report -->
            
            <!-- Appointment andd Session MIS report -->
            
            <!-- Daily and weekly MIS report -->
                        <!-- THerapist report -->
            
            <!-- Monthly report -->
                            <!-- Existing Monthly report -->
                            <!-- New Patients report -->
                        <!-- Doctor review -->
            
            <!-- Other clinic patient appointments -->
            
            <!-- Patient going to other clinic -->
            
            <!-- Patient not showed up report -->
                        <!-- POS MIS -->
                        <!-- Therapist  Target report -->
                        <!-- Paymentwise Revenue report -->
                                <!-- Patient visit report -->
                        <!-- Patient Disease report -->
                        <!-- Patient Followup Visit report -->
                        <!-- Patient Referral report -->
                        <!-- schedule timing report -->
                            <input  class='btn btn-warning classDashboardModalButton' type='button' id='idPatientReferralList' onClick="window.location.href='ScheduleTimingReport.php';" value='Schedule Status Report' />                     
                          <input  class='btn btn-warning classDashboardModalButton ' type='button' onClick="window.location.href='inHouseLabParameterReport.php';" value='In House Lab Parameter Report' />

                              <input class='btn btn-warning classDashboardModalButton' type='button' name='serviceSiganature' id='idServiceSignature' value='Pending Procedures'  onClick="window.location.href='searchPendingStudies_new.php';" >
                              <input  class='btn btn-warning classDashboardModalButton ' type='button' onClick="window.location.href='opdOtherServiceBillReport.php';" value='OPD Other Procedure Bill Report' />
            <input  class='btn btn-warning classDashboardModalButton ' type='button' onClick="window.location.href='opdUsageBillReport.php';" value='Usage Bill Report' />
                            <input  class='btn btn-warning classDashboardModalButton ' type='button' onClick="window.location.href='bankReport.php';" value='Revenue Tracking Report' />
                                        <input  class='btn btn-warning classDashboardModalButton' type='button' id='idOPDStaffRegister' onClick="window.location.href='OPDStaffReport.php';" value='OPD Staff Register' />
                                     <input  class='btn btn-warning classDashboardModalButton' type='button' id='idOPDStaffRegister' onClick="window.location.href='IPDStaffReport.php';" value='IPD Staff Register' />  
            
                                <input  class='btn btn-warning classDashboardModalButton' type='button' id='idChannelReport' onClick="window.location.href='searchChannelReport.php';" value='Channel Report' />  
                                                        <input  class='btn btn-warning classDashboardModalButton' type='button' id='idBedTurnOverMISReport' onClick="window.location.href='bedTurnOverMISReport.php';" value='Bed Turn Over Report' title="Bed TurnOver MIS report" /> 
                                        <input  class='btn btn-warning classDashboardModalButton' type='button' id='idIPDBillReport' onClick="window.location.href='searchIPDBillReport.php';" value='IPD Bill Report' />
                                <input  class='btn btn-warning classDashboardModalButton' type='button' id='idPhysioTherapyDiagnosisReport' onClick="window.location.href='physiotherapyDiagnosisReport.php';" value='Physiotherapy Diagnosis Report' />
                              <input  class='btn btn-warning classDashboardModalButton' type='button' id='idHoldingWardStatusReport' onClick="window.location.href='holdingWardStatusReport.php';" value='Holding Ward Status' />
                                <input  class='btn btn-warning classDashboardModalButton' type='button' id='idRecoveringWardStatusReport' onClick="window.location.href='recoveringWardStatusReport.php';" value='Recovering Ward Status' />
                            <!-- Serach by ao classification number report -->
                                                    <input  class='btn btn-warning classDashboardModalButton' type='button' onClick="window.location.href='diagnosisReport.php';" value='Morbidity ICD-10 Report'/>
                                            <input  class='btn btn-warning classDashboardModalButton' type='button' id='idDSMDiagnosisReport' onClick="window.location.href='DSMDiagnosisReport.php';" value='DSM Diagnosis Report' />
                                          <input  class='btn btn-warning classDashboardModalButton' type='button' id='idStaffSummaryReport' onClick="window.location.href='staffSummaryReport.php';" value='Staff Summary Report' />
                            <!-- Patient HRA report -->
                    </div>
    </div>
    <div class="modal-footer classDashboardModalFooter">
        <button type="button" class="btn btn-danger btn-small" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>

<script type="text/javascript">
  var iStaffID = "411";
  var iUserTypeId = "11";
  var iEnableTaskManagement = "1";
  var iPatientRegistrationMandatoryDetails = "0";
  $(document).ready(function(){

    if(iEnableTaskManagement == 1){
        //! Fetching staff assigned tasks..
        fGetStaffTasks(iStaffID,iUserTypeId);
    }

    $("#btnCloseMessageBox").click(function(){     
      $('#p2pMessagingSendPanel').modal('hide');
    });

    $("#sendP2PMessage").click(function(){     
      var iRecipientType = $("#inputP2PReceipientType").val();
      var aReceiver = $("#inputP2PReceipient").val();
      var message = $("#inputP2PMessageToSend").val();
      var sender = 411;
      var sender_name = 'Kekeli Jiresse Dogbevi';
      var aReceiverName = [];
      var iMessageTypeFlag=0;
      $('#inputP2PReceipient :selected').each(function(i, selected){ 
          aReceiverName.push($(selected).text()); 
      });
      //var receiver_name = $("#inputP2PReceipient option[value='"+receiver+"']").text()

      if (message == "")
      {
        alert("Cannot send a blank Message");
        return false;
      }

      if (!aReceiver)
      {
        alert("Select sender");
        return false;
      }

      $.ajax({
          type: 'POST',
          url: 'mxcelMessagingAJAXhandler.php',
          data: {func:"1",sender:sender,sender_name:sender_name,receiver:aReceiver,message:message,receiver_name:aReceiverName,iMessageTypeFlag:iMessageTypeFlag,iRecipientType:iRecipientType},
          beforeSend: function(){
              $.LoadingOverlay("show");
          },
          success: function(data) {
              if ($.trim(data) != false) {
                  alert("Your message has been sent");
              } else {
                  alert("Something went wrong!");
              }

              $(document).find("#inputP2PMessageToSend").val("");
              $(document).find('#p2pMessagingSendPanel').modal('hide');
          },
          complete: function(){
              $.LoadingOverlay("hide");
          }
      });
    });

    //! To get select user name  for reported by..
    $("#inputP2PReceipient").select2({
        width: '100%',
        placeholder: 'Select User',
        allowClear: true,
        method: 'post',
        minimumInputLength: 3,
        width: 'resolve',
        ajax: {
            "url": "ajaxEhr.php?sFlag=searchUserByName",
            data: function (params) {
                return {
                   sUserName: params.term
                };
            },
            processResults: function (data, params) {
                var results = [];
                var iSenderUserID = $(document).find("#idSenderUserID").val();
                $.each(data, function(index, User) {
                    if (iSenderUserID != User.user_id) {
                        results.push({
                            id: User.user_id,
                            text: User.name,
                        });
                    }
                });
                return { results: results };
            }
        }
    });

            // $.ajax({
        //     url: "ajaxNHIAClaim.php?sFlag=getUnconfirmedClaimCheckCodeCount",
        //     data: {iClinicID:2, dFromDate:'', dToDate:''},
        //     beforeSend: function() {
        //         $(".classUnconfirmedCCCReportMainContainer").LoadingOverlay("show");
        //     },
        //     success: function (data){
        //         if (data > 0) {
        //             $(document).find(".classUnconfirmedCCCCountParentIndicator").attr('title', 'Unconfirmed NHIA Claim Check Code (Last 3 Months) : '+data);
        //             $(document).find(".classUnconfirmedCCCCountParentIndicator").html(data);
        //             $(document).find(".classUnconfirmedCCCCountParentIndicator").show();
        //         }
        //     },
        //     complete: function() {
        //         $(".classUnconfirmedCCCReportMainContainer").LoadingOverlay("hide");
        //     },
        // });
                    // $(document).find(".classUnconfirmedCCCCountParentIndicator").attr('title', 'Unconfirmed NHIA Claim Check Code (Last 3 Months) : '+);
            // $(document).find(".classUnconfirmedCCCCountParentIndicator").html();
            // $(document).find(".classUnconfirmedCCCCountParentIndicator").show();
             
    $(".classPublicHealthPatient").select2({                
        width: '150%',
        placeholder: 'Select Patient',
        minimumInputLength: 3,
        width: 'resolve',
        ajax: {
            url: "ajaxEhr.php?sFlag=SearchPatientByAllDetails",
            data: function (params) {
                return {
                    sKeyword: params.term                            
                };
            },
            processResults: function (data, params) {
                var results = [];
                $.each(data, function(index, Patient) {
                    results.push({
                        id: Patient.patient_id,
                        text: Patient.patient_name+" ["+Patient.patient_no+"]"
                    });
                });

                return { results: results };
            }
        }
    });
});
$(document).on('click', '#idBtnResetAskQuestion', function(){
    $("#idPublicHealthListingPatientID").empty();
    $('.classDisplayQuestionForPatient').css("display","none");
    $('.dataTables_paginate').hide();
    $('.dataTables_info').hide();
});
$(document).on('click', '#idCloseViewQuestionModal', function(){
    $("#idPublicHealthListingPatientID").empty();
    $('.classDisplayQuestionForPatient').css("display","none");
    $('.dataTables_paginate').hide();
    $('.dataTables_info').hide();

});
$(document).on('click','#idBtnSearchAskQuestion',function(){
    var iPatientIDForAskQuestion=$('.classPublicHealthPatient').val();
    console.log(iPatientIDForAskQuestion);
    if(iPatientIDForAskQuestion>0){
        $('.classDisplayQuestionForPatient').css("display","");
        window.idTablePharmacyAskQuestions = $('#idTablePharmacyAskQuestions').DataTable({
            "processing": true,
            "serverSide": true,
            "searching": false,
            "destroy": true,    
            "autoWidth": true,
            "ajax": {
                "type": "GET",
                "url": "ajaxPharmacyInterventions.php?sFlag=getPharmacyInterventionAskedQuestions",
                 "data": function(d) {
                            d.iPatientIDForAskQuestion = $('.classPublicHealthPatient').val();
                        },
            },
            "bLengthChange": false
        });
    }
});

    function activateMessagePanel(){
        $('#inputP2PReceipient').val('').trigger('change');
        $('#p2pMessagingSendPanel').modal('show');
    }

    function fShowAddAppointmentModal(){
        if (iPatientRegistrationMandatoryDetails == 1) {
            fetchingAllPatientOccupationList();
            fetchingAllPatientEducationList();
        }
        $('#idSerachPatientModal').modal('show'); 
    }

    //! Function for fetching staff assign tasks..
    function fGetStaffTasks(iStaffID,iUserTypeId){
        $.ajax({
            url : 'apiv2/tasks',
            headers: getAjaxAuthHeaders(),
            type : "get",
            data: {iStaffID: iStaffID,iLoggedInUserTypeID: iUserTypeId,bCompleted:false},
            success : function(data) {
              if($.trim(data) !== false) {
                  if(data.length > 0){
                      $(document).find('.classViewTaskIndicator').show();
                  }
              }
            }
        });
    }
        //! Function for fetching all occupation..
    function fetchingAllPatientOccupationList(){
        $.ajax({
            url: "ajaxEhr.php?sFlag=getAllPatientOccupations",
            success: function (data){
                $("#idSerachPatientModal").find("#idOccupation").empty();
                $("#idSerachPatientModal").find('#idOccupation').append($("<option></option>").attr("value",'').text('Select Any'));

                if (data.length > 0) {
                    $.each(data, function(iIndex, aOccupation) {
                        $("#idSerachPatientModal").find('#idOccupation').append($("<option></option>").attr("value",aOccupation.occupation_id).text(aOccupation.occupation));
                    });
                }
            }
        });
    }

    //! Function for fetching all education..
    function fetchingAllPatientEducationList(){
        $.ajax({
            url: "ajaxEhr.php?sFlag=getAllPatientEducations",
            success: function (data){
                $("#idSerachPatientModal").find("#idEducation").empty();
                $("#idSerachPatientModal").find('#idEducation').append($("<option></option>").attr("value",'').text('Select Any'));

                if (data.length > 0) {
                    $.each(data, function(iIndex, aEducation) {
                        $("#idSerachPatientModal").find('#idEducation').append($("<option></option>").attr("value",aEducation.education_id).text(aEducation.education));
                    });
                }
            }
        });
    }

// Color Code for selected item while adding payment.
  $(document).on('click', '.classCheckBillItemFullAmount', function(){
    var sThisID = this.id;
    var iISChecked = $("#"+sThisID).prop('checked');
    if(iISChecked == true){
      $("#"+sThisID).parents(':eq(1)').addClass("classSelected");
    }
    else{
      $("#"+sThisID).parents(':eq(1)').removeClass("classSelected");
    }
  });

</script>

<!-- Modal for doctor stats.. -->
<div id="idModalDoctorStats" class="modal hide" data-backdrop="static" data-keyboard="false" role="dialog" aria-labelledby="idModalDoctorStatsLabel" aria-hidden="true" style="width: 1100px;margin-left: -530px;">
    <div class="modal-header special-modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3 id="idModalDoctorStatsLabel">Doctor Stats</small></h3>
    </div>
    <div class="modal-body classModalLarge">
        <div class="row-fluid">
            <div class="span12">
                <div class="span3">
                	<label class="classLabel">From Date</label>
                </div>
                <div class="span3">
                	<label class="classLabel">To Date</label>
                </div>
                <div class="span3">
                	<label class="classLabel">Clinic</label>
                </div>
                <div class="span3">
                	<label class="classLabel">Doctor</label>
                </div>
            </div>
        </div>
        <div class="row-fluid">
            <div class="span12">
                <div class="span3">
                	<input type="text" class="classInputTextM classFromDate" name="idFromDate" id="idDoctorStatsFromDate" value="09-11-2025" readonly />
                </div>
                <div class="span3">
                	<input type="text" class="classInputTextM classToDate" name="idToDate" id="idDoctorStatsToDate" value="09-11-2025" readonly />
                </div>
                <div class="span3">
                	<select class="classSelectBox classClinic" name="idClinic" id="idDoctorStatsClinic"></select>
                </div>
                <div class="span3">
                	<select class="classSelectBox classDoctor" name="idDoctor" id="idDoctorStatsDoctor"></select>
                </div>
            </div>
        </div>
        <div class="row-fluid">
            <div class="span12">
                <a class="btn btn-small btn-success classBtnSearchDoctorStats pull-right" title="Search" name="idBtnSearchDoctorStats" id="BtnSearchDoctorStats" style="margin-right: 32px;"><i class="fa fa-search"></i>&nbsp;Search</a>
            </div>
        </div>
        <hr>
        <div class="row-fluid">
            <div class="span12">
                <table class='table table-condensed table-bordered classTableView' id='idTableDoctorStats'>
                	<thead>
                		<tr class='classTableHeader' id='idTableHeader'>
                            <td style='width:50%; text-align: center;'>Status</td>
                            <td style='width:25%; text-align: center;'>Total</td>
                            <td style='width:25%; text-align: center;'>Grand Total</td>
                        </tr>
                	</thead>
                	<tbody id="idTableBodyDoctorStats"></tbody>
                </table>
            </div>
        </div>
        <div class="row-fluid">
            <div class="span12">
                <span><strong>Note:</strong>&nbsp;&nbsp;Scheduled, Draft &amp; Finalized count will be reflected for individual doctor schedules only.</span>
            </div>
        </div>
    </div>
    <div class="modal-footer classModalFooter">        
        <button type="button" class="btn btn-small btn-danger" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>

<script type="text/javascript">
	$(document).ready(function(){
		$('.classFromDate, .classToDate').datepicker({
			changeMonth: true,
			dateFormat: 'dd-mm-yy',
			changeYear: true,
			showOn: "button",
	        buttonImage: "images/Calendar-icon.png",
	        buttonImageOnly: true,
	        maxDate: '0'
		});
	});
</script><script type="text/javascript">
	var iIsWellnewssPro = "0";
	var iUserTypeID = "11";
	var iLoggedInStaffID = "411";
	var iViewAllDoctorsStats = "1";
	$(document).ready(function(){
		//! for show modal backdrop...
	    $('.modal').on('shown.bs.modal', function() {
	        //Make sure the modal and backdrop are siblings (changes the DOM)
	        $(this).before($('.modal-backdrop'));
	        //Make sure the z-index is higher than the backdrop
	        $(this).css("z-index", parseInt($('.modal-backdrop').css('z-index')) + 1);
	    });

		$("#idModalDoctorStats").find("#idDoctorStatsClinic").select2();
		$("#idModalDoctorStats").find("#idDoctorStatsDoctor").select2();

		//! Fetching doctor list on change of clinic filter
		$(document).on('change', '#idDoctorStatsClinic', function(){
			var iClinicID = $(this).val();
			if(iClinicID > 0){
				//! Fetching all staffs..
				fetchingRequiredDoctorList(iIsWellnewssPro,iClinicID,iLoggedInStaffID);
			}else{
				$("#idModalDoctorStats").find("#idDoctorStatsDoctor").empty();
			}
		});

		//! Open doctor stats modal..
		$(document).on('click', '.classViewDoctorStats', function(){
			//! Append clinic list..
			fetchingRequiredClinicList(iIsWellnewssPro,iUserTypeID,iLoggedInStaffID);

			var iClinicID = $("#idModalDoctorStats").find("#idDoctorStatsClinic").val();
			if(iClinicID > 0){
				//! Fetching all staffs..
				fetchingRequiredDoctorList(iIsWellnewssPro,iClinicID,iLoggedInStaffID);	
			}

			$(document).find("#idModalDoctorStats").modal('show');

			// setTimeout(function(){ 
				//! Fetching doctor stats..
				var dScheduleFromDate = $(document).find("#idDoctorStatsFromDate").val();
				var dScheduleToDate = $(document).find("#idDoctorStatsToDate").val();
				var iClinicID = ($(document).find("#idDoctorStatsClinic").val() == null) ? '0' : $(document).find("#idDoctorStatsClinic").val();
				var iStaffID = ($(document).find("#idDoctorStatsDoctor").val() == null) ? '0' : $(document).find("#idDoctorStatsDoctor").val();

				if(iStaffID > 0){
					//! Fetching doctor stats..
					fetchDoctorStats(dScheduleFromDate,dScheduleToDate,iClinicID,iStaffID);				
				}else{
					$(document).find('#idTableBodyDoctorStats').html('<tr><td colspan="3" style="text-align:center;">No Data Found</td></tr>');
				}
			// }, 200);
		});


		//! Fetching doctor list on change of clinic filter
		$(document).on('click', '.classBtnSearchDoctorStats', function(){
			var dScheduleFromDate = $(document).find("#idDoctorStatsFromDate").val();
			var dScheduleToDate = $(document).find("#idDoctorStatsToDate").val();
			var iClinicID = ($(document).find("#idDoctorStatsClinic").val() == null) ? '0' : $(document).find("#idDoctorStatsClinic").val();
			var iStaffID = ($(document).find("#idDoctorStatsDoctor").val() == null) ? '0' : $(document).find("#idDoctorStatsDoctor").val();

			//! Validation..
			if(iStaffID == 0 || iStaffID == ''){
				alert('Please select doctor');
				return false;
			}

			//! Fetching doctor stats..
			fetchDoctorStats(dScheduleFromDate,dScheduleToDate,iClinicID,iStaffID);
		});
	});

	//! function for fetching all clinic list..
	function fetchingRequiredClinicList(iIsWellnewssPro,iUserTypeID,iLoggedInStaffID){
		$.ajax({
            type: 'POST',
            url: "ajaxScheduleCalendarFilterSelection.php",
            data: {sFlag:'fetchingRequiredClinicList',iIsWellnewssPro:iIsWellnewssPro,iUserTypeID:iUserTypeID,iLoggedInStaffID:iLoggedInStaffID},     
            success: function (data){
                if($.trim(data) != false){    
                	$("#idModalDoctorStats").find("#idDoctorStatsClinic").empty();                 
                    $.each(data, function(iIndex, aClinic){
                        if(aClinic.clinic_id > 0){
                            $("#idModalDoctorStats").find("#idDoctorStatsClinic").append($("<option></option>").attr("value",aClinic.clinic_id).text(aClinic.clinic_name));
                        }
                    });

                    $("#idModalDoctorStats").find("#idDoctorStatsClinic").trigger('change');
                }
            }
        });
	}

	//! function for fetching all clinic list..
	function fetchingRequiredDoctorList(iIsWellnewssPro,iClinicID,iLoggedInStaffID){
		$.ajax({
            type: 'POST',
            url: "ajaxScheduleCalendarFilterSelection.php",
            data: {sFlag:'fetchingRequiredDoctorList',iIsWellnewssPro:iIsWellnewssPro,iClinicID:iClinicID},
            success: function (data){
                if($.trim(data) != false){    
                	$("#idModalDoctorStats").find("#idDoctorStatsDoctor").empty();                 
                	$("#idModalDoctorStats").find("#idDoctorStatsDoctor").append($("<option></option>").attr("value",'').text('Select Any'));
                    $.each(data, function(iIndex, aDoctor){
                        if(aDoctor.staff_id > 0){
                        	if(iViewAllDoctorsStats == 1){
	                            $("#idModalDoctorStats").find("#idDoctorStatsDoctor").append($("<option></option>").attr("value",aDoctor.staff_id).text(aDoctor.staff_name));                        		
                        	}else{
                        		if(iLoggedInStaffID > 0 && iLoggedInStaffID == aDoctor.staff_id){
                        			$("#idModalDoctorStats").find("#idDoctorStatsDoctor").append($("<option selected></option>").attr("value",aDoctor.staff_id).text(aDoctor.staff_name));
                        		}
                        	}
                        }
                    });
                }
            }            
        });
	}

	//! function for fetching doctor stats..
	function fetchDoctorStats(dScheduleFromDate,dScheduleToDate,iClinicID,iStaffID){
		$.ajax({
            type: 'POST',
            url: "doctorStats.php",
            data: {dScheduleFromDate:dScheduleFromDate,dScheduleToDate:dScheduleToDate,iClinicID:iClinicID,iStaffID:iStaffID},
            beforeSend: function (){
                $.LoadingOverlay("show");
            },
            success: function (data){
                if($.trim(data) != ""){    
                	$(document).find('#idTableBodyDoctorStats').html(data);
                }else{
                	$(document).find('#idTableBodyDoctorStats').html('<tr><td colspan="3" style="text-align:center;">No Data Found</td></tr>');
                }
            },
            complete: function (){
                $.LoadingOverlay("hide");
            }
        });
	}
</script><style>
#idModalAddPharmacyIntervention table td,
#idModalAddPharmacyIntervention table th{
    font-size: 13px;
}
.cke_dialog
{
    z-index: 10055 !important;
}
</style>
<div id="idModalAddPharmacyIntervention" class="modal hide" data-backdrop="static" data-keyboard="false" role="dialog" aria-labelledby="idModalAddPharmacyInterventionLabel" aria-hidden="true" style="width: 1000px;margin-left: -530px;">
    <div class="modal-header special-modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3 id="idModalAddPharmacyInterventionLabel">Pharmacy Notes/Interventions</h3>
    </div>
    <div class="modal-body classModalLarge">
        <input type="hidden" id="pharmacy_intervention_entity_type" name="pharmacy_intervention_entity_type" value="" />
        <input type="hidden" id="pharmacy_intervention_entity_id" name="pharmacy_intervention_entity_id" value="" />
        <input type="hidden" id="pharmacy_intervention_patient_id" name="pharmacy_intervention_patient_id" value="" />
        <input type="hidden" id="idPatientAskQuestionID" name="idPatientAskQuestionID" value="" />
        <input type="hidden" name="pharmacy_intervention_user_id" id="pharmacy_intervention_user_id" value="411">
        <input type="hidden" id="idPatientAskQuestionID" name="idPatientAskQuestionID" value="" />
        <div>
            <ul id="pharmacyNoteTabContainer" class="nav nav-tabs">
                
                                
                            </ul>
            <div id="pharmacyNoteTabContent" class="tab-content">
                                
                                            </div>
        </div>
    </div>
    <div class="modal-footer classModalFooter">
        <button type="button" class="btn btn-danger" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>
<script>
    (function(){
        var pharmacyIntervantionCategories = [];
        var pharmacyCareIssueCategories = [];
        var pharmacyInterventionOutcomes = [];

        $('.addPharmacyMoreBtn').on('click', function(e){
            e.preventDefault();
            
            var $parent = $(this).closest('.addMoreParent'),
                $item = $parent.find('.addMoreItem').first().clone();

            $item.find('textarea,select').val('');
            
            $item.find('.removeMoreItem').show();

            $parent.find('.addMoreConainer')
                .append($item);
        });

        $(document).on('change', '[name="mxcel_pharmacy_category_issues_category_id"]', function(){
            var $this = $(this);

            if($this.find('option:selected').text() == "Other cause; specify"){
                $this.closest('.control-group').find('.classPharmacyInterventionCause').show();
            } else {
                $this.closest('.control-group').find('.classPharmacyInterventionCause').hide();
            }
        });

        $(document).on('change', '[name="mxcel_pharmacy_intervention_category_id"]', function(){
            var $this = $(this);

            if($this.find('option:selected').text() == "Other intervention (specify)"){
                $this.closest('.control-group').find('.classPharmacyInterventionIntervention').show();
            } else {
                $this.closest('.control-group').find('.classPharmacyInterventionIntervention').hide();
            }
        });

        var $firstLi = $('#pharmacyNoteTabContainer li').first(),
            $firstContent = $('#pharmacyNoteTabContent .tab-pane').first();

        if($firstLi){
            $firstLi.addClass('active');
        }

        if($firstContent){
            $firstContent.addClass('in active');
        }

        $.fn.modal.Constructor.prototype.enforceFocus = function () {
            var $modalElement = this.$element;
            $(document).on('focusin.modal', function (e) {
                var $parent = $(e.target.parentNode);
                if ($modalElement[0] !== e.target && !$modalElement.has(e.target).length
                    &&
                    !$parent.hasClass('cke_dialog_ui_input_select') && !$parent.hasClass('cke_dialog_ui_input_text')) {
                    $modalElement.focus()
                }
            })
        };

        function loadPharmacyInterventionCategories(selector){
            if(pharmacyIntervantionCategories.length){
                var optionData = pharmacyIntervantionCategories;

                var $selector = $(selector),
                    options = [];

                $.each(optionData, function(index, optionCurrent){
                    options.push("<option value='"+optionCurrent.id+"'>"+optionCurrent.name+"</option>")
                });

                $selector.html(options.join(""));
                $selector.trigger("change");
            } else {
                $.get("ajaxPharmacyInterventions.php?sFlag=getPharmacyInterventionCategories", function(data){
                    var optionData = data,
                        pharmacyIntervantionCategories = data;

                    var $selector = $(selector),
                        options = [];

                    $.each(optionData, function(index, optionCurrent){
                        options.push("<option value='"+optionCurrent.id+"'>"+optionCurrent.name+"</option>")
                    });

                    $selector.html(options.join(""));
                    $selector.trigger("change");
                });
            }
        }

        function loadPharmacyCareIssueCategories(selector){
            if(pharmacyCareIssueCategories.length){
                var optionData = pharmacyCareIssueCategories;

                var $selector = $(selector),
                    options = [];

                $.each(optionData, function(index, optionCurrent){
                    options.push("<option value='"+optionCurrent.id+"'>"+optionCurrent.name+"</option>")
                });

                $selector.html(options.join(""));
                $selector.trigger("change");
            } else {
                $.get("ajaxPharmacyInterventions.php?sFlag=getPharmacyCareIssueCategories", function(data){
                    var optionData = data;

                    var $selector = $(selector),
                        options = [];

                    $.each(optionData, function(index, optionCurrent){
                        options.push("<option value='"+optionCurrent.id+"'>"+optionCurrent.name+"</option>")
                    });

                    $selector.html(options.join(""));
                    $selector.trigger("change");
                });
            }
        }

        function loadPharmacyInterventionOutcomes(selector){
            if(pharmacyInterventionOutcomes.length){
                var optionData = pharmacyInterventionOutcomes;

                var $selector = $(selector),
                    options = [];

                $.each(optionData, function(index, optionCurrent){
                    options.push("<option value='"+optionCurrent.id+"'>"+optionCurrent.name+"</option>")
                });

                $selector.html(options.join(""));
                $selector.trigger("change");
            } else {
                $.get("ajaxPharmacyInterventions.php?sFlag=getPharmacyInterventionOutcomes", function(data){
                    var optionData = data;

                    var $selector = $(selector),
                        options = [];

                    $.each(optionData, function(index, optionCurrent){
                        options.push("<option value='"+optionCurrent.id+"'>"+optionCurrent.name+"</option>")
                    });

                    $selector.html(options.join(""));
                    $selector.trigger("change");
                });
            }
        }

        // Preload if button is there
        if($('[data-target="#idModalAddPharmacyIntervention"]').length){
            window.idTablePharmacyInterventionNotes = $('#idTablePharmacyInterventionNotes').DataTable({
                "processing": true,
                "serverSide": true,
                "searching": false,
                "autoWidth": true,
                "bDestroy": true,
                "ajax": {
                    "type": "GET",
                    "url": "ajaxPharmacyInterventions.php?sFlag=getPharmacistNotesForPatient",
                    "data": function(d) {
                        d.iPatientID = $('#pharmacy_intervention_patient_id').val();
                    }
                },
                "bLengthChange": false
            }).on('xhr.dt', function ( e, settings, json, xhr ) {
                $('[data-target="#idModalAddPharmacyIntervention"]').each(function(){
                    var $this = $(this);
                    var label = $this.data('label') ? $this.data('label') : "Pharmacy Notes";

                    if(json.recordsTotal > 0){
                        $this.text(label + " ("+json.recordsTotal+")");
                        $this.removeClass('btn-primary');
                        $this.addClass('btn-success');
                    } else {
                        var label = $this.data('label') ? $this.data('label') : "Pharmacy Notes";
                        $this.addClass('btn-primary');
                        $this.removeClass('btn-success');
                        $this.text(label);
                    }
                });
            });
        }
        

        $( "#idModalAddPharmacyIntervention" ).on('shown', function(){
            
            window.idTablePharmacyInterventions = $('#idTablePharmacyInterventions').DataTable({
                "processing": true,
                "serverSide": true,
                "searching": false,
                "autoWidth": true,
                "bDestroy": true,
                "ajax": {
                    "type": "GET",
                    "url": "ajaxPharmacyInterventions.php?sFlag=getPharmacyInterventionsForPatient",
                    "data": function(d) {
                        d.iPatientID = $('#pharmacy_intervention_patient_id').val();
                    }
                },   
                rowCallback: function (row, data) {
                    if ( data[11] == "" ) {
                        $(row).addClass('error');
                    }
                },
                "bLengthChange": false
            });

            window.idTablePharmacyInterventionNotes = $('#idTablePharmacyInterventionNotes').DataTable({
                "processing": true,
                "serverSide": true,
                "searching": false,
                "autoWidth": true,
                "bDestroy": true,
                "ajax": {
                    "type": "GET",
                    "url": "ajaxPharmacyInterventions.php?sFlag=getPharmacistNotesForPatient",
                    "data": function(d) {
                        d.iPatientID = $('#pharmacy_intervention_patient_id').val();
                    }
                },
                "bLengthChange": false
            }).on('xhr.dt', function ( e, settings, json, xhr ) {
                $('[data-target="#idModalAddPharmacyIntervention"]').each(function(){
                    var $this = $(this);
                    var label = $this.data('label') ? $this.data('label') : "Pharmacy Notes";

                    if(json.recordsTotal > 0){
                        $this.text(label + " ("+json.recordsTotal+")");
                        $this.removeClass('btn-primary');
                        $this.addClass('btn-success');
                    } else {
                        var label = $this.data('label') ? $this.data('label') : "Pharmacy Notes";
                        $this.addClass('btn-primary');
                        $this.removeClass('btn-success');
                        $this.text(label);
                    }
                });
            });

            window.idTablePharmacyQuestions = $('#idTablePharmacyQuestions').DataTable({
                "processing": true,
                "serverSide": true,
                "searching": false,
                "autoWidth": true,
                "bDestroy": true,
                "ajax": {
                    "type": "GET",
                    "url": "ajaxPharmacyInterventions.php?sFlag=getPharmacyInterventionAskedQuestions"
                },
                "bLengthChange": false
            });

            loadPharmacyInterventionCategories($(".classSelectPharmacyNoteIntervention").first());
            loadPharmacyCareIssueCategories($(".classSelectPharmacyCareIssueCategoryCategory").first());
            loadPharmacyInterventionOutcomes($(".classSelectPharmacyInterventionOutcome").first());
        });

        $('#idFormAddPharmacistNotesBtn').click(function(e) {
            e.preventDefault();
            for ( instance in CKEDITOR.instances ) {
                CKEDITOR.instances[instance].updateElement();
            }

            var sPharmacistNotes = $('#idPharmacistNotesArea').val();
            if (sPharmacistNotes =='') {
                alert('Pharmacist notes cant be empty.');
                return false;
            }

            $.ajax({
                type: 'POST',
                url: 'ajaxIPDManager.php?sFlag=addPharmacistNotes',
                data: {
                    idPharmacistNotes: sPharmacistNotes,
                    entity_type: $('#pharmacy_intervention_entity_type').val(),
                    entity_id: $('#pharmacy_intervention_entity_id').val(),
                    idPatientID: $('#pharmacy_intervention_patient_id').val(),
                    idUserID: $('#pharmacy_intervention_user_id').val()
                },
                success: function(data) {
                    if(data != false) {
                        alert('Pharmacist note has been added');

                        $('#idPharmacistNotesArea').val('');
                        CKEDITOR.instances.idPharmacistNotesArea.setData('');

                        window.idTablePharmacyInterventionNotes.draw();
                    } else {
                        alert('Error in adding Pharmacist notes.');
                    }
                }
            });
        });

        $('#idPharmacyInterventionsBtn').click(function(e) {
            e.preventDefault();

            var data = {
                entity_type: $('#pharmacy_intervention_entity_type').val(),
                entity_id: $('#pharmacy_intervention_entity_id').val(),
                iPatientID: $('#pharmacy_intervention_patient_id').val(),
                interventions: []
            };

            $('.classPharmacyInterventionForm .addMoreItem').each(function(index){
                var $this = $(this);
                console.log(index);
                data['interventions'][index] = {};
                $this.find('textarea, input, select').each(function(){
                    var $field = $(this);

                    data['interventions'][index][$field.attr("name")] = $field.val();
                });
            });

            $.ajax({
                type: 'POST',
                url: 'ajaxPharmacyInterventions.php?sFlag=addPharmacyInterventions',
                data: data,
                success: function(data) {
                    if(data != false) {
                        alert('Pharmacy Intervention has been added');

                        resetPharmacyInterventionForm();

                        window.idTablePharmacyInterventions.draw();
                    } else {
                        alert('Error in adding Pharmacy Interventions.');
                    }
                }
            });
        });


        $(document).on('click','.classRemovePharmacyInterventionBtn', function (){
            var $this = $(this),
                iID = $this.data('id');

            $.ajax({
                type: 'POST',
                url: 'ajaxPharmacyInterventions.php?sFlag=deletePharmacyInterventions',
                data: {iID: iID},
                success: function(data) {
                    if(data.sucess != false) {
                        alert('Pharmacy Intervention has been deleted');

                        window.idTablePharmacyInterventions.draw();
                    } else {
                        alert('Error in deleting Pharmacy Intervention.');
                    }
                }
            });
        });

        $(document).on('click', '.classReplyToThreadBtn', function (e){
            e.preventDefault();

            var $tr = $(this).closest('tr'),
                $replyContainer = $tr.find('.classReplyContainer'),
                sEntityType = $replyContainer.data('entity-type'),
                iEntityID = $replyContainer.data('entity-id'),
                iReply = $replyContainer.data('entity-id');

            loadReplies($replyContainer);            

            $tr.find('.classReplyForm').show();

            $tr.find('.classReplyForm textarea').focus();
        });

        $(document).on('click', '.classHideReplyForm', function(e){
            e.preventDefault();

            var $tr = $(this).closest('tr');

            $tr.find('.classReplyForm').hide();
        });

        $(document).on('click', '.classReplyToThread', function (e){
            e.preventDefault();

            var $tr = $(this).closest('tr'),
                $replyContainer = $tr.find('.classReplyContainer'),
                $replyThread = $replyContainer.find('.classReplyThreads').first();

            console.log($replyThread,$replyThread.is(':hidden'));
            if($replyThread.is(':hidden')){
                loadReplies($replyContainer);            

                $tr.find('.classReplyForm').show();
            } else {
                $replyThread.hide();
                $tr.find('.classReplyForm').hide();
            }
        });

        $(document).on('click', '.classReplyBtn', function(e){
            e.preventDefault();

            var $tr = $(this).closest('tr'),
                $replyContainer = $tr.find('.classReplyContainer'),
                sEntityType = $replyContainer.data('entity-type'),
                iEntityID = $replyContainer.data('entity-id'),
                $replyTextArea = $replyContainer.find('.replyTextarea').first(),
                iReply = $replyContainer.data('total-replies'),
                sReply = $replyTextArea.val();

            if(!sReply){
                alert("Please enter message");
                return false;
            }

            $.ajax({
                type: 'POST',
                url: 'ajaxPharmacyInterventions.php?sFlag=addReplyToEntityID',
                data: {
                    reply: sReply,
                    entity_type: sEntityType,
                    entity_id: iEntityID
                },
                success: function(data) {
                    if(data.success != false) {
                        alert('You have replied to the thread successfully.');

                        loadReplies($replyContainer, true);

                        $replyTextArea.val("");
                    } else {
                        alert('There was error repling to the thread.');
                    }
                }
            });
        });

        function loadReplies($replyContainer, hardReload){
            var sEntityType = $replyContainer.data('entity-type'),
                iEntityID = $replyContainer.data('entity-id'),
                iReply = $replyContainer.data('total-replies'),
                $replyTable = $replyContainer.find('.classReplyThreads table').first();

            if(iReply || hardReload){
                $replyContainer.find('.classReplyThreads').show();

                $.get('ajaxPharmacyInterventions.php?sFlag=getRepliesByEntityID', {
                    entity_type: sEntityType,
                    entity_id: iEntityID
                }, function (data){
                    var rows = $.map(data, function(reply){

                        return [
                            "<tr>",
                                "<td>",
                                    reply.reply,
                                "</td>",
                                "<td>",
                                    reply.added_by_user,
                                "</td>",
                                "<td>",
                                    reply.added_on,
                                "</td>",
                            "</tr>"
                        ].join("");
                    }).join("");

                    $replyTable.find('tbody').html(rows);
                });
            }
        }

        function resetPharmacyInterventionForm(){
            $('.classPharmacyInterventionForm .addMoreItem').each(function(index){
                var $this = $(this);

                if(index != 0){
                    $this.remove();
                } else {
                    $this.find('textarea, input, select').each(function(){
                        $(this).val('');
                    });
                }
            });
        }

        window.AddtoDischarge = function(id){ 
            $.ajax({
                type: 'POST',
                url: 'ajaxIPDManager.php?sFlag=addtoDischargeNotes',
                data: {id:id},
            
                success: function(data) {
                    console.log(data)
                    if(data != false) {
                        alert('Discharge Pharmacist Note has been added');

                        $('#sPharmacistMarkasDischarge').val('');

                        window.idTablePharmacyInterventionNotes.draw();
                    } else {
                        alert('Error in adding Discharge Pharmacist notes.');
                    }
                }
            });
        }
        
        $(document).on('click','#idPharmacyInterventionAskQuestion', function (){
            var sQuestion   = $('#idPharmacyInterventionAskQuestionInput').val();
            var sEntityType = $('#pharmacy_intervention_entity_type').val();
            var iEntityID   = $('#pharmacy_intervention_entity_id').val();
            var iPatientID  = $('#pharmacy_intervention_patient_id').val();
            var iOPDPatient  = $('#idPatientAskQuestionID').val();

            if(!sQuestion){
                alert("Please enter your question");
                return false;
            }

            $.ajax({
                type: 'POST',
                url: 'ajaxPharmacyInterventions.php?sFlag=addPharmacyInterventionAskedQuestion',
                data: {
                    question: sQuestion, sEntityType: sEntityType, iEntityID: iEntityID, iPatientID: iPatientID,iOPDPatient:iOPDPatient
                },
                success: function(data) {
                    if(data.sucess != false) {
                        alert('Your question has been asked.');

                        $('#idPharmacyInterventionAskQuestionInput').val('');

                        window.idTablePharmacyQuestions.draw();
                    } else {
                        alert('Error in asking your question.');
                    }
                }
            });
        });

        if($("#idPharmacistNotesArea").length){
            CKEDITOR.replace('idPharmacistNotesArea');
        }

        

        $(document).on('click', '.removeMoreItem', function(e){
            $(this).closest('.addMoreItem').remove();
        });
    })()
</script><style>
/*.modal-body{
	overflow-y: scroll;
	max-height: 600px;
}*/
</style>
<!-- modal for department stock report  --><!--BootStrap2 -->
<div id="idModalDepartmentReport" class="modal fade hiden" data-backdrop="static" data-keyboard="false" role="dialog" aria-labelledby="idModalDepartmentStock" aria-hidden="true" style="width: 1144px;margin-left: -565px; display:none; overflow-y: hidden;">
    <div class="modal-header special-modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3 id="idModalDepartmentStock">Check Drug Stock Level </small></h3>
    </div>
    <div class="modal-body classModalLarge" >
        <div class="row-fluid">
            <div class="span12">
                <div class="span3">
                    <label class="classLabel">Product</label>
                </div>
                <div class="span3">
                    <select class="classProductSearch form-control" id="idProductId"  multiple style="width: 575px;"></select>
                </div>
                <div class="span6" style="padding-left: 350px;">
                    <button class="btn btn-sm btn-primary classSearchReturnDrug" id="idSearchDepartmentStockModalB2" style="margin-top: 0px;" title="Search"><i class="fa fa-search"></i>&nbsp;&nbsp;Search</button>
                    <a class="btn btn-md btn-primary classDeptStockBtnExportToExcel " id="idDeptStockExportToExcel" style="margin-top: 0px;" title="Export To Excel"><i class="fa fa-download" aria-hidden="true"></i></a>
                </div>
            </div>
        </div>
         <div class="modal-body">
            <div class="row-fluid">
                <div class="span12">
                    <div class="panel-heading classReturnsDrugHeaderListing">
                    <i class="fa fa-list-alt"></i>&nbsp;&nbsp;Drug Stock Level 
                    </div>
                    <div class="panel-body">
                        <div class="classDepartmentStockContainer"> </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer classModalFooter">        
        <button type="button" class="btn btn-small btn-danger" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>

<script type="text/javascript">
	$(document).ready(function(){
		//! for show modal backdrop...
	    $('.modal').on('shown.bs.modal', function() {
	        //Make sure the modal and backdrop are siblings (changes the DOM)
	        $(this).before($('.modal-backdrop'));
	        //Make sure the z-index is higher than the backdrop
	        $(this).css("z-index", parseInt($('.modal-backdrop').css('z-index')) + 1);
	    });

		//! Open modal..
		$(document).on('click', '.classViewDepartmentStock', function(){

			$(document).find("#idModalDepartmentReport").modal('show');
       		
		});
        //!refiling drug detail
        $(document).on('click', '#idSearchDepartmentStockModalB2', function(){
            //! refilling patient drug details..
            var iProductId = ($('#idProductId').val() == null) ? '' : $('#idProductId').val();
            fGetAllDepartmentStocks(iProductId);
        });

        //!download a excel file
        $(document).on('click', '.classDeptStockBtnExportToExcel', function(){
            var aProductId = ($('#idProductId').val() == null) ? '' : $('#idProductId').val();

            window.location.href="exportDepartmentStockReportToExcel.php?iProductId="+aProductId;
        });
	});

	function fGetAllDepartmentStocks(iProductId){
        $.ajax({
            type: 'POST',
            url: "ajaxPharmacy.php?sFlag=getDepartmentStockDetails",
            data: {iProductId:iProductId},
            async: false,
            beforeSend: function (){
                        $.LoadingOverlay("show");
            },
            success: function (data){
                $.LoadingOverlay("hide");
                if($.trim(data) != false){
                    if (data.length > 0 ){
                    	var sTemplate = "";
                    	$.each(data, function(iIndex, aStock) {
                    		sTemplate += '<h4 style="font-weight:bold;">'+(aStock.deptname)+'</h4>';
                    		var aProducts = aStock.products;
                    		if (aProducts.length > 0) {
                    			sTemplate += '<table class="table table-bordered table-condensed table-responsive" style="border:1px solid;">';
	                    			sTemplate += '<thead>';
		                    			sTemplate += '<tr style="border:1px solid;">';
		                    				sTemplate += '<th style="border:1px solid;">Product Name</th>';
		                    				sTemplate += '<th style="border:1px solid;">Quantity</th>';
		                    			sTemplate += '</tr>';
	                    			sTemplate += '</thead>';
	                    			sTemplate += '<tbody>';
	                    			$.each(aProducts, function(iIndex, aProduct){
	                    				sTemplate += '<tr style="border:1px solid;">';
		                    				sTemplate += '<td style="border:1px solid;">'+(aProduct.drugname)+'</td>';
		                    				sTemplate += '<td style="border:1px solid;">'+(aProduct.quantity)+'</td>';
		                    			sTemplate += '</tr>';
	                    			});
	                    			sTemplate += '</tbody>';
                    			sTemplate += '</table>';
                    			sTemplate += '<hr>';
                    		}
                    	});
                    	$(document).find(".classDepartmentStockContainer").html(sTemplate);
                    } else {
                    	$(document).find(".classDepartmentStockContainer").html("<span class='badge badge-warning'>No Data Availabel</span>");
                    }
                }else{
                    $(document).find(".classDepartmentStockContainer").html("<span class='badge badge-warning'>No Data Availabel</span>");
                }
            }
        });
    }

	$(".classProductSearch").select2({
        placeholder: 'Search Drugs',
        width: '100%',
        minimumInputLength: 3,
        width: 'resolve',
        ajax: {
            url: "ajaxInventory.php?sFlag=getProductListByName",
            data: function (params) {
                return {
                    term: params.term        
                };
            },
            processResults: function (data, params) {
                var results = [];
                $.each(data, function(index, Medicine) {
                    results.push({
                        id: Medicine.id,
                        text: Medicine.value+" "+Medicine.label
                    });
                });

                return { results: results };
            }
        }
    });

</script>
<!-- showing bill item details-->
<div id="idModalBillItemDetails" class="modal fade" data-backdrop="static" data-keyboard="false" role="dialog" aria-labelledby="idModalDepartmentStock" aria-hidden="true" style="width: 1144px;margin-left: -565px; display:none; overflow-y: hidden;">
    <!-- Modal content-->
    <div class="modal-header special-modal-header">
        <h3 id="idModalBillItemDetailsLabel" style="text-align: center;">Print Item Bill</h3>
    </div>
    <div class="modal-body classModalLarge">
        <div class="row-fluid">
            <div class="span3">
                <label class="classLabel">From Date</label>
            </div>
            <div class="span3">
                <label class="classLabel">To Date</label>
            </div>
            <div class="span3">
                <label></label>
            </div>
        </div>
        <div class="row-fluid">
            <div class="span3">
                <input type="text" class="classInputText classBillItemPrintDate classBillItemPrintFromDate" name="idBillItemPrintFromDate" id="idBillItemPrintFromDate" data-provide="datepicker" autocomplete="off" readonly />
            </div>
            <div class="span3">
                <input type="text" class="classInputText classBillItemPrintDate classBillItemPrintToDate" name="idBillItemPrintToDate" id="idBillItemPrintToDate" data-provide="datepicker" autocomplete="off" readonly />
            </div>
            <div class="span3">
                <a class="btn btn-sm btn-primary classSearchBillItemPrintBillDetails" id="idSearchBillItemPrintBillDetails" name="idSearchBillItemPrintBillDetails"  data-entity-type-id="0" data-bill-id="0">Search</a>
            </div>
        </div>
        <div class="row-fluid">
            <table class='table table-bordered table-condensed table-responsive' id='idPrintItemBillTable'>
                <thead>
                    <tr class='classTableHeader'>
                        <th>Sr.No.</th>
                        <th>Item Date</th>                                          
                        <th>Item Name</th>
                        <th>Amount</th>
                        <th>Item Selection</th>
                    </tr>
                </thead>
                <tbody id="idPrintItemBillBody"></tbody>
            </table>
        </div>
    </div>
    <div class="modal-footer classModalFooter">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-success classGenerateItemBill" data-entity-type-id="0" data-bill-id="0" style="margin-top:0px;">Generate Bill</button>
    </div>
</div>


<!-- showing bill item details--> 
<div id="idModalBillItemHODDiscountsDetails" class="modal hide fade" data-backdrop="static" data-keyboard="false" role="dialog" aria-labelledby="idModalDepartmentStock" aria-hidden="true" style="width: 1144px;margin-left: -565px;display:none;overflow-y: scroll;height: 601px;">
    <!-- Modal content-->
    <div class="modal-header special-modal-header">
        <h3 id="idModalBillItemHODDiscountsDetailsLabel" style="text-align: center;">HOD Approval Discounts</h3>
    </div>
    <div class="modal-body classModalLarge">
        <div class="row-fluid">
            <table class='table table-bordered table-condensed table-responsive' id='idItemHODDiscountsBillTable'>
              <thead>
                  <tr class='classTableHeader'>
                      <th>Sr.No.</th>
                      <th>Item Date</th>                                          
                      <th>Item Name</th>
                      <th>Amount</th>
                      <th>Discount Amount</th>
                      <th>Total Amount</th>
                      <th>Full Discount</th>
                      <th>Remark</th>
                  </tr>
              </thead>
              <tbody id="idHODDiscountsItemBillBody"></tbody>
            </table>
        </div>
    </div>
    <hr>
    
    <!-- History of discount  -->
    <h3 id="idModalBillItemHODDiscountsHistoryDetailsLabel" style="text-align: center;">HOD Approval Discounts History</h3>
    <div class="modal-body classModalLarge">
        <div class="row-fluid">
            <table class='table table-bordered table-condensed table-responsive' id='idPrintItemHODDiscountsHistoryBillTable'>
              <thead>
                  <tr class='classTableHeader'>
                      <th>Sr.No.</th>
                      <th>Discount Date</th>                                          
                      <th>Item Name</th>
                      <th>Discount Amount</th>
                      <th>Original Amount</th>
                      <th>User</th>
                      <th>Remark</th>
                  </tr>
              </thead>
              <tbody id="idHODDiscountsHistoryItemBillBody"></tbody>
            </table>
        </div>
           
    </div>

    <div class="modal-footer classModalFooter">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>
</div>

<!-- showing ipd bed oxygen attached history-->
<div id="idModalShowIPDBedAttachedHistory" class="modal hide classModalPrivateVisit" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="myModalPrivateVisit" aria-hidden="true" style="width: 1100px;margin-left: -530px;">
    <div class="modal-header">
        <h3 id="myModalPrivateVisitHeading">Attached/Unattached Oxygen&nbsp;<span class="classCloseModalButton" data-dismiss="modal" title="Close Modal">&times;</span></h3>
    </div>
    <div class="modal-body">
        <div class="row-fluid">
            <div class="control-group">
                <div class="controls">
                        <div class="row-fluid">
                            <div class="span3" style=""><input type="checkbox" name="idCheckAttachedUnAttachedOxygenToIPDBed" id="idCheckAttachedUnAttachedOxygenToIPDBed" />&nbsp;<strong>Attached / UnAttached Oxygen</strong></div>
                            <div class="span3" style=""><input type="text" name="idAttachedUnAttachedOxygenDate" class="input-block-level classAttachedUnAttachedOxygenDate" id="idAttachedUnAttachedOxygenDate" readonly value="09-11-2025" /></div>
                            <div class="span3"><input type="text" name="idAttachedUnAttachedOxygenTime" class="input-block-level classAttachedUnAttachedOxygenTime" id="idAttachedUnAttachedOxygenTime" readonly value="05:55" /></div>
                        </div>
                </div>
          </div>
        </div>
        <div class="row-fluid">
            <textarea class="classAttachedUnAttachedOxygenRemark" id="idAttachedUnAttachedOxygenRemark" name="idAttachedUnAttachedOxygenRemark" rows="5" style="width: 100%;" placeholder="Enter remarks.."></textarea>
            <input type="hidden" id="idOxygenAttachedBedID" name="idOxygenAttachedBedID" value="0" />
            <input type="hidden" id="idPreviousAttachedStatusID" name="idPreviousAttachedStatusID" value="0" />
        </div>
        <br>
        <div class="row-fluid">
            <label class="classLabel">IPD Bed Oxygen Attached/Unattached History</label>
            <table class="table table-condensed table-bordered classTablePrivateVisitRequestedUsers" id="idTableIPDBedOxygenAttachedHistory" style="font-size:12px; width: 100%;">
                <thead>
                    <tr>
                        <th>Status</th>
                        <th>Remarks</th>
                        <th>Oxygen Attached/Unattached DateTime</th>
                        <th>Added By</th>
                        <th>Added On</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger btn-small" data-dismiss="modal" aria-hidden="true">Close</button>
        <button type="button" class="btn btn-success btn-small classSubmitAttachUnAttachOxygenToIPDBed" aria-hidden="true">Submit</button>
    </div>
</div>

<!-- Modal for shows the treatment sheet.. -->
<div id="idModalShowIPDObservationSheet" class="modal hide" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="idModalShowIPDObservationSheetLabel" aria-hidden="true" style="width: 1100px;margin-left: -530px;">
    <div class="modal-header special-modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3 id="idModalShowIPDObservationSheetLabel" style="text-align:center;">IPD - Observation Sheet</h3>
    </div>
    <div class="modal-body classModalLarge">
        <div class="row-fluid">
            <small><strong>Observation Date : </strong></small>
            <input type="text" class="classInputTextS classIPDObservationSheetDate" name="idIPDObservationSheetDate" id="idIPDObservationSheetDate" value="09-11-2025" readonly="" />
            <input type="hidden" name="idIPDObservationSheetAdmitID" id="idIPDObservationSheetAdmitID" value="0" />
            <input type="hidden" name="idIPDObservationSheetPatientID" id="idIPDObservationSheetPatientID" value="0" />
            <a class="btn btn-small btn-success classSearchIPDObservationSheet" id="idSearchIPDObservationSheet" name="idSearchIPDObservationSheet" title="Search Observation Sheet" style="margin-top: -10px;"><i class="fa fa-search"></i>&nbsp;Search</a>
        </div>
        <hr>
        <div class="row-fluid classObservationSheetMainContainer"></div>
    </div>
    <div class="modal-footer classModalFooter">
        <button type="button" class="btn btn-danger" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>

<!-- Modal for shows the key vitals graph..-->
<div id="idModalShowDynamicKeyVitalGraph" class="modal hide" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="idModalShowDynamicKeyVitalGraphLabel" aria-hidden="true" style="width: 1100px;margin-left: -530px;">
    <div class="modal-header special-modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3 id="idModalShowDynamicKeyVitalGraphLabel" style="text-align:center;">Key Vitals Graph</h3>
    </div>
    <div class="modal-body classModalLarge">
        <div class="row-fluid">
            <div id="idDynamicSyncVitalSearchTimeContainer" class="span12" style="margin-left: 15px;text-align: center;margin-bottom: 5px;"></div>
        </div>
        <div class="row-fluid">
            <div id="idDynamicSyncVitalChartContainer" class="span12" style="margin-left: 15px;"></div>
        </div>
    </div>
    <div class="modal-footer classModalFooter">
        <button type="button" class="btn btn-danger" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>

<!--Modal for shows-->
<div id="idModalShowIPDNewsAuditHistory" class="modal hide" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="idModalShowIPDNewsAuditHistoryLabel" aria-hidden="true" style="width: 1100px;margin-left: -530px;">
    <div class="modal-header special-modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3 id="idModalShowIPDNewsAuditHistoryLabel" style="text-align:center;">IPD NEWS Scale Audit</h3>
    </div>
    <div class="modal-body classModalLarge"></div>
    <div class="modal-footer classModalFooter">
        <button type="button" class="btn btn-danger" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>

<!-- showing bill item details-->
<div id="idModalMarkBillItemPayment" class="modal hide" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="idModalMarkBillItemPaymentLabel" aria-hidden="true" style="width: 1100px;margin-left: -530px;">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header special-modal-header">
                <h3 id="idModalMarkBillItemPaymentLabel" style="text-align: center;">Mark Bill Item Payment</h3>
            </div>
            <div class="modal-body classModalLarge">
                <div class="row-fluid">
                    <input type="hidden" id="idPaymentIndexID" value=""/>
                    <table class='table table-bordered table-condensed table-responsive' id='idMarkBillItemPaymentTable'>
                        <thead>
                            <tr class='classTableHeader'>
                                <th>Sr.No.</th>
                                <th>Item Date</th>
                                <th>Item Name</th>
                                <th>Item Amount</th>
                                <th style="display: none;">Collected Amount</th>
                                <th>Collect Full Amount</th>
                            </tr>
                        </thead>
                        <tbody id="idMarkBillItemPaymentBody"></tbody>
                    </table>
                </div>
                <div class="row-fluid classItemWiseNotesSection">
                    <div class="alert alert-info">
                        <ul>
                            <li>&#9658; Only saved bill items will be rendered here to map.</li>
                            <li>&#9658; To map item(s) with captured payments are only available from <strong>Update Bill</strong>.</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success classSubmitMarkBillItemPayment" data-entity-type-id="0" data-bill-id="0" data-payment-index="0" style="margin-top:0px;">Submit</button>
            </div>
        </div>
    </div>
</div>

    <!-- Update patient UIN -->
    <div id="idModalUpdateUniqueNationalIdentityNumber" class="modal hide" tabindex="-1" role="dialog" data-backdrop="static" aria-labelledby="idModalUpdateUniqueNationalIdentityNumberLAbel" aria-hidden="true">
        <div class="modal-header special-modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
            <h3 class='classModalUpdateUniqueNationalIdentityNumberLabel' id="idModalUpdateUniqueNationalIdentityNumberLabel">Update Unique National Identity Number</h3>
        </div>
        <div class="modal-body">
            <input type="hidden" name="idUpdateUINPatientID" id="idUpdateUINPatientID" value="0" />
            <input type="text" class="classInputTextL" name="idUpdateUniqueNationalIdentityNumber" id="idUpdateUniqueNationalIdentityNumber" placeholder="Unique National Identity Number..." />
        </div>
        <div class="modal-footer">
            <button class="btn btn-success classBtnUpdateUniqueNationalIdentityNumberLabel" aria-hidden="true">Submit</button>
            <button class="btn btn-danger" data-dismiss="modal" aria-hidden="true">Close</button>
        </div>
    </div>
    
<!-- showing bill Iteam Staff Discount-->
<div id="idModalBillIteamStaffDiscountDetails" class="modal fade" data-backdrop="static" data-keyboard="false" role="dialog" aria-labelledby="idModalBillStaffDiscount" aria-hidden="true" style="width: 1144px;margin-left: -565px;display:none;overflow-y: scroll">
    <!-- Modal content-->
    <div class="modal-header special-modal-header">
        <h3 id="idModalBillIteamStaffDiscountDetailsLabel" style="text-align: center;">Calculate Staff Medical Care Scheme</h3>
    </div>
    <h3 id="idModalBillItemStaffiscountsHistoryDetailsLabel" style="text-align: center;">Staff Medical Care Scheme Discount History</h3>
    <div class="modal-body classModalLarge">
        <div class="row-fluid">
            <table class='table table-bordered table-condensed table-responsive' id="idStaffDiscountsHistoryItemBillTable">
              <thead>
                  <tr class='classTableHeader'>
                      <th>Sr.No.</th>
                      <th>Discount Date</th>                                          
                      <th>Group Name</th>                                          
                      <th>Item Name</th>
                      <th>Discount Amount</th>
                      <th>User</th>
                  </tr>
              </thead>
              <tbody id="idStaffDiscountsHistoryItemBillBody"></tbody>
            </table>
        </div>
    </div>
    <div class="modal-footer classModalFooter">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            <!-- <button type="button" class="btn btn-success classSaveBillIteamStaffDiscount" data-entity-type-id="0" data-bill-id="0" style="margin-top:0px;">Save Discount</button> -->
    </div>
</div>

<div id="idModalAddPharmacyInterventionAskQuestion" class="modal hide" data-backdrop="static" data-keyboard="false" role="dialog" aria-labelledby="idModalAddPharmacyInterventionAskQuestionLabel" aria-hidden="true" style="width: 1000px;margin-left: -530px;">
    <div class="modal-header special-modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3 id="idModalAddPharmacyInterventionAskQuestionLabel">View Question</h3>
    </div>
    <div class="modal-body classModalLarge" id="idPanelBody">
        <div>
                     </div>
    </div>
    <div class="modal-footer classModalFooter">
        <button type="button" class="btn btn-danger" data-dismiss="modal" aria-hidden="true" id="idCloseViewQuestionModal">Close</button>
    </div>
</div>
<!-- Modal -->
<div class="modal hide classNHIASubmissionResponseDetails" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="width: 1144px;margin-left: -565px;display:none;overflow-y: scroll">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h3 class="modal-title" id="myModalLabel" style="text-align: center;"><strong>Submission Response</strong></h3>
            </div>
            <div class="modal-body classModalLarge">
                <div class="row-fluid classSubmissionDetails">
                    <table class="table tabl-condensed">
                        <tr>
                            <td>Report Date : </td>
                            <td><strong id="idSubmissionReportDate"></strong></td>
                            <td>Passed Claims : </td>
                            <td><strong id="idSubmissionPassedClaims"></strong></td>
                            <td>Failed Claims : </td>
                            <td><strong id="idSubmissionFailedClaims"></strong></td>
                        </tr>
                        <tr>
                            <td>Warned Claims : </td>
                            <td><strong id="idSubmissionWarnedClaims"></strong></td>
                            <td>Saved Claims : </td>
                            <td><strong id="idSubmissionSavedClaims"></strong></td>
                            <td>Total Cost : </td>
                            <td><strong id="idSubmissionTotalCost"></strong></td>
                        </tr>
                        <tr>
                            <td>Skipped Claims : </td>
                            <td><strong id="idSubmissionSkippedClaims"></strong></td>
                        </tr>
                    </table>
                </div>
                <h4 style="text-align: center;">Submitted Claim Listing</h4>
                <div class="row-fluid classNHIAClaimListing">
                    <table id="idTableClaimSubmissionListing" class="table" style="font-size: 12px;">
                        <thead style="color:#884646;" align="center">
                            <tr>
                                <th>#</th>
                                <th>Claim No.</th>
                                <th>Member No.</th>
                                <th>Surname</th>
                                <th>Other Names</th>
                                <th>Record Number</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="idTableBodyClaimSubmissionListing"></tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>				</div>
				
				<div class='classMiddleColumn'  id='idMiddleColumn'>
					<div class="classPanel" id='idPanel'>
			            <div class="classPanelHeading" id='idPanelHeading'>
							<h3 class="classPanelTitle" id='idPanelTitle'>Searched Patient Result</h3>
			            </div>
			            <div class="classPanelBody" id='idPanelBody'>
			            	      							<table class='table table-condensed classTableView' id='idTableView'>
      								<thead>
      									<tr class='classTableHeader' id='idTableHeader'>
      										<td width='5%;'>#</td>
      										<td width='15%;'>Patient No.</td>
                          <td width='25%;'>Name</td>
                          <td width='20%;'>Clinic</td>
                                                	<td width='10%;'>Contact</td>
      										<td width='5%;'>VIP?</td>
      										<td width='10%;'>Type</td>
      										<td width='15%;'>Corporate/Plan</td>
      										<td width='15%;'>Record</td>
      										<!-- <td width='5%;'>&nbsp;</td> -->
      									</tr>
      								</thead>
      								<tbody>
      																				<tr data-patient-id='96'>
												<td>1</td>
												<td>VR-A01-AAA0090</td>
                        <td>ERICA   ASORKOR</td>
                        <td>Volta Regional Hospital</td>                        
                        												<td>0592918479</td>
												<td class='classTableDataInfo classMemMVip$isVipMember' data-toggle='tooltip' title='$isVipMemberRemarks'>No</td>
												<td>Retail</td>
												<td>NHIA</td>
												<td >
												

                        

                            <input type='button' class='btn btn-primary btn-mini classPatientDetailsView' value='View' onclick="window.location.href='patientRecord.php?patient_id=96';" />
																														</td>
											</tr>
											      								</tbody>
      							</table>
      							                                <div class="pagination pagination-small">
                                    <ul>
                                                                                <li class='disabled'><a>First</a></li>
                                            <li class='disabled'><a>Prev</a></li>
                                                                                            <li class='disabled'>
                                                    <a href='?fnam=&pregno=VR-A01-AAA0090&InputPatientClinicSrting=&InputPatientClinic=&area=&iPatientID=&iStartLimit=0'>
                                                        1                                                    </a>
                                                </li>
                                                                                            <li class='disabled'><a>Next</a></li>
                                            <li class='disabled'><a>Last</a></li>
                                                                                </ul>
                                </div>
                                			            </div>
			        </div>
			        <div class='classBtnPanel' id='idBtnPanel'>
			        	&nbsp;&nbsp;&nbsp;<input  class='btn btn-primary' type='button' value='Search Again' onclick="window.location.href='searchPatient.php';" />
            			&nbsp;&nbsp;&nbsp;<input  class='btn btn-primary' type='button' value='Go To Dashboard' onclick="window.location.href='userDashboard.php';" />
			        </div>
				</div>
			</div>
			<div class='classFooter' id='idFooter'>
          		<script type="text/javascript" src="js/plugins/noty/packaged/jquery.noty.packaged.min.js"></script>
<script type="text/javascript" src="assets/noty/lib/noty.js"></script>
<script type="text/javascript" src="js/plugins/noty/themes/notyEhrTheme.js"></script>

<script type="text/javascript">
	Noty.setMaxVisible(10); 
  	function generate(type,msg) {
        var n = new Noty({
		    theme: 'relax',
		    type: type,
		    text: msg,
		    dismissQueue: true,
            closeWith   : ['click'],
            layout      : 'topRight',
            maxVisible  : 10
		}).show();

		return n;
    }
    var PASSWORD_POLICY_MIN_PASSWORD_LENGTH= "";
	var PASSWORD_POLICY_MAX_PASSWORD_LENGTH= "64";
	var PASSWORD_POLICY_NUMBER_MIN_REQUIRED= "0";
	var PASSWORD_POLICY_LOWERCASE_MIN_REQUIRED= "0";
	var PASSWORD_POLICY_UPPERCASE_MIN_REQUIRED= "0";
	var PASSWORD_POLICY_SYMBOLS_MIN_REQUIRED= "0";
	var PASSWORD_POLICY_SYMBOLS_MAX_REQUIRED= "0";
	var PASSWORD_POLICY_CANNOT_CONTAIN_USERNAME= "";
	var PASSWORD_POLICY_MAX_FAIL_ATTEMPTS= "10";
	var PASSWORD_POLICY_NEW_PASSWORD_MATCH= "0";
	var iMinLetters= "0";
	var iTotalPasswordLength="0";
	
</script>

<script type="text/javascript" src="js/javascript_password_validation_script.js"></script>

<style>
	.classSearchPatientModal .classTableData {font-size: 12px;}
	.classSearchPatientModal input[type="text"].classInputTextXS {margin-bottom: 10px;}
</style>

<span class='classFooterAlignLeft'>
	Email: <a href="mailto:info@lwehs.com">info@lwehs.com</a> 
	| Phone: <a href="tel:1.678.510.1739">1.678.510.1739</a>
</span> 
&nbsp;&nbsp;
<span class='classFooterAlignRight classHidden'>
	&nbsp;<a href='http://www.plus91online.com' target='_blank'>Powered By Medixcel-EHR</a>.
</span>
<div id="idSerachPatientModal" class="modal hide classSearchPatientModal" data-backdrop="static" data-keyboard="false" role="dialog" aria-labelledby="myModalForSerachPatientLabel" aria-hidden="true">
	<div class="modal-header special-modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		<h3 id="myModalForSerachPatientLabel">LHIMS - Search Patient</h3>
	</div>
	<div class="modal-body classSearchPatientModalBody classModalLarge">
	<div class='classDashbaordModalDiv'>
			<form class='classFormFormat' method='post' id="idFormPatientVisit" style="margin-top: -30px;">
				<script type="text/javascript">
    $(document).ready(function() {
    	var iSelectedStaffID = "";
    	var iLoginScreen = "0";
		var iSchClinicID = "";
    	var dTodayDate = '2025-11-09';
    	var iLoggedClinicIDForAddApmnt = '2';
        var dTodayDate=dTodayDate.split("-");
        var scheduleMonth = dTodayDate[1];
        var scheduleDay = dTodayDate[2];
        var scheduleYear = dTodayDate[0];
        var scheduleInitDate = new Date(scheduleYear, scheduleMonth-1, scheduleDay);
        var sInsertPatientMandatoryFields = "0";
		$('#idSchDate').datepicker({
            dateFormat: 'dd-mm-yy',
            showOn: "button",
            buttonImage: "images/Calendar-icon.png",
            //maxDate:scheduleInitDate,
            buttonImageOnly: true,
        }); 

        //! Get the Current Time 
		var CurrentDate = new Date();
        var dobLimitString = '1900:'+CurrentDate.getFullYear();
		var hours = CurrentDate.getHours();
		var minutes = CurrentDate.getMinutes();
		var DayNight = "PM";
		if (hours<12) DayNight = "AM";
		if (hours<10) hours = "0"+hours;
		if (minutes<=9) minutes = "0"+minutes;
		var currentTimeone = hours+":00"; //! Set the Hours as Current Hours in 24 format and set the min and sec as 00
		var currentTime = '05:00';
		//! Flag for schedule calendar for ANC 
		var iScheduleCalanderForANC = "0";
		var iScheduleCalanderForPediatric = "0";
		var iScheduleCalanderForDialysis = "0";
		var iScheduleCalanderForAccidentEmergency = "0";
		var iScheduleCalanderForOncology = "0";
		var iIsConfidential = "0";
		var iSecretSpecializationID = "0";
		var iScheduleCalanderForRadiology = "0";
		var iScheduleCalanderForSurgery = "0";

		//! Shraddha - Added on 24 Feb 2014
		//! added bootstrap modal instead of dialog box
		//$("#idTime").val(time); //! Set Schedule Time in serach_patient.php file
		//$("#idDate").val(date); //! Set Schedule Date in serach_patient.php file
  		$("#idSerachPatientModal #idTime").val(currentTime); //! Set Schedule Time as Current Time to display in UI of  patient_search_common.php  file
  		// $("#idSerachPatientModal #idTime").val('05:00'); //! Set Schedule Time as Current Time to display in UI of  patient_search_common.php  file

  		$('#idApptClinic').val(iLoggedClinicIDForAddApmnt);

	  	jQuery('#pinfo #idDOB').datepicker({
    		changeMonth: true,
    		dateFormat: 'dd-mm-yy',
    		changeYear: true,
    		showOn: "button",
    		buttonImage: "images/Calendar-icon.png",
    		buttonImageOnly: true,
    		maxDate: new Date(),
    		yearRange: dobLimitString,
    		onSelect: function() {
                if($(this).val()!="") {
                    //! Age is readonly
                    $("#pinfo #idAge").attr("readonly", true);
                    var dob = $(this).val();
                    var dob = dob.split("-");
                    var dob = dob[2]+"-"+dob[1]+"-"+dob[0];
                    //! Update new age
                    var age = getAge(dob);
                    $('#pinfo #idAge').val(age);
                }
                else {
                    $("#pinfo #idAge").attr("readonly", false);
                }
            }
    	});

    	jQuery('#pinfo #idDOB').datepicker('disable');

	    // Fill state and country on City name change
	    jQuery("#pinfo #idCity").on('change', function () {
	        var city_name = jQuery(this).val().toUpperCase();
	        var country_name = '';
	        
	        jQuery('#pinfo #idState').val("");
	        jQuery('#pinfo #idCountry').val("");

	        jQuery.post("runtime_fetch_member.php",{city_name:city_name}, function(data) {
	            if(data != '')
	            {
	                var splitData=data.split("<NEXT>");
	                jQuery('#pinfo #idState').val(splitData[0]);
	        		jQuery('#pinfo #idCountry').val(splitData[1]);
	            }
	        });
		});

		// Updating Patient's Information directly from Add App modal
    	jQuery("#idSerachPatientModal #idUpdatePatient").click(function(){

    		// Get all inputs and its value to validate and submit
    		var data = {};

    		jQuery("#pinfo")
	    		.find('input,select,textarea')
	    		.each(function(index, el) {
	    			var $el = jQuery(el);
	    			data[$el.attr('name')] = $el.val();
	    		});
	    	
	    	var tScheduleTime = $("#idTime").val();
			var dScheduleDate = $("#idSchDate").val();
			var iApptClinic = $("#idApptClinic").val();
			var iPatientID = $("#idPatientIDAddAppointment").val();
			var iPatientAgeInYears = $("#idPatientAgeInYears").val();
			var bConfirm = true;

			//! confirmation for child patient..
			if(parseInt(iPatientAgeInYears) < 12){
				bConfirm = confirm('Selected patient is child which is below 12 years of age. Please confirm before adding the visit.');

				if (!bConfirm) {
					return false;
				}

				//! Child is using mother's insurance..
				if (childContainsMothersInsurance(iPatientID)) {
					var bConfirmation = confirm("Selected patient becomes more than 3 months but still using mother's insurance. Please confirm before proceed.");

					if (!bConfirmation) {
						return false;
					}
				}
			}

	    	if(data["patientId"] == ""){
	    		alert("Please select patient first");
    			return false;
	    	} else if(data["fname"] == ""){
    			alert("Enter First Name");
    			return false;
    		} else if(data["lname"] == ""){
    			alert("Enter Last Name");
    			return false;

            
	    		} else if(data["dob"] == "" || data["dob"] == "N/A"){
	    			alert("Date of Birth is required.");
	    			return false;

	    		} else if(data["age"] == ""){
	    			alert("Age is required.");
	    			return false;

                            
    		} else if(data["sex"] == ""){
    			alert("Gender is required.");
    			return false;
    		} /*else if(data["city"] == ""){
    			alert("City is required.");
    			return false;
    		} else if(data["state"] == ""){
    			alert("State is required.");
    			return false;
    		} else if(data["country"] == ""){
    			alert("Country is required.");
    			return false;
    		}*/ else if(data["mobile"] == ""){
    			alert("Mobile No is required.");
    			return false;
    		} else if(data["regno"] == ""){
    			alert("Patient No is required.");
    			return false;
    		}
    		if(sInsertPatientMandatoryFields==1){
    			if(data["hphone"] == ""){
	    		alert("Patient Home Number is required");
    			return false;
		    	}else if(data["occupation"] == ""){
		    		alert("Please select patient occupation");
	    			return false;
		    	}
		    	else if(data["education"] == ""){
		    		alert("Please select patient education");
	    			return false;
		    	}else if(data["maritalStatus"] == ""){
		    		alert("Please select patient marital status");
	    			return false;
		    	}else if(data["relativeName"] == ""){
		    		alert("Patient relative name is required");
	    			return false;
		    	}else if(data["relativeNumber"] == ""){
		    		alert("Patient relative number is required");
	    			return false;
		    	}else if(data["relation"] == ""){
		    		alert("Relation with patient is required");
	    			return false;
		    	}
    		}
    		
    		data["sFlag"] = "updatePatientForAppointmentModal";
    		if(bConfirm == true){
	    		if(confirm("Are you sure? Please check Patient and Schedule Information Once.")){
		    		// Save values using ajax and redirect for adding Schedule
		    		jQuery.post("ajaxEhr.php", data, function (data) {
		    			if(data == 1){
							window.location.href = "addSchedule.php?iPatientID="+iPatientID+"&dScheduleDate="+dScheduleDate+"&tScheduleTime="+tScheduleTime+"&iSelectedStaffID="+iSelectedStaffID+"&iApptClinic="+iApptClinic+"&iScheduleCalanderForDialysis="+iScheduleCalanderForDialysis+"&iScheduleCalanderForAccidentEmergency="+iScheduleCalanderForAccidentEmergency+"&iScheduleCalanderForOncology="+iScheduleCalanderForOncology+"&iIsConfidential="+iIsConfidential+"&iSecretSpecializationID="+iSecretSpecializationID+"&iScheduleCalanderForRadiology="+iScheduleCalanderForRadiology+"&iScheduleCalanderForSurgery="+iScheduleCalanderForSurgery;
		    			} else {
					    	alert( "There was error updating Patient Information." );
		    			}
		    		});
				}    			
    		}
    	});
        
        $("#idSerachPatientModal #idAddNewPatient").click(function(){

			var tScheduleTime = $("#idTime").val();
			var dScheduleDate = $("#idSchDate").val();
			var iApptClinic = $("#idApptClinic").val();
			//var iDiagnostic = $("#outsource_diagnostic").val();
			var iEnableOutsourceDiagnosticId = "0";
			var iDiagnostic = 0;
			if(iEnableOutsourceDiagnosticId == 1){
				iDiagnostic = $("#outsource_diagnostic").val();
			}

			//if(confirm("Are you sure? Please check Schedule Date and Time Once.")){
				window.location.href='addPatient.php?dScheduleDate='+dScheduleDate+'&tScheduleTime='+tScheduleTime+"&iSelectedStaffID="+iSelectedStaffID+"&iApptClinic="+iApptClinic+"&iOutsourceDiagnosticId="+iDiagnostic+"&iScheduleCalanderForDialysis="+iScheduleCalanderForDialysis+"&iScheduleCalanderForAccidentEmergency="+iScheduleCalanderForAccidentEmergency+"&iScheduleCalanderForOncology="+iScheduleCalanderForOncology+"&iIsConfidential="+iIsConfidential+"&iSecretSpecializationID="+iSecretSpecializationID+"&iScheduleCalanderForRadiology="+iScheduleCalanderForRadiology+"&iScheduleCalanderForSurgery="+iScheduleCalanderForSurgery;
			//}
	    });


	    //! brief function to serach patient
		window.fSearchPatient = function(bResetPatientData){
			
			var sPatientNameStr = $("#spatient").val() ? $("#spatient").val() : "";
			var sPatientNoStr = $('#Regno').val() ? $('#Regno').val() : "";
			var sPatientMobileNo = $('#sPatientMobile').val() ? $('#sPatientMobile').val() : "";
			var sPatientUniqueNo = $('#sPatientUnique').val() ? $('#sPatientUnique').val() : "";
			var sNHIANo = $('#idNHIANo').val() ? $('#idNHIANo').val() : "";
			var sUniversalSearchKeyword = $('#idPatientUniversalSearch').val() ? $('#idPatientUniversalSearch').val() : "";
			var sUINNo = $('#idUINNo').val() ? $('#idUINNo').val() : "";
			
		    var isSpaceOccurs = sPatientNameStr.search(' ');

		    $('#idFirstName').val('');
		    $('#idMiddleName').val('');
		    $('#idLastName').val('');

		    var aPatientSplit = sPatientNameStr.split(' ');
		    sPatientfName = aPatientSplit[0];
		    sPatientmName = aPatientSplit[1];
		    sPatientlName = aPatientSplit[2];

		    if(isSpaceOccurs == -1){
		        sPatientmName = '';
		    }

		    if(typeof bResetPatientData !="undefined" && bResetPatientData == false) {
		    	bResetPatientData = false;
		    }
		    else {
		    	bResetPatientData = true;
		    }

		    if(sPatientlName){
		    	
		    	$('#idFirstName').val(sPatientfName.toUpperCase());
		    	$('#idMiddleName').val(sPatientmName.toUpperCase());
		    	$('#idLastName').val(sPatientlName.toUpperCase());

		    }else{

		    	$('#idFirstName').val(sPatientfName.toUpperCase());
		    	$('#idLastName').val(sPatientmName.toUpperCase());
		    }

		    $.ajax({
		    	url: "ajaxEhr.php?sFlag=SearchPatientFromModal&sPatientNameStr="+sPatientNameStr+"&sPatientNoStr="+sPatientNoStr+"&sPatientMobile="+sPatientMobileNo+"&iIsWellnewssProvider=0&iStaffClinicID=2"+"&sPatientUniqueNo="+sPatientUniqueNo+"&iStaffID=411&iUserTypeID=11&iIsConfidential=0&sNHIANo="+sNHIANo+"&sUniversalSearchKeyword="+sUniversalSearchKeyword+"&sUINNo="+sUINNo,
		    	success: function (data){

		    		if(bResetPatientData) {
		    			fResetPatientData();
		    		}
		    		
		    		var sData = '';
		    		let iShowPatientMobNo = 0;

		    		if($.trim(data) != false) {

		    			var oTempData = $.parseJSON(data);

		    			if(oTempData == '1'){

		    				sData += "<strng style='color:red;'>Please Enter Minimum 3 Characters.</strong>";

		    			}else{

		    				sData +=  "<table class='classTableFormat' >";
				            var iFlag = 0;
				            var iIsFrozen;
				            var iPatientID;
				            var sPatientName;
				            var sMobileNo;

				            for(var iii=0;iii<oTempData.length;iii++){
				            	iPatientID = oTempData[iii]['patient_id'];
				            	sPatientName = oTempData[iii]['patient_name'];
				            	iIsFrozen = oTempData[iii]['isFrozen'];
				            	iIsDead   = oTempData[iii]['is_dead'];
				            	sMobileNo   = oTempData[iii]['mobile'];

				            	if(iShowPatientMobNo == 1 && sMobileNo != ''){
				            		sPatientName+= "( "+sMobileNo+" )";
				            	}

				                if(iIsFrozen == 1){
				                    iFlag = 1;
				                    sData += "<tr class='classTableRow'>";
				                    sData +=  "<td class='classTableData'>";
				                    sData +=  "<span class='classSpanData'>"+sPatientName+"</span><span style='color:red'> - Is Frozen</span>";
									sData +=  "</td></tr>";
				                }
				                else if (iIsDead==1){ //! Block for check the patietn is dead..
				                    iFlag = 1;
				                    sData += "<tr class='classTableRow'>";
				                    sData +=  "<td class='classTableData'>";
				                    sData +=  "<span class='classSpanData'>"+sPatientName+"</span><span style='color:red'> - Is Dead</span>";
									sData +=  "</td></tr>";
				                }
				                else{
				                    iFlag = 1;
				                    sData +=  "<tr class='classTableRow'>";
				                    sData +=  "<td class='classTableData'>";
									sData +=  "<u>";
									sData +=  "<span class='classSpanData'  style='cursor:pointer;' onclick=\"fSetPatientData('"+iPatientID+"');\" >"+sPatientName+"</span>";
									sData +=  "</u></td></tr>";
				                }
				            }

				            if(iFlag == 0){
				                sData += "<strong style='color:red;'>No Record Found.</strong> <br />";
				            }
				            sData += "</table>";
				            sData += "<input class='btn btn-mini btn-primary classSearchPatientGlobalSearch' type='button' value='Patient Global Search' id='idSearchPatientGlobalSearch' name='searchPatientGlobalSearch' style='float:left; margin-top:5px;'/>";

		    			}

		    		}else{
		    			sData += "<strong style='color:red;'>No Record Found.</strong> <br />";
		    			sData += "<input class='btn btn-mini btn-primary classSearchPatientGlobalSearch' type='button' value='Patient Global Search' id='idSearchPatientGlobalSearch' name='searchPatientGlobalSearch' style='float:left; margin-top:5px;'/>";
		    		}
		    		$("#idPatientNameListing").html(sData);
		    	}
		    });
		}

		//! brief function to serach patient
		window.fSearchPatientByEmergencyContact = function(){			
			var sContactName = $('#idEmergencyContactName').val();
			var sContactNumber = $('#idEmergencyContactNumber').val();
			var sContactEmail = $('#idEmergencyContactEmail').val();			
		    		    
		    $.ajax({
		    	url: "ajaxEhr.php?sFlag=searchPatientByEmergencyContact&sContactName="+sContactName+"&sContactNumber="+sContactNumber+"&sContactEmail="+sContactEmail,
		    	asyn: false,
		    	success: function (data){

		    		fResetPatientData();
		    		
		    		var sData = '';

		    		if($.trim(data) != false) {

		    			var oTempData = $.parseJSON(data);

		    			if(oTempData == '1'){

		    				sData += "<strng style='color:red;'>Please Enter Minimum 3 Characters.</strong>";

		    			}else{

		    				sData +=  "<table class='classTableFormat' >";
				            var iFlag = 0;
				            var iIsFrozen;
				            var iPatientID;
				            var sPatientName;

				            for(var iii=0;iii<oTempData.length;iii++){

				            	iPatientID = oTempData[iii]['patient_id'];
				            	sPatientName = oTempData[iii]['patient_name'];
				            	iIsFrozen = oTempData[iii]['isFrozen'];

				                if(iIsFrozen == 0){
				                    iFlag = 1;
				                    sData +=  "<tr class='classTableRow'>";
				                    sData +=  "<td class='classTableData'>";
									sData +=  "<u>";
									sData +=  "<span class='classSpanData'  style='cursor:pointer;' onclick=\"fSetPatientData('"+iPatientID+"');\" >"+sPatientName+"</span>";
									sData +=  "</u></td></tr>";

				                }else{
				                    iFlag = 1;
				                    sData += "<tr class='classTableRow'>";
				                    sData +=  "<td class='classTableData'>";
				                    sData +=  "<span class='classSpanData'>"+sPatientName+"</span><span style='color:red'> - Is Frozen</span>";
									sData +=  "</td></tr>";
				                }
				            }

				            if(iFlag == 0){
				                sData += "<strong style='color:red;'>No Record Found.</strong>";
				            }
				            sData += "</table>";

		    			}

		    		}else{
		    			sData += "<strong style='color:red;'>No Record Found.</strong>";
		    		}
		    		$("#idPatientNameListing").html(sData);
		    	}
		    });
		}

		//! brief function to set patient data
		window.fSetPatientData = function(iPatientID){
			
			$('#patientId').val(iPatientID);

			$.ajax({
				url: "ajaxEhr.php?sFlag=SetPatientData&iPatientID="+iPatientID,
				asyn: false,
				success: function (data){

					if($.trim(data) != false){

						var oTempData = $.parseJSON(data);
						var sPatientNo	= oTempData['sPatientNo'];
						var sShortPatientNo	= oTempData['sShortPatientNo'];
						var sPatientName = oTempData['sPatientName'];
						var sPatientfName = oTempData['sPatientfName'];
						var sPatientmName = oTempData['sPatientmName'];
						var sPatientlName = oTempData['sPatientlName'];
						var sAddress = oTempData['sAddress'];
						var sCity = oTempData['sCity'];
						var sState = oTempData['sState'];
						var sCountry = oTempData['sCountry'];
						var iPincode = oTempData['iPincode'];
						var iPhone = oTempData['iPhone'];
						var iMobile	= oTempData['iMobile'];
						var sEmail = oTempData['sEmail'];
						var dDOB = oTempData['dDOB'];
						var iAgeDays = oTempData['iAgeDays'];
						var iAge = oTempData['iAge'];
						var sGender = oTempData['sGender'];
						var sOfficeAddress = oTempData['sOfficeAddress'];
						var sOfficeCity	= oTempData['sOfficeCity'];
						var sOfficeState = oTempData['sOfficeState'];
						var sOfficeCountry = oTempData['sOfficeCountry'];
						var iOfficePincode = oTempData['iOfficePincode'];
						var iOfficePhone = oTempData['iOfficePhone'];
						var iOfficeMobile = oTempData['iOfficeMobile'];
						var sOfficeEmail = oTempData['sOfficeEmail'];
			            var sEmergencyContactName = oTempData['sEmergencyContactName'];
			            var iEmergencyContactNo	= oTempData['iEmergencyContactNo'];
			            var sEmergencyRelation	= oTempData['sEmergencyContactRelation'];
			            var iOccupation	= oTempData['iOccupation'];
					 	var iEducation	= oTempData['iEducation'];	
					 	var sMartialStatus	= oTempData['sMartialStatus'];	
			            var sImage = oTempData['sImage'];
			            var iPrimaryClinicID = oTempData['iPrimaryClinicID'];
			            var sNHIANo = oTempData['sNHIANo'];
			            var iNHIAStatus = oTempData['iNHIAStatus'];

			            if(iAgeDays<365){
			            	var iAgeInWeeks= Math.floor(iAgeDays / 7);
			            	$("#idAge").val(iAgeInWeeks);
			            	$('#idDisplayYearLabel').css('display',"none");
			            	$('#idDisplayWeekLabel').css('display',"");
			            }else if(iAgeDays==365){
			            	var iPatientAge=1;
			            	$("#idAge").val(iPatientAge);
			            	$('#idDisplayYearLabel').css('display',"");
			            	$('#idDisplayWeekLabel').css('display',"none");
			            }else{
			            	$("#idAge").val(iAge);
			            	$('#idDisplayYearLabel').css('display',"");
			            	$('#idDisplayWeekLabel').css('display',"none");
			            }
			            if(iPhone == "-"){
			            	iPhone = "";
			            }

			            $("#idPatientID").val(iPatientID);
			            $("#idMembershipTypeID").val(oTempData['iMembershipTypeID']);
			            $("#idPatientIDAddAppointment").val(iPatientID);
			            $("#idPatientAgeInYears").val(iAge);
			            
			            			            	$("#idSMPatientNo").val(sPatientNo);
			            				            $("#idFirstName").val(sPatientfName);
			            $("#idMiddleName").val(sPatientmName);
			            $("#idLastName").val(sPatientlName);
			            $("#idDOB").val(dDOB);
			            $("#idSex").val(sGender);
			            $("#idAddress").val(sAddress);
			            $('#idCity').append($("<option></option>").attr("value",sCity).text(sCity)).trigger('change');
			            $("#idPincode").val(iPincode);
			            $("#idState").val(sState);
			            $("#idCountry").val(sCountry);
			            $("#idPhone").val(iPhone);
			            $("#idMobile").val(iMobile);
			            $("#idEmail").val(sEmail);
			            $("#idEmergencyName").val(sEmergencyContactName);
			            $("#idEmergencyNo").val(iEmergencyContactNo);
			            $("#idRelative").val(sEmergencyRelation);
			            $("#idMaritalStatus").val(sMartialStatus);
			            $("#idOccupation").val(iOccupation);
			            $("#idEducation").val(iEducation);
			            $("#idPatientNHIANo").val(sNHIANo);
			            $(".classOPDPatientNHIAUnconfirmedStatusContainer").hide();
			            if (iNHIAStatus == -1) {
			            	$(".classOPDPatientNHIAUnconfirmedStatusContainer").show();
			            }
			            //$("#idApptClinic").val(iPrimaryClinicID);

			            var sImageNameWithPath = '';
			            if(sImage!=''){
							sImageNameWithPath = "<img src=images/patient_images/"+sImage+" style='float:left;margin-left:20px;padding-bottom:10px;width:50px;height:50px;'; />";
							}else{
  							
  							if(sGender == 'Female'){
    							sImageNameWithPath = "<img src=images/female.jpg style='float:left;margin-left:20px;padding-bottom:10px;width:50px;height:50px'; />";
  							}else{
    							sImageNameWithPath = "<img src=images/male.jpg style='float:left;margin-left:20px;padding-bottom:10px;width:50px;height:50px'; />";
  							}    
							}

							$("#idImage").html(sImageNameWithPath);

							// Making them editable for updating patient information
							$("#pinfo").find("input,select,textarea")
									   .not("#idSMPatientNo")
									   .not("#idPatientNHIANo")
									   .prop("disabled", false)
								   .prop("readonly", false);

							$("#pinfo").find("#idState").prop("readonly", true);
							$("#pinfo").find("#idCountry").prop("readonly", true);

						// Enabling date picker
						$('#idDOB').datepicker('enable');

						// Enable update button
						jQuery("#idSerachPatientModal #idUpdatePatient").prop('disabled', false);
						//fGenerateAutoCities(sCity);
					}else{
						$("#idPatientIDAddAppointment").val('');
						alert("Some error was occured. Please try again.");
					}
				}
			});
		}

		//! brief function to rest the selected patient data
		window.fResetPatientData = function(){
			
			// Making Controls Readonly
			$("#pinfo").find("input,select,textarea")
					   .prop("disabled", true)
				   	   .prop("readonly", true);

			//Disabled Datepicker
			jQuery('#pinfo #idDOB').datepicker('disable');
			
			// Disabled update button
			jQuery("#idSerachPatientModal #idUpdatePatient").prop('disabled', true);

			$("#idPatientIDAddAppointment").val('');
			$("#idSMPatientNo").val('');
            $("#idFirstName").val('');
            $("#idMiddleName").val('');
            $("#idLastName").val('');
            $("#idDOB").val('');
            $("#idAge").val('');
            $("#idSex").val('');
            $("#idAddress").val('');
            $("#idCity").val('');
            $("#idPincode").val('');
            $("#idState").val('');
            $("#idCountry").val('');
            $("#idPhone").val('');
            $("#idMobile").val('');
            $("#idEmail").val('');
            $("#idEmergencyName").val('');
            $("#idEmergencyNo").val('');
            $("#idPatientNHIANo").val('');
            $(".classOPDPatientNHIAUnconfirmedStatusContainer").hide();
            $("#idImage").html("<span style='float:left;margin-left:20px;padding-bottom:10px;width:50px;height:50px'; ></span>");
		}

		//! brief function to set patient visit
		window.fAddPatientVisit = function(){
			var sCheckFutureDateStatus = "0";
			var dScheduleDate = $("#idSchDate").val();
			var tScheduleTime = $("#idTime").val();
			var iPatientID = $("#idPatientIDAddAppointment").val();
			var sFirstName = $("#idFirstName").val();
			var iApptClinic = $("#idApptClinic").val();
            var iApptDuration = $('#idApptDuration').val();
			var iDiagnostic = $("#outsource_diagnostic").val();
			var iMembershipTypeID = $("#idMembershipTypeID").val();
			var iPatientAgeInYears = $("#idPatientAgeInYears").val();
			var sDobPatient = $("#idDOB").val();
			var bConfirm = true;
			var iPhone= $("#idPhone").val();
			var iOccupation= $("#idOccupation").val();
			var iEducation= $("#idEducation").val();
			var sEmergencyContactName= $("#idEmergencyName").val();
			var iEmergencyContactNo= $("#idEmergencyNo").val();
			var sEmergencyRelation= $("#idRelative").val();
			//! Check & update subscription for retail patient (if subscription is expired)..
			if(iMembershipTypeID == 2 && iPatientID != ''){
				fCheckUpdateRetailPatientSubscription(iPatientID);
			}
			// Get today date in DD-MM-YYYY format
			/*var today = new Date();
			var dd = today.getDate();
			var mm = today.getMonth(); 
			var yyyy = today.getFullYear();
			var dTodayDate = dd+'-'+mm+'-'+yyyy;*/

			var dTodayDate = new Date($.now());

			var aPatientDate = sDobPatient.split("-");
			if(!sDobPatient && sDobPatient != "NA" && sDobPatient != "N/A"){
				var dPatientDateBirth = new Date(aPatientDate[2],aPatientDate[1] - 1,aPatientDate[0]);//Year, Month, Date 
			} else {
				var dPatientDateBirth = null;
			}

			var sDOBStatus=0;

			if(sCheckFutureDateStatus == 1){
				// Check DOB of patient is not future date 
				if(dPatientDateBirth >= dTodayDate && sDobPatient != "N/A")
				{
					var sDOBStatus=1;
				}
			}
			if(sInsertPatientMandatoryFields == 1){
				// Check DOB of patient is not future date 
				if(iPhone != '' &&  iOccupation !='' && iEducation !='' && sEmergencyContactName !='' && iEmergencyContactNo !='' &&  sEmergencyRelation !='')
				{
					var iMandatoryInformation=1;
				}
				else
				{
					var iMandatoryInformation=0;
				}
			}
			//! confirmation for child patient..
			if(iPatientAgeInYears < 12 && sDOBStatus==0){
				bConfirm = confirm('Selected patient is child which is below 12 years of age. Please confirm before adding the visit.');

				if (!bConfirm) {
					return false;
				}

				//! Child is using mother's insurance..
				if (childContainsMothersInsurance(iPatientID)) {
					var bConfirmation = confirm("Selected patient becomes more than 3 months but still using mother's insurance. Please confirm before proceed.");

					if (!bConfirmation) {
						return false;
					}
				}
			}

			if(isPatientAvailableForSchedule(iPatientID,dScheduleDate,tScheduleTime,iApptDuration)){
				if(iPatientID == '' || sFirstName == ''){
					alert("Please Select Proper "+sPatientOrMember);
				}else{
					if(sDOBStatus==1){
						alert("Please update the patient DOB,it`s showing future Date");
						}else{
							if(iMandatoryInformation==0){
								alert("Please update the patient information");
							}else{
					if(bConfirm == true){

						// If outsource Diagnostic center is selected then check for time availability
						if(iDiagnostic > 0){
							$.post('ajaxEhr.php',{
								sFlag: "checkIfOutsourceDiagnosticAvailableAtTime",
								iDiagnostic: iDiagnostic,
								sDate: dScheduleDate,
								sTime: tScheduleTime,
								iApptDuration: iApptDuration
							}, function(data) {
								if(data > 0){
									window.location.href = "addSchedule.php?iPatientID="+iPatientID+"&dScheduleDate="+dScheduleDate+"&tScheduleTime="+tScheduleTime+"&iSelectedStaffID="+iSelectedStaffID+"&iApptClinic="+iApptClinic+"&iApptDuration="+iApptDuration+"&iOutsourceDiagnosticId="+iDiagnostic+"&iScheduleCalanderForANC="+iScheduleCalanderForANC+"&iScheduleCalanderForPediatric="+iScheduleCalanderForPediatric+"&iScheduleCalanderForDialysis="+iScheduleCalanderForDialysis+"&iScheduleCalanderForAccidentEmergency="+iScheduleCalanderForAccidentEmergency+"&iScheduleCalanderForOncology="+iScheduleCalanderForOncology+"&iIsConfidential="+iIsConfidential+"&iSecretSpecializationID="+iSecretSpecializationID+"&iScheduleCalanderForRadiology="+iScheduleCalanderForRadiology+"&iScheduleCalanderForSurgery="+iScheduleCalanderForSurgery;
								} else {
									alert("Outsource Diagnostic Center is not available at this time. Please select time on which center is available.");
								}
							});
						} else {
							window.location.href = "addSchedule.php?iPatientID="+iPatientID+"&dScheduleDate="+dScheduleDate+"&tScheduleTime="+tScheduleTime+"&iSelectedStaffID="+iSelectedStaffID+"&iApptClinic="+iApptClinic+"&iApptDuration="+iApptDuration+"&iScheduleCalanderForANC="+iScheduleCalanderForANC+"&iScheduleCalanderForPediatric="+iScheduleCalanderForPediatric+"&iScheduleCalanderForDialysis="+iScheduleCalanderForDialysis+"&iScheduleCalanderForAccidentEmergency="+iScheduleCalanderForAccidentEmergency+"&iScheduleCalanderForOncology="+iScheduleCalanderForOncology+"&iIsConfidential="+iIsConfidential+"&iSecretSpecializationID="+iSecretSpecializationID+"&iScheduleCalanderForRadiology="+iScheduleCalanderForRadiology+"&iScheduleCalanderForSurgery="+iScheduleCalanderForSurgery;

						}
					}
				  }
				}
				}
			}else{
				let sMsg = "Patient already has appointment in selected duration";
				alert(sMsg);
			}		
		}

		//! brief function to search timinings according to Clinic
		window.fSearchClinicTime = function(){
			var iApptClinic = $("#idApptClinic").val();
			$.ajax({
		    	url: "ajaxEhr.php?sFlag=SearchClinicTimings&iApptClinic="+iApptClinic,
		    	data:{iPatientSearchModal:1},
		    	asyn: false,
		    	success: function (data){
		    		if($.trim(data) != false) {
		    			var sData = '';	    			

		    			for(var iii=0;iii<data.length;iii++){													
							sData += "<option value='"+data[iii]+"'>"+data[iii]+"</option>";
						}

						$('#idSerachPatientModal #idTime').html(sData);
						//Set current time
						$("#idSerachPatientModal #idTime").val(getCurrentDate('h:00'));
		    		}	
		    	}
		    });
		}

		//! Function for updating retail patient subscription to normal if subscription date expired
		function fCheckUpdateRetailPatientSubscription(iPatientID){
			$.ajax({
				type: 'POST',
		    	url: "ajaxEhr.php?sFlag=fCheckUpdateRetailPatientSubscription",
		    	data: {iPatientID:iPatientID},
		    	async: false,
		    	success: function (data){
		    		if($.trim(data) != false) {
		    		}else{
		    			alert('Something went wrong!');
		    			return false;
		    		}
		    	}
		    });
		}

		$('#idCity').select2({
			width: '100%',
			allowClear: true,
			minimumInputLength: 3,
			width: 'resolve',
			placeholder: "Search City Name",
			ajax: {
			    url:"ajaxInventory.php?sFlag=GetAllCityList",
			    data: function (params) {
			        return {
			            sCityNameStr: params.term,
			        };
			    },
			    processResults: function (data,params) {
			        var results=[];
			        if($.trim(data) != false){
				        data = $.parseJSON(data);
				        $.each(data, function(iIndex, City){
				        	var sCityName = City.city;
					        results.push({
					            id: sCityName,
					            text: sCityName 
					        });
				        });				        	
			        }
			        return { results: results };
			    }
			}
		});
	});
</script>

<div style="float:left;">
	<table class='classTableFormat'  align='left' border='0'>
		
		<tr class='classTableRow' >
			<td class='classTableData'  colspan='4' style='font-size:12px'>
				<p style="margin-bottom: 12px;"><strong>Appointment Information</strong></p>
			</td>
		</tr>

		<tr class='classTableRow top-spacing' >
			<td class='classTableData' >
				Date:
				<input  class='classInputTextXS classSchDateAddPatientAppointment' type='text' name='date' id='idSchDate'  value="09-11-2025" readonly='readonly' size='10' />
			</td>
			<td class='classTableData'>
				&nbsp;Time:
				<select name='time' id='idTime' class='classInputTextXS' style="width:100px;">
					<option value="00:00">00:00</option> 
<option value="00:20">00:20</option> 
<option value="00:40">00:40</option> 
<option value="01:00">01:00</option> 
<option value="01:20">01:20</option> 
<option value="01:40">01:40</option> 
<option value="02:00">02:00</option> 
<option value="02:20">02:20</option> 
<option value="02:40">02:40</option> 
<option value="03:00">03:00</option> 
<option value="03:20">03:20</option> 
<option value="03:40">03:40</option> 
<option value="04:00">04:00</option> 
<option value="04:20">04:20</option> 
<option value="04:40">04:40</option> 
<option value="05:00">05:00</option> 
<option value="05:20">05:20</option> 
<option value="05:40">05:40</option> 
<option value="06:00">06:00</option> 
<option value="06:20">06:20</option> 
<option value="06:40">06:40</option> 
<option value="07:00">07:00</option> 
<option value="07:20">07:20</option> 
<option value="07:40">07:40</option> 
<option value="08:00">08:00</option> 
<option value="08:20">08:20</option> 
<option value="08:40">08:40</option> 
<option value="09:00">09:00</option> 
<option value="09:20">09:20</option> 
<option value="09:40">09:40</option> 
<option value="10:00">10:00</option> 
<option value="10:20">10:20</option> 
<option value="10:40">10:40</option> 
<option value="11:00">11:00</option> 
<option value="11:20">11:20</option> 
<option value="11:40">11:40</option> 
<option value="12:00">12:00</option> 
<option value="12:20">12:20</option> 
<option value="12:40">12:40</option> 
<option value="13:00">13:00</option> 
<option value="13:20">13:20</option> 
<option value="13:40">13:40</option> 
<option value="14:00">14:00</option> 
<option value="14:20">14:20</option> 
<option value="14:40">14:40</option> 
<option value="15:00">15:00</option> 
<option value="15:20">15:20</option> 
<option value="15:40">15:40</option> 
<option value="16:00">16:00</option> 
<option value="16:20">16:20</option> 
<option value="16:40">16:40</option> 
<option value="17:00">17:00</option> 
<option value="17:20">17:20</option> 
<option value="17:40">17:40</option> 
<option value="18:00">18:00</option> 
<option value="18:20">18:20</option> 
<option value="18:40">18:40</option> 
<option value="19:00">19:00</option> 
<option value="19:20">19:20</option> 
<option value="19:40">19:40</option> 
<option value="20:00">20:00</option> 
<option value="20:20">20:20</option> 
<option value="20:40">20:40</option> 
<option value="21:00">21:00</option> 
<option value="21:20">21:20</option> 
<option value="21:40">21:40</option> 
<option value="22:00">22:00</option> 
<option value="22:20">22:20</option> 
<option value="22:40">22:40</option> 
<option value="23:00">23:00</option> 
<option value="23:20">23:20</option> 
<option value="23:40">23:40</option> 
				</select>	
			</td>
		</tr>

		<tr class='classTableRow' >
			<td class='classTableData' colspan='2'>
				Clinic:
				<select name='apptClinic' id='idApptClinic' onchange="fSearchClinicTime();" class='classSelectBox' style="margin-bottom: 4px;">
				<!-- <option value="">All Clinic</option> -->
					<option value='2'>Volta Regional Hospital</option>				</select>
			</td>
		</tr>

		
	    	            <tr class='classTableRow' >
	                <td class='classTableData' colspan='2'>
	                    Schedule Duration
	                    <select name='apptDuration' id='idApptDuration' class='classSelectBox' style="margin-bottom: 4px;">
	                        <option value='10'>10 Minutes</option><option value='15'>15 Minutes</option><option value='20'>20 Minutes</option><option value='30'>30 Minutes</option><option value='40'>40 Minutes</option><option value='45'>45 Minutes</option><option value='50'>50 Minutes</option><option value='60'>60 Minutes</option><option value='70'>70 Minutes</option><option value='75'>75 Minutes</option><option value='80'>80 Minutes</option><option value='90'>90 Minutes</option><option value='100'>100 Minutes</option><option value='105'>105 Minutes</option><option value='110'>110 Minutes</option><option value='120'>120 Minutes</option>	                    </select>

	                    <script type="text/javascript"> 
	                        // Set default timeslot as the default value
	                        $('#idApptDuration').val(20);
	                    </script>
	                </td>
	            </tr>
	            

		<tr class='classTableRow' >
			<td class='classTableData'  colspan='3' >
				<hr style="margin: 4px 4px 4px 0;">
			</td>
		</tr>

		<tr class='classTableRow' >
			<td class='classTableData'  colspan='3' style='font-size:12px'>
				<b>Patient Search </b>
			</td>
		</tr>

					<tr class='classTableRow' >
				<td class='classTableData' >Patient No.:</td>
				<td class='' colspan='2'>
					<input  class='classInputTextM' type='text' name='Regno' id='Regno' value="" size="10" />
					<img alt='' title='Click to Search via Patient No.' src='images/ico-browse64.png' onclick="fSearchPatient();" style='vertical-align:middle;cursor:pointer;' width='21' height='21' />
				</td>
			</tr>
				
			<tr class='classTableRow' >
				<td class='classTableData' >Patient Name:</td>
				<td class='' colspan='2' >
					<input  class='classInputTextM' type='text' name='spatient' id='spatient' autocomplete="off" value=""  />
					<img alt='' title='Click to Search via Patient Name(Partial Searches Permitted)' src='images/ico-browse64.png' onclick="fSearchPatient();" style='cursor:pointer;' width='21' height='21' />
				</td>
			</tr>

			<tr class='classTableRow' >
				<td class='classTableData' >Patient Mobile No:</td>
				<td class='' colspan='2' >
					<input  class='classInputTextM' type='text' name='sPatientMobile' id='sPatientMobile' autocomplete="off"  />
					<img alt='' title='Click to Search via Patient Mobile No' src='images/ico-browse64.png' onclick="fSearchPatient();" style='cursor:pointer;' width='21' height='21' />
		 		</td>
		 	</tr>

		 				 	<tr class='classTableRow' >
					<td class='classTableData' >Patient MOH No</td>
					<td class='' colspan='2' >
						<input  class='classInputTextM' type='text' name='sPatientUnique' id='sPatientUnique' autocomplete="off"  />
						<img alt='' title='Click to Search via Patient MOH No' src='images/ico-browse64.png' onclick="fSearchPatient();" style='cursor:pointer;' width='21' height='21' />
			 		</td>
			 	</tr>

		 	
		 	<tr class='classTableRow' >
				<td class='classTableData' >Patient NHIA No:</td>
				<td class='' colspan='2' >
					<input  class='classInputTextM' type='text' name='idNHIANo' id='idNHIANo'/>
					<img alt='' title='Click to Search via Patient NHIA No' src='images/ico-browse64.png' onclick="fSearchPatient();" style='cursor:pointer;' width='21' height='21' />
		 		</td>
		 	</tr>

		 	
			<tr class='classTableRow' >
				<td class='classTableData' >Patient UIN No.:</td>
				<td class='' colspan='2' >
					<input  class='classInputTextM' type='text' name='idUINNo' id='idUINNo'/>
					<img alt='' title='Click to Search via Patient UIN No.' src='images/ico-browse64.png' onclick="fSearchPatient();" style='cursor:pointer;' width='21' height='21' />
		 		</td>
		 	</tr>
			
		<tr class='classTableRow' >
			<td class='classTableData'  colspan='4' style='font-size:12px'>
				<b>Patient Search Results</b>
			</td>
		</tr>

		<tr class='classTableRow' >
			<td class='classTableData'  colspan='3' >
				<div class='classDivStyle classListing'  id='idPatientNameListing' style='height:125px;overflow:auto;margin-right:10px;border:1px #eee solid;background-color: #FFF'>&nbsp;</div>
			</td>
		</tr>
	</table> 

	<div class='classDivStyle classModalContainerBlock'  id='pat_search' style='width:350px;display:none;float:right;border-left:thin #cccccc solid;'>
		<table class='classTableFormat'  align='left' >
			<tr class='classTableRow' >
				<td class='classTableData'  colspan='3' >
					<h3>Patient Search&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a  class='classLink' href=# onclick="showPatient1();">[X]</a> </h3>
				</td>
			</tr>

			<tr class='classTableRow' >
				<td class='classTableData' >Patient Name:</td>
				<td class='classTableData' >
					<input  class='classTextBox' type='text' name='spatient1' id='spatient1' value=""  />
				</td>
				<td class='classTableData' >
					<img alt='' src='images/search.jpg' onclick="search_patient1();" style='cursor:pointer;' width='21' height='21' >
				</td>
			</tr>

			<tr class='classTableRow' >
				<td class='classTableData'  colspan='3' >
					<hr>
				</td>
			</tr>

			<tr class='classTableRow' >
				<td class='classTableData'  colspan='4' style='font-size:12px'>
					<b>Patient Search Result </b>
				</td>
			</tr>

			<tr class='classTableRow' >
				<td class='classTableData'  colspan='3' >
					<div class='classDivStyle'  id='pname1' style='height:185px;overflow:auto;'>&nbsp;</div>
				</td>
			</tr>
		</table>
	</div>

	<div class='classDivStyle'  id='pinfo' style="float:left;width:50%;">
		<table class='classTableFormat' border='0' align="left">
			<tr class='classTableRow' >
				<td class='classTableData'  colspan='7' style='font-size:12px'>
					<b>Patient Information</b>
				</td>
			</tr>
			<input type='hidden' name='patientId' id='idPatientID' value=""  />
			<input type='hidden' name='idMembershipTypeID' id='idMembershipTypeID' value=""  />
			<input type='hidden' name='patientId' id='idPatientIDAddAppointment' value=""  />
			<input type='hidden' name='idPatientAgeInYears' id='idPatientAgeInYears' value=""  />
			
			<tr class='classTableRow' >
				<td class='classTableData' colspan="3">
					Patient No. <input class='classInputTextM' type='text' name='regno' id='idSMPatientNo' value='' size='20'  readonly='readonly'  />
				</td>
				<td id="idImage">
					<span style='float:left;margin-left:20px;padding-bottom:10px;width:50px;height:50px'; ></span>
				</td>
			</tr>

			<tr class='classTableRow' >
				<td class='classTableData' >Name <span id='mandatory'>*</span></td>
				<td class='classTableData' colspan="4">
					<input class='classInputTextXS' type='text' name='fname' id='idFirstName' placeholder='First' readonly='readonly'/>
											&nbsp;&nbsp;
						<input class='classInputTextXS' type='text' name='mname' id='idMiddleName' placeholder='Middle' readonly='readonly'/>
											&nbsp;&nbsp;
					<input class='classInputTextXS' type='text' name='lname' id='idLastName' placeholder='Last' readonly='readonly'/>
				</td>	
			</tr>

			<tr class='classTableRow' >
				<td class='classTableData' >Date Of Birth<span class='classMandatorySign'>*</span></td>
				<td class='classTableData' colspan='5' width="400">
					<input class='classInputTextXS' type='text' name='dob' id='idDOB' value='' readonly='readonly' size="10" />
					<input  class='classInputTextXXS' type='text' name='age' palceholder='Age' id='idAge' size='2' readonly='readonly'/>
					<span id="idDisplayYearLabel" style="display: inline;">Yrs.</span><span id="idDisplayWeekLabel" style="display: none;">Weeks.</span>
					&nbsp;&nbsp;Sex  &nbsp;
					<select  class='span2' name='sex' id='idSex' disabled="disabled" style="width: 115px;">
						<option value='' selected></option>
						<option value='Female'> Female</option>
						<option value='Male'>Male</option>
						<option value='Indeterminate'>Indeterminate</option>
						
					</select>
				</td>
			</tr>

			<tr class='classTableRow' ></tr>

			<tr class='classTableRow' >
				<td class='classTableData' >Address</td>
				<td class='classTableData'  colspan='3' >
					<textarea class='classTextArea' name='address' id='idAddress' cols='45' rows='' readonly='readonly'></textarea>
				</td>
			</tr>

			<tr class='classTableRow' >				
				<td class='classTableData' >City</td>
				<td class='classTableData' >
					<select class='span2' name='city' id='idCity' readonly='readonly' style="width:80%;">
					</select>
				</td>
				<td class='classTableData hidden' >ZIP Code </td>
				<td class='classTableData hidden' >
					<input class='classInputTextM' type='text' name='pin' id='idPincode' readonly='readonly'/>
				</td>
			</tr>

			<tr class='classTableRow' >
				<td class='classTableData' >State</td>
				<td class='classTableData'>
					<input class='classInputTextM' type='text' name='state' id='idState' readonly='readonly'/>
				</td>
				<td class='classTableData' >Country</td>
				<td class='classTableData'>
					<input class='classInputTextM' type='text' name='country' id='idCountry' readonly='readonly' placeholder="Enter 3 characters" autocomplete="off" size='20'/>
                    <div class='classSuggestionBoxList classDivStyle' id='idDisplayCountryList' style="width:15%;"></div>
				</td>
			</tr>

			<tr class='classTableRow' >
				<td class='classTableData' >Phone</td>
				<td class='classTableData' >
					<input  class='classInputTextM' type='text' name='hphone' id='idPhone' readonly='readonly'/>
				</td>
				<td class='classTableData'>NHIA No.</td>
				<td class='classTableData'>
					<input type="text" class='span2 classInputTextS' name='patientNhiaNo' id='idPatientNHIANo'><a class="badge badge-danger classOPDPatientNHIAUnconfirmedStatusContainer" style="background-color:#af3c3c;color:#fff;cursor:default;display: none;" title="Unverified NHIA Patient">U</a>
				</td>
			</tr>
			<tr class='classTableRow' >
				<td class='classTableData' >Mobile </td>
				<td class='classTableData' >
					<input  class='classInputTextM' type='text' name='mobile' id='idMobile' readonly='readonly'/>
				</td>

				<td class='classTableData' >Email </td>
				<td class='classTableData' colspan="3">
					<input  class='classInputText' type='text' name='email' id='idEmail'  size="40" readonly='readonly'/>
				</td>
			</tr>
						<tr class='classTableRow classHidden' >
				<td class='classTableData' >Occupation </td>
				<td class='classTableData' >
					<select  class='span2' name='occupation' id='idOccupation' disabled="disabled" style="width: 115px;"></select>
				</td>

				<td class='classTableData' >Education </td>
				<td class='classTableData' colspan="3">
					<select  class='span2' name='education' id='idEducation' disabled="disabled" style="width: 115px;"></select>
				</td>
			</tr>
			<tr class='classTableRow classHidden' >
				<td class='classTableData' >Marital Status </td>
				<td class='classTableData' >
					<select  class='span2' name='maritalStatus' id='idMaritalStatus' disabled="disabled" style="width: 115px;">
 					                            <option value="">Select Any</option>
                                                        <option value="Never Married">Never Married</option>
                                                        <option value="Married">Married</option>
                                                        <option value="Widowed">Widowed</option>
                                                        <option value="Divorced">Divorced</option>
                                                        <option value="Legally separated">Legally separated</option>
                                                        <option value="Annulled">Annulled</option>
                                                        <option value="Domestic partner">Domestic partner</option>
                                                        <option value="Interlocutory">Interlocutory</option>
                                                        <option value="Polygamous">Polygamous</option>
                                                        <option value="Single">Single</option>
                                                        <option value="Child">Child</option>
                            					</select>
				</td>
			</tr>
			<tr class='classTableRow classHidden' >
				<td class='classTableData' colspan="4">
					<u><i>Emergency Contact</i></u>
				</td>
			</tr>

			<tr class='classTableRow classHidden' >
				<td class='classTableData' >Name</td>
				<td class='classTableData' >
					<input  class='classInputTextM' type='text' name='relativeName' id='idEmergencyName' readonly='readonly'/>
				</td>
				<td class='classTableData' width="60">Number</td>
				<td class='classTableData' >
					<input  class='classInputTextM' type='text' name='relativeNumber' id='idEmergencyNo' readonly='readonly'/>
				</td>
			</tr>

			<tr class='classTableRow classHidden'>
				<td class='classTableData' >Relation</td>
				<td class='classTableData' >
					<select  class='span2' name='relation' id='idRelative' disabled="disabled" style="width: 115px;">
                        <option value=''>Select</option>
                        <option value='Mother'>Mother</option>
                        <option value='Father'>Father</option>
                        <option value='Sister'>Sister</option>
                        <option value='Brother'>Brother</option>
                        <option value='Spouse'>Spouse</option>
                        <option value='Son'>Son</option>
                        <option value='Daughter'>Daughter</option>
                        <option value='Other'>Other</option>
                    </select>
				</td>
			</tr>
		</table>
	</div>
</div>

<!-- Tele Consultation -->
<div class="modal hide fade" id="idTeleConsultationModel" role="dialog">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">				
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="myModalLabel">Set Tele Consultation</h4>
			</div>
			<div class="modal-body form-horizontal">
				<div class="control-group">
		            <label class="control-label classLabel">Patient Name</label>
		            <div class="controls">
		                <input class='classInputText' type='text' id='idTeleConsultationPatientName' autocomplete="off" size='20' value='' onkeyup="fGenerateAutoPatientsForTeleConsultation(this.value);" />
  						<input type='hidden' id='idTeleConsultationPatientID' />
  						<div class='classSuggestionBoxList classDivStyle' id='idTeleConsultationDisplayPatientList' style="width:28%;"></div>
  						<p class='classSpanData'  style='font-size:12px'>(Enter minimum 3 characters)</p>
		            </div>
		        </div>

		        <div class="control-group">
		            <label class="control-label classLabel">Patient No.</label>
		            <div class="controls">
		               <input class='classInputText' type='text' id='idTeleConsultationPatientNo' value='' size='20' onkeyup="fGenerateAutoPatientNosForTeleConsultation(this.value);" />
						<div class='classSuggestionBoxList classDivStyle' id='idTeleConsultationDisplayPatientNoList' style="width:28%;"></div>
  						<p class='classSpanData'  style='font-size:12px'>(Enter minimum 3 characters)</p>
		            </div>
		        </div>

		        <div class="control-group">
		            <label class="control-label classLabel">Doctor</label>
		            <div class="controls">
		            	<select id="idTeleConsultationDoctorList">
		            		<option value="">Select</option>
		            	</select>
		            </div>
		        </div>

		        <div class="control-group">
		            <label class="control-label classLabel">Date</label>
		            <div class="controls">
		               <input class='classInputTextS' type='text' id='idTeleConsultationDate' readonly />
		            </div>
		        </div>

		        <div class="control-group">
		            <label class="control-label classLabel">Time</label>
		            <div class="controls">
		            	<select id="idTeleConsultationTime">
		            		<option value="00:00">00:00</option> 
<option value="00:20">00:20</option> 
<option value="00:40">00:40</option> 
<option value="01:00">01:00</option> 
<option value="01:20">01:20</option> 
<option value="01:40">01:40</option> 
<option value="02:00">02:00</option> 
<option value="02:20">02:20</option> 
<option value="02:40">02:40</option> 
<option value="03:00">03:00</option> 
<option value="03:20">03:20</option> 
<option value="03:40">03:40</option> 
<option value="04:00">04:00</option> 
<option value="04:20">04:20</option> 
<option value="04:40">04:40</option> 
<option value="05:00">05:00</option> 
<option value="05:20">05:20</option> 
<option value="05:40">05:40</option> 
<option value="06:00">06:00</option> 
<option value="06:20">06:20</option> 
<option value="06:40">06:40</option> 
<option value="07:00">07:00</option> 
<option value="07:20">07:20</option> 
<option value="07:40">07:40</option> 
<option value="08:00">08:00</option> 
<option value="08:20">08:20</option> 
<option value="08:40">08:40</option> 
<option value="09:00">09:00</option> 
<option value="09:20">09:20</option> 
<option value="09:40">09:40</option> 
<option value="10:00">10:00</option> 
<option value="10:20">10:20</option> 
<option value="10:40">10:40</option> 
<option value="11:00">11:00</option> 
<option value="11:20">11:20</option> 
<option value="11:40">11:40</option> 
<option value="12:00">12:00</option> 
<option value="12:20">12:20</option> 
<option value="12:40">12:40</option> 
<option value="13:00">13:00</option> 
<option value="13:20">13:20</option> 
<option value="13:40">13:40</option> 
<option value="14:00">14:00</option> 
<option value="14:20">14:20</option> 
<option value="14:40">14:40</option> 
<option value="15:00">15:00</option> 
<option value="15:20">15:20</option> 
<option value="15:40">15:40</option> 
<option value="16:00">16:00</option> 
<option value="16:20">16:20</option> 
<option value="16:40">16:40</option> 
<option value="17:00">17:00</option> 
<option value="17:20">17:20</option> 
<option value="17:40">17:40</option> 
<option value="18:00">18:00</option> 
<option value="18:20">18:20</option> 
<option value="18:40">18:40</option> 
<option value="19:00">19:00</option> 
<option value="19:20">19:20</option> 
<option value="19:40">19:40</option> 
<option value="20:00">20:00</option> 
<option value="20:20">20:20</option> 
<option value="20:40">20:40</option> 
<option value="21:00">21:00</option> 
<option value="21:20">21:20</option> 
<option value="21:40">21:40</option> 
<option value="22:00">22:00</option> 
<option value="22:20">22:20</option> 
<option value="22:40">22:40</option> 
<option value="23:00">23:00</option> 
<option value="23:20">23:20</option> 
<option value="23:40">23:40</option> 
		            	</select>
		            </div>
		        </div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary" id="idAddTeleConsultation">Add</button>
			</div>
		</div>
	</div>
</div>

<script>
    $(document).ready(function() {
    	var sDoctorLabel = 'Doctor';
    	var iLoginScreen = '0';
    	$("#idTeleConsultationModel").appendTo('body');

    	$('.classPatientGlobalSearchTbl').DataTable({
			"bSearchable": false,
			"bLengthChange": false,
			"bFilter": false,
			"bInfo": false,
			'iDisplayLength': 10,
			"aLengthMenu": [[10, 25, 50, 100, 200, -1], [10, 25, 50, 100, 200, "All"]],
			"bSort":false,
		});

		$("#idImportingGlobalPatient").on('click','.classContinueGlobalPatientImport',function(){
			$('#idImportingGlobalPatient').modal('hide');
			$('#idSerachPatientModal').modal('show');
		});

    	$("#idPatientGlobalSearchTbl").on('click','.classImportPatient',function(){
		    var iRowID = $(this).attr('id');
		    var iID = iRowID.split("_").pop();

		    $.ajax({
				url: "ajaxEhr.php?sFlag=ImportGloablPatient&iPatientGlobalID="+iID,
				asyn: true,
				beforeSend: function() {
					$('#idImportingGlobalPatient').modal('show');
					$('#idLoadingModalGlobelPatientImport').show();
		    		$('#idSerachGlobalPatientModal').modal('hide');

				},
				success: function (data){
					if(data != false) {
						fSearchPatient(false); // Reseach without reseting selected patient
						fSetPatientData(data);
						$('#idLoadingModalGlobelPatientImport').hide();
						$('#idPatientImportedSuccessfully').show();
		    			$('#idContinueGlobalPatientImport').show();
		    			$('#idSerachGlobalPatientModal').modal('hide');
					}
					else {
						alert('Error while importing global patient');
					}
				},
				complete: function() {
					$('#idLoadingModalGlobelPatientImport').css('display','none');
	                $('#idLoadingModalGlobelPatientImport').next().css('display','block');
	                $('#idContinueGlobalPatientImport').css('display','inline');
				}
			});


		});


    	$('.classFormFormat').on('click','#idSearchPatientGlobalSearch',function(){
    		var sPatientNoString = $('.classFormFormat #Regno').val();
    		var sPatientNameString = $('.classFormFormat #spatient').val();
    		var sPatientMobileNoString = $('.classFormFormat #sPatientMobile').val();
    		var sPatientAdharNo = $('.classFormFormat #sPatientUnique').val();
    		var sPatientNHIANo = $('.classFormFormat #idNHIANo').val();

			var sType = "";
    		if(sPatientNameString != '')
			{
    			$('#idSerachGlobalPatientModal #idPatientString').val(sPatientNameString);
				sType = "sPatientName";
    		}
			else if(sPatientNoString != ''){
    			$('#idSerachGlobalPatientModal #idPatientString').val(sPatientNoString);
				sType = "sPatientNo";
    		}
			else if(sPatientMobileNoString != ''){
    			$('#idSerachGlobalPatientModal #idPatientString').val(sPatientMobileNoString);
				sType = "sPatientPhone";
    		}
			else if(sPatientAdharNo != ''){
    			$('#idSerachGlobalPatientModal #idPatientString').val(sPatientAdharNo);	
				sType = "sUniqueNo1";
    		}
			else if(sPatientNHIANo != ''){
				$('#idSerachGlobalPatientModal #idPatientString').val(sPatientNHIANo);	
				sType = "sUniqueNo2";
    		}			
			else{
				sType = "sUniversalSearch";
	   		}
    		var sSearchStringPat = $('#idPatientString').val() ? $.trim($('#idPatientString').val()) : '';
			var sSearchStringType = sType;

			$('#idSerachGlobalPatientModal #idPatientSearchType').val(sType);	

    		if(sSearchStringPat != '' && sSearchStringType != '' ){
	    		fSearchGlobalPatient(sSearchStringPat,sSearchStringType);
    		}
    		$('#idSerachPatientModal').modal('hide');
			$("#idSerachGlobalPatientModal").modal("show");

            $('#idLoadingModalGlobelSearch').css('display','none');  
            $('.classDivShowGlobalPatientResult').css('display','block');  
            
		});

		$('.classSearchGlobalPatientModalBody').on('click','#idSearchPatientGlobal',function(){
			$('#idLoadingModalGlobelSearch').css('display','block');  
    		window.setTimeout(function() {
	    		var sSearchStringPat = $('#idSerachGlobalPatientModal #idPatientString').val() ? $.trim($('#idSerachGlobalPatientModal #idPatientString').val()) : '';
				var sSearchStringType = $('#idSerachGlobalPatientModal #idPatientSearchType').val() ? $.trim($('#idSerachGlobalPatientModal #idPatientSearchType').val()) : '';
	    		if(sSearchStringPat != '' && sSearchStringType != '' ){
		    		fSearchGlobalPatient(sSearchStringPat,sSearchStringType);
	    		}else{
	    			alert('Please enter something to search');
					$('#idLoadingModalGlobelSearch').css('display','none');  
	    			return false;
	    		}
                $('#idLoadingModalGlobelSearch').css('display','none');  
                $('.classDivShowGlobalPatientResult').css('display','block');  
            }, 0);

		});

		function fSearchGlobalPatient(sPatientNameStr,sSearchType){
			$.ajax({
				url: "ajaxEhr.php?sFlag=SearchGlobalPatient&sPatientNameStr="+sPatientNameStr+"&sSearchType="+sSearchType,
				asyn: false,
				beforeSend: function() {
                    $.LoadingOverlay("show");
                },
				success: function (data){
					var sTemplate = '';
					if($.trim(data) != false) {
						var aPatientDetails = data;
						var iSrNo = 1;
						for(var iii = 0; iii<aPatientDetails.length; iii++){

							iPatientID = aPatientDetails[iii]['iGlobalPatientID'] == null ? "N/A" : aPatientDetails[iii]['iGlobalPatientID'];
							sPatientName = aPatientDetails[iii]['sPatientName'] == null ? "N/A" : aPatientDetails[iii]['sPatientName'];
							sPatientNo = aPatientDetails[iii]['sPatientNo'] == null ? "N/A" : aPatientDetails[iii]['sPatientNo'];
							sPatientMobile = aPatientDetails[iii]['sPhoneNo'] == null ? "N/A" : aPatientDetails[iii]['sPhoneNo'];
							sPatientEmail = aPatientDetails[iii]['sEmail'] == null ? "N/A" : aPatientDetails[iii]['sEmail'];
							sPatientUniqueNo = aPatientDetails[iii]['sUniqueNo1'] == null ? "N/A" : aPatientDetails[iii]['sUniqueNo1'];
							sPatientNHIANo = aPatientDetails[iii]['sUniqueNo2'] == null ? "N/A" : aPatientDetails[iii]['sUniqueNo2'];
							sPatientDOB = aPatientDetails[iii]["dDOB"] == null ? "N/A" : aPatientDetails[iii]["dDOB"];
							iPatientAge = aPatientDetails[iii]["iAge"] == null ? "N/A" : aPatientDetails[iii]["iAge"];
							sPatientFirstName = aPatientDetails[iii]["sPatientFName"] == null ? "N/A" : aPatientDetails[iii]["sPatientFName"];
							sPatientMiddleName = aPatientDetails[iii]["sPatientMName"] == null ? "N/A" : aPatientDetails[iii]["sPatientMName"];
							sPatientLastName = aPatientDetails[iii]["sPatientLName"] == null ? "N/A" : aPatientDetails[iii]["sPatientLName"];
							sPatientGender = aPatientDetails[iii]["sGender"] == null ? "N/A" : aPatientDetails[iii]["sGender"];
							sPatientCity = aPatientDetails[iii]["sCity"] == null ? "N/A" : aPatientDetails[iii]["sCity"];
							sPatientState = aPatientDetails[iii]["sState"] == null ? "N/A" : aPatientDetails[iii]["sState"];
							sPatientCountry = aPatientDetails[iii]["sCountry"] == null ? "N/A" : aPatientDetails[iii]["sCountry"];
							sPincode = aPatientDetails[iii]["sPincode"] == null ? "N/A" : aPatientDetails[iii]["sPincode"];

							sTemplate += '<tr class="classPatientData" id="idPatientData_'+iPatientID+'">';
							sTemplate += '<td id="idSrNo_'+iPatientID+'">'+iSrNo+'</td>';
							sTemplate += '<td id="idPatientName_'+iPatientID+'">'+sPatientName+'</td>';
							sTemplate += '<td id="idPatientNo_'+iPatientID+'">'+sPatientNo+'</td>';
							sTemplate += '<td id="idPatientMobile_'+iPatientID+'">'+sPatientMobile+'</td>';
							sTemplate += '<td id="idPatientEmail_'+iPatientID+'">'+sPatientEmail+'</td>';
							sTemplate += '<td class="" id="idPatientDOB_'+iPatientID+'">'+sPatientDOB+'</td>';
							sTemplate += '<td class="" id="idPatientGender_'+iPatientID+'">'+sPatientGender+'</td>';
							sTemplate += '<td id="idPatientUniqueNo_'+iPatientID+'">'+sPatientUniqueNo+'</td>';
							sTemplate += '<td id="idPatientNHIANo_'+iPatientID+'">'+sPatientNHIANo+'</td>';
							sTemplate += '<td class="classHidden" id="idPatientAge_'+iPatientID+'">'+iPatientAge+'</td>';
							sTemplate += '<td class="classHidden" id="idPatientFName_'+iPatientID+'">'+sPatientFirstName+'</td>';
							sTemplate += '<td class="classHidden" id="idPatientMName_'+iPatientID+'">'+sPatientMiddleName+'</td>';
							sTemplate += '<td class="classHidden" id="idPatientLName_'+iPatientID+'">'+sPatientLastName+'</td>';
							sTemplate += '<td class="classHidden" id="idPatientCity_'+iPatientID+'">'+sPatientCity+'</td>';
							sTemplate += '<td class="classHidden" id="idPatientState_'+iPatientID+'">'+sPatientState+'</td>';
							sTemplate += '<td class="classHidden" id="idPatientCountry_'+iPatientID+'">'+sPatientCountry+'</td>';
							sTemplate += '<td class="classHidden" id="idPatientPincode_'+iPatientID+'">'+sPincode+'</td>';
							sTemplate += '<td><button class="btn btn-success classImportPatient" id="idImportPatient_'+iPatientID+'" name="idImportPatient">Import</button></td>';
							sTemplate += '</tr>';
							iSrNo++;
						}

						$('#idPatientGlobalSearchTbl #idPatientGlobalSearchBody').html(sTemplate);

					}else{
						sTemplate += '<tr>';
						sTemplate += '<td></td>';
						sTemplate += '<td></td>';
						sTemplate += '<td></td>';
						sTemplate += '<td></td>';
						sTemplate += '<td>No Data Found</td>';
						sTemplate += '<td></td>';
						sTemplate += '<td></td>';
						sTemplate += '<td></td>';
						sTemplate += '</tr>';
						$('#idPatientGlobalSearchTbl #idPatientGlobalSearchBody').html(sTemplate);
					}
				},
                complete: function() {
                    $.LoadingOverlay("hide");
                }
			});
		}

    	//! brief function to generate auto patient list
		window.fGenerateAutoPatientsForTeleConsultation = function (sPatientNameStr){

        	if(sPatientNameStr.length >= 3){

				$.ajax({
					url: "ajaxEhr.php?sFlag=SearchPatient&sPatientNameStr="+sPatientNameStr+"&iIsWellnewssProvider=0&iStaffClinicID=2&iStaffID=411&iUserTypeID=11",
					asyn: false,
					success: function (data){

						if($.trim(data) != false) {

							var oTempData = $.parseJSON(data);
							var sData = '';
							var iPatientID;
							var sPatientName;

							for(var iii=0;iii<oTempData.length;iii++){

							iPatientID = oTempData[iii]['patient_id'];
							sPatientName = oTempData[iii]['patient_name'];
							var sNewPatientName = escapeQuote(sPatientName);
							sPatientNo = oTempData[iii]['patient_no'];

							sData += "<li onClick=\"fAddToTextTeleConsultationTextBox('"+sNewPatientName+"','"+iPatientID+"','"+sPatientNo+"');\">"+sPatientName+"</li>";

							}

							$('#idTeleConsultationDisplayPatientList').html(sData).slideDown();

						}else{
							$('#idTeleConsultationDisplayPatientList').hide();
						}
					}
				});
	        }else{
	        	$('#idTeleConsultationDisplayPatientList').hide();
	        }
	    }

	    //! brief function to generate auto patient list
		window.fGenerateAutoPatientNosForTeleConsultation = function (sPatientNoStr){

        	if(sPatientNoStr.length >= 3){

				$.ajax({
					url: "ajaxEhr.php?sFlag=SearchPatientFromModal&sPatientNoStr="+sPatientNoStr+"&iIsWellnewssProvider=0&iStaffClinicID=2&iStaffID=411&iUserTypeID=11",
					asyn: false,
					success: function (data){

						if($.trim(data) != false) {

							var oTempData = $.parseJSON(data);
							var sData = '';
							var iPatientID;
							var sPatientNo;

							for(var iii=0;iii<oTempData.length;iii++){

							iPatientID = oTempData[iii]['patient_id'];
							sPatientNo = oTempData[iii]['patient_no'];
							sPatientName = oTempData[iii]['patient_name'];
							var sNewPatientName = escapeQuote(sPatientName);

							sData += "<li onClick=\"fAddToTextTeleConsultationTextBox('"+sNewPatientName+"','"+iPatientID+"','"+sPatientNo+"');\">"+sPatientName+"</li>";

							}

							$('#idTeleConsultationDisplayPatientNoList').html(sData).slideDown();

						}else{
							$('#idTeleConsultationDisplayPatientNoList').hide();
						}
					}
				});
	        }else{
	        	$('#idTeleConsultationDisplayPatientNoList').hide();
	        }
	    }

	     //! brief function to set patient name and id
	    window.fAddToTextTeleConsultationTextBox = function (sPatientName,iPatientID){

	    	sPatientName = unescapeQuote(sPatientName);

			$('#idTeleConsultationPatientName').val(sPatientName);
			$("#idTeleConsultationPatientID").val(iPatientID);
			$('#idTeleConsultationPatientNo').val(sPatientNo);

			$('#idTeleConsultationDisplayPatientList').hide();
			$('#idTeleConsultationDisplayPatientNoList').hide();

			loadTeleConsultationDoctorList(iPatientID);
		}

		// Load New Doctor lists
		function loadTeleConsultationDoctorList (iPatientID) {
			$doctorList = $("#idTeleConsultationDoctorList");


			$doctorList.find('option[value!=""]').remove();

			$.get('ajaxEhr.php', {
				sFlag: "getDoctorListForPatient",
				iPatientID: iPatientID
			}, function(data) {
				if(data.length == 0){
					alert("No "+sDoctorLabel+" available for selected Patient.");
				} else {
					$.each(data, function(index, doctor) {
						$doctorList.append('<option value="'+doctor.staff_id+'">'+doctor.staff_name+'</option>');
					});
				}
			});
		}

		$('#idTeleConsultationDate').datepicker({
            dateFormat: 'dd-mm-yy',
            showOn: "button",
            buttonImage: "images/Calendar-icon.png",
            buttonImageOnly: true
        });

        $("#idAddTeleConsultation").on('click', function(event) {
        	event.preventDefault();
        	var iPatientID = $("#idTeleConsultationPatientID").val(),
        		iDoctorID =  $("#idTeleConsultationDoctorList").val(),
        		sDate = $("#idTeleConsultationDate").val(),
        		sTime = $("#idTeleConsultationTime").val();

        	if(iPatientID == ""){
        		alert("Select Patient for Tele Consultation.");
        		return false;
        	} else if(iDoctorID == ""){
        		alert("Select "+sDoctorLabel+" for Tele Consultation.");
        		return false;
        	} else if(sDate == ""){
        		alert("Select Date for Tele Consultation.");
        		return false;
        	} else if(sTime == ""){
        		alert("Select Time for Tele Consultation.");
        		return false;
        	}

        	$.post('addTeleConsultationEmulator.php', {
        		iPatientID: iPatientID,
        		iDoctorID: iDoctorID,
        		sDate: sDate,
        		sTime: sTime 
        	}, function(data) {
        		var iScheduleID = data.schedule_id;
        			iServiceID = data.service_id;

        		if(iScheduleID){
        			window.location.href="gotoStudy.php?schedule_id="+iScheduleID+"&service_id="+iServiceID;
        		} else {
					alert("There was error adding Tele Consultation.");
        		}
        	});
        });

        //! If enter is pressed while in focus, search it		
		$('#spatient, #Regno, #sPatientMobile, #sPatientUnique, #idPatientUniversalSearch, #idUINNo').keypress(function(e) {
		    if(e.which == 13 && $(this).val() != "") {
		       	fSearchPatient();
		    }
		});

		/*if(iLoginScreen == 0){
			//call clinic time function
			setTimeout(function(){
				fSearchClinicTime();
			}, 300);
		}*/
	});

	function isPatientAvailableForSchedule(iPatientId,dScheduleDate,tScheduleTime,iApptDuration){

		let bPatientAvailable = true;

		$.ajax({
			url:"ajaxBulkAppointments.php?sFlag=checkPatientAvailableForSchedule",
			data:{iPatientId:iPatientId,dDate:dScheduleDate,tTime:tScheduleTime,iServiceDuration:iApptDuration},
			async:false,
			success:function(data){
				bPatientAvailable = data;
			}
		});

		return bPatientAvailable;

	}

	function childContainsMothersInsurance(iPatientID){
		var bHasMothersInsurance = false;

		$.ajax({
			url:"ajaxEhr.php?sFlag=isChildContainsMothersInsurance",
			data:{iPatientID:iPatientID},
			async:false,
			success:function(data){
				bHasMothersInsurance = data.bResult;
			}
		});

		return bHasMothersInsurance;
	}
</script>			</form>
	</div>
	</div>
	<div class="modal-footer classDashboardModalFooter">
		<div id='divButton' align='center' style="width:100%;float:left;margin-top:10px;margin-bottom:5px;">
			<div style="float:right;">
				<input class='btn btn-warning classAddNewPatientButton' type='button' value='Add Visit For New Patient' id='idAddNewPatient' name='addNewPatient' style='float:left;'/>
									<input class='btn btn-info classUpdatePatientButton' type='button' value='Add Visit By Updating Patient Details' id='idUpdatePatient' name='updatePatient' disabled />
								<input class='btn btn-primary' type='button' value='Add Patient Visit' id='idSubmitPatientRegistration' name='patient_visit' onclick="fAddPatientVisit();"  />
				<input class='btn btn-primary' type='button' value='Reset' onclick="fResetPatientData();" >
				<button type="button" class="btn btn-danger btn-small" data-dismiss="modal" aria-hidden="true">Close</button>
			</div>
		</div>
		<span style='float:left;margin-left:10px;margin-top:4px; display: none'>
			<span class='classFooterAlignLeft'>Email: <a href='mailto:info@lwehs.com'>info@lwehs.com</a> | Phone: <a href='tel:1.678.510.1739'>1.678.510.1739</a></span>		</span>
	</div>
	

		

</div>


<!-- Modal for global search patient -->
<div id="idSerachGlobalPatientModal" class="modal fade hide classSearchGlobalPatientModal classLargeModal" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="myModalForSerachGlobalPatientLabel" aria-hidden="true">
	<div class="modal-header special-modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		<h3 id="myModalForSerachGlobalPatientLabel">Search Global Patient</h3>
	</div>
	<div class="modal-body classSearchGlobalPatientModalBody" style="overflow:auto;">
		<div class="text-left">
			<form class="">
				<div class="input-append">
					<select name="idPatientSearchType" id="idPatientSearchType" class="form-control" style="margin-right: 10px;">
							<option value="sPatientName"> Patient Name </option>
                            <option value="sPatientNo"> Patient Number </option>
                            <option value="sUniqueNo1"> MOH Number </option>
                            <option value="sUniqueNo2"> NHIA Number </option>
							<option value="sPatientPhone"> Patient Phone Number </option>
					</select>
					<input type="text" class='classInputTextL classPatientString span2' name='idPatientString' id='idPatientString' />
	                <input class='btn btn-success classSearchPatientGlobal' type='button' value="Search" name='idSearchPatientGlobal' id='idSearchPatientGlobal' />
				</div>
			</form>
		</div>
		<div id="idLoadingModalGlobelSearch">
           <center>
               <h4>Please wait... </h4>
               <img src="images/ajax_in_process.gif" width="70px" height="70px" ></img>
               <br /><br /><br /><br />
           </center>
        </div>


        <div class="classDivShowGlobalPatientResult" style="display:none;">
  			<table class="table table-condensed classTableView classPatientGlobalSearchTbl" id="idPatientGlobalSearchTbl">
  				<thead class='classTableHeader' id='idTableHeader'>
  					<tr>
  						<th width="">Sr No</th>
  						<th width="">Patient Name</th>
  						<th width="">Patient No.</th>
  						<th width="">Mobile</th>
  						<th width="">Email</th>
  						<th width="">DOB</th>
  						<th width="">Gender</th>
  						<th width="">MOH No</th>
  						<th width="">NHIA No</th>
  						<th width="">Import</th>
  					</tr>
  				</thead>
  				<tbody class='classPatientGlobalSearchBody' id='idPatientGlobalSearchBody'>
  					
  				</tbody>
  			</table>
	  		<div class="classNoTableData">

	  		</div>
	  	</div>
	</div>
	<div class="modal-footer classDashboardModalFooter">
		<label class="pull-left classLabel" style="margin-left: 15px; color: red; text-transform: none !important; font-size: 1.3em;"><u>Note: Use of full Patient/NHIA number in this search would help searching patients quickly.</u></label>
		<button type="button" class="btn btn-danger btn-small" data-dismiss="modal" aria-hidden="true">Close</button>
	</div>
</div>

<!--Importing Global Patient Modal-->
<div id="idImportingGlobalPatient" class="modal fade hide classImportingPatient" tabindex="-1" role="dialog" data-backdrop="static" aria-labelledby="ImportingGlobalPatientLabel" aria-hidden="true">
	<div class="modal-header special-modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
		<h3 id="idImportingGlobalPatientHeading">Importing Global Patient</h3>
	</div>
	<div class="modal-body classModalLarge">
	 	<div id="idLoadingModalGlobelPatientImport">
           <center>
               <h4> </h4>
               <img src="images/ajax_in_process.gif" width="70px" height="70px" ></img>
               <br /><br /><br /><br />
           </center>
        </div>
        <div class="classPatientImportedSuccessfully" id="idPatientImportedSuccessfully" style="display:none;">
        	<br /><br />
        	<div class="alert-success" style="font-size:15px; color:#000;"><label>Patient has been successfully imported. Patient reports and other data is being imported in the background.</label></div>
        	<div class="alert-success" style="font-size:15px; color:#000;"><label>You can continue scheduling the appointment</label></div>
        	<br /> <br / >
        </div>
	</div>
 	<div class="modal-footer">
 		<button class="btn btn-success classContinueGlobalPatientImport" id="idContinueGlobalPatientImport" style="display:none;">Continue</button>
    	<button class="btn btn-danger" data-dismiss="modal" aria-hidden="true">Close</button>
	</div>
</div>

<!--HRA Risk Factors Modal-->
<div id="idRiskFactorModal" class="modal hide classRiskFactorModal" tabindex="-1" role="dialog" data-backdrop="static" aria-labelledby="myRiskFactorsModalLabel" aria-hidden="true">
	<div class="modal-header special-modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
		<h3 id="myRiskFactorsModalLabel">HRA Risk Factors</h3>
	</div>
	<div class="modal-body classModalLarge">
	 	<table class="table table-condensed" id="idRiskFactorTable">
	 		<tbody>
	 		</tbody>
	 	</table>
	</div>
 	<div class="modal-footer">
    	<button class="btn btn-danger" data-dismiss="modal" aria-hidden="true">Close</button>
	</div>
</div>

<!--Action Plan Modal-->
<div id="idActionPlanModal" class="modal hide classActionPlanModal" tabindex="-1" role="dialog" data-backdrop="static" aria-labelledby="myActionPlanModalLabel" aria-hidden="true">
  <div class="modal-header special-modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
    <h3 id="myActionPlanModalLabel">Action Plan History</h3>
  </div>
  <div class="modal-body">
  	<div class="row-fluid">
  		<div class="span6">
  			<table class="table table-condensed" id="idPatientActionPlanTbl">
  				<thead>
  					<tr>
  						<th>Sr No</th>
  						<th>Date</th>
  						<th>Dr. Name</th>
  						<th></th>
  					</tr>
  				</thead>
  				<tbody></tbody>
  			</table>
  		</div>
  		<div class="span6">
  			<strong id="idPatientActionPlanDisplayLabel"></strong>
  			<br>
  			<textarea id="idPatientActionPlanDisplayArea" cols="30" rows="10" style="width: 100%" readonly></textarea>
  		</div>
  	</div>
  </div>
  <div class="modal-footer classActionPlanFooter">
    <button class="btn btn-danger btn-small" data-dismiss="modal" aria-hidden="true">Close</button>
  </div>
</div>
<!-- Modal for patient pending bill history -->
<div id="idModalPatientPendingBillDetails" class="modal fade hide" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="idModalPatientPendingBillDetailsLabel" aria-hidden="true" style="width: 1100px;margin-left: -530px;">
    <div class="modal-header special-modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3 id="idModalPatientPendingBillDetailsLabel">Patient Pending Bill(s)</h3>
    </div>
    <div class="modal-body classModalLarge">
        <div class="row-fluid">
        	<input type="hidden" class="classPendingBillsPatientNo" value="" />
            <table class='table table-bordered table-condensed classTableView' id='idPatientPendingBills'>
                <thead>
                    <tr class='classTableHeader'>
                        <td>#</td>
                        <td>Bill Type</td>                                          
                        <td>Bill No</td>
                        <td>Bill Date</td>
                        <td>Total Amount</td>
                        <td>Pending Amount</td>
                        <td>View</td>
                    </tr>
                </thead>
                <tbody id="idPatientPendingBillsBodyDetails"></tbody>

                <tfoot>
                  <tr>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th id="idTotalNetAmtForPatient"></th>
                    <th id="idTotalPendingAmtForPatient"></th>
                    <th></th>
                  </tr>
                </tfoot>
                
            </table>
        </div>
    </div>
    <div class="modal-footer classModalFooter">
    	<a class="btn btn-primary classExportPatientPaidUnpaidBillCardToPDF">Print All Bills (POS Format)</a>
    	<a class="btn btn-primary classExportPatientPaidUnpaidBillToPDF">Print All Bills</a>
    	<a class="btn btn-primary classExportPatientPendingBillToPDF">Print all Pending Bills</a>
        <button type="button" class="btn btn-danger" data-dismiss="modal" aria-hidden="true" title="Close Modal">Close</button>
    </div>
</div>


	<style>
		.fc-time-grid .fc-slats td { min-height: 30px; height: 30px}
		.fc-unthemed .fc-today {background-color: white}
		.fc-bgevent{opacity: 0.7}
		.fc-event .fc-content{padding: 3px; font-size: 1.2em}
		.fc-event .fc-content .fc-time{display: inline-block;}
		.fc-event .fc-content .fc-title{display: inline-block;margin-left: 5px}
		.fc-highlight{border: 1px solid blue}
		.classDoctorEventScheduled{ cursor: pointer; }
		.classDoctorAvailInfoColor{
	    	display: inline-block;
	    	margin-bottom: 10px;
	    	color: black;
	    	line-height: 20px;
	    	margin-right: 20px;
		}
		.classDoctorAvailInfoColorbox{
			float: left;
			display: inline-block;
			background: black;
	    	width: 20px;
	    	height: 20px;
	    	margin-right: 5px;
	    	border: 1px solid black;
		}
		.classDoctorAvailModal .select2-results__option{
			color:black;
		}
	</style>
	<!--Doctor Availability Modal-->
	<div id="idDoctorAvailModal" class="modal hide classDoctorAvailModal" tabindex="-1" role="dialog" data-backdrop="static">
		<div class="modal-header special-modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
			<h3 id="myActionPlanModalLabel">Doctor/Room Availability</h3>
		</div>
		<div class="modal-body">
			<div id="idDoctorAvailModalController">
				<div class="row-fluid">
					<div class="span2">
						<select id="idDoctorAvailModalClinicControl" style='width: 151px;'>
							<option value="">Select Clinic</option>
						</select>
					</div>
					<div class="span2">
						<select id="idDoctorAvailModalDoctorControl">
							<option value="">Select Doctor</option>
						</select>
					</div>
					<div class="span2" style='display:none' >
						<select id="idDoctorAvailModalRoomControl" style="width: 151px;">
							<option value="">Select Room</option>
						</select>
					</div>
					<div class="span3 text-right">
						<div class="icon-arrow-left classPreviousWeekSelection" id="idPreviousWeekSelection"></div>
					 	<input type="text" class="classInputTextXS" id="idDoctorAvailModalDate" value="09-11-2025" readonly>
					 	<div class="icon-arrow-right classNextWeekSelection" id="idNextWeekSelection"></div>
					</div>
					<div class="span2 text-left">
						<div class="btn-group" id="idDoctorAvailModalCalendarTab" data-toggle="buttons-radio">
							<button type="button" data-view="agendaWeek" class="btn btn-primary active">Week</button>
							<button type="button" data-view="agendaDay" class="btn btn-primary">Day</button>
						</div>
					</div>
				</div>
				<div class="row-fluid">
					<div class="span5 text-left">
						<p style="font-size: 14px; color: black;">Select available timeslot to add appointment for patient:</p>
					</div>
					<div class="span7 text-right">
						<span class="classDoctorAvailInfoColor">
							<span class="classDoctorAvailInfoColorbox" style="background: white"></span>
							<strong>Not Available</strong>
						</span>
						<span class="classDoctorAvailInfoColor">
							<span class="classDoctorAvailInfoColorbox" style="background: lightgreen"></span>
							<strong>Available</strong>
						</span>
						<span class="classDoctorAvailInfoColor">
							<span class="classDoctorAvailInfoColorbox" style="background: blue"></span>
							<strong>Scheduled</strong>
						</span>
						<span class="classDoctorAvailInfoColor">
							<span class="classDoctorAvailInfoColorbox" style="background: red"></span>
							<strong>Leave</strong>
						</span>
						<span class="classDoctorAvailInfoColor">
							<span class="classDoctorAvailInfoColorbox" style="background: orange"></span>
							<strong>Engaged Room</strong>
						</span>
					</div>
				</div>
			</div>
			<div id="idDoctorAvailCalendar"></div>
		</div>
		<div class="modal-footer">
			<button class="btn btn-danger btn-small" data-dismiss="modal" aria-hidden="true">Close</button>
		</div>
	</div>
	<script>
		(function() {
			$('#idDoctorAvailModalCalendarTab').button();

			$('.classPreviousWeekSelection').on('click', function() {
				var dCurrentDate = $('#idDoctorAvailModalDate').val();
				dPreviousWeek = moment(dCurrentDate,"DD-MM-YYYY").subtract(7, 'days').format('DD-MM-YYYY');
				$('#idDoctorAvailModalDate').val(dPreviousWeek);
				$('#idDoctorAvailCalendar').fullCalendar( 'gotoDate', moment(dPreviousWeek,"DD-MM-YYYY"));
			});

			$('.classNextWeekSelection').on('click', function() {
				var dCurrentDate = $('#idDoctorAvailModalDate').val();
				dNextWeek = moment(dCurrentDate,"DD-MM-YYYY").add(7, 'days').format('DD-MM-YYYY');
				$('#idDoctorAvailModalDate').val(dNextWeek);
				$('#idDoctorAvailCalendar').fullCalendar( 'gotoDate', moment(dNextWeek,"DD-MM-YYYY"));
			});			
			var iFilteredRoomValue = '';
			var sFilteredRoomName = '';
			var iFilteredStaffValue = '';

			$('#idDoctorAvailModalCalendarTab').button();

			$('#idDoctorAvailModalCalendarTab button').on('click', function(event) {
				event.preventDefault();
				
				$('#idDoctorAvailCalendar').fullCalendar( 'changeView', $(this).data('view') );
			});

			$('#idDoctorAvailModalDate').datepicker({
	            changeMonth: true,
	            dateFormat: 'dd-mm-yy',
	            changeYear: true,
	            showOn: "button",
	            buttonImage: "images/Calendar-icon.png",
	            buttonImageOnly: true,
	            onSelect: function(date) {
					$('#idDoctorAvailCalendar').fullCalendar( 'gotoDate', moment(date,"DD-MM-YYYY") );
	            }
	        });

	        $('#idDoctorAvailModalDate').on("changeDate", function(date){
				$('#idDoctorAvailCalendar').fullCalendar( 'gotoDate', moment(date.date) );
	        });

			var iStaffClinicID = '2';

			$("#idDoctorAvailModalDoctorControl").select2({
				width: '100%',
				placeholder: 'Select Doctor',
				dropdownParent: $("#idDoctorAvailModal"),
				allowClear: true
			});

			$("#idDoctorAvailModalRoomControl").select2({
				width: '100%',
				placeholder: 'Select Room',
				dropdownParent: $("#idDoctorAvailModal"),
				allowClear: true
			});

			$("#idDoctorAvailModalClinicControl").select2({
				width: '100%',
				placeholder: 'Select Clinic',
				dropdownParent: $("#idDoctorAvailModal"),
				allowClear: true
			});

			$("#idDoctorAvailModalController").on('change', '#idDoctorAvailModalRoomControl', function() {
				iFilteredRoomValue = $(this).val();
				sFilteredRoomName = $("#idDoctorAvailModalRoomControl option:selected").text();
			});

			$("#idDoctorAvailModalController").on('change', '#idDoctorAvailModalDoctorControl', function() {
				iFilteredStaffValue = $(this).val();
			});

			$("#idDoctorAvailModalClinicControl").on('change', function() {
				
				// Get Clinic of the doctor
				var iClinicID = $(this).val();

				if(iClinicID){
					$("#idDoctorAvailModalRoomControl option[value!='']").remove();

					// Loading Rooms accoring to Clinic
					$.ajax({
						url: "apiv2/roomsForClinic/"+iClinicID+"/rooms",
						headers: getAjaxAuthHeaders()
					}).done(function(aRoomData) {
						$.each(aRoomData, function(index, aCurrentRoom){
							$("#idDoctorAvailModalRoomControl").append("<option value='"+aCurrentRoom.iRoomID+"'>"+aCurrentRoom.sRoomName+"</option>");
						});
					});

					$("#idDoctorAvailModalDoctorControl option[value!='']").remove();
				
					// Loading Doctors accoring to Clinic
					$.ajax({
						url: "ajaxEhr.php?sFlag=getDoctorListForClinic",
						data: {
							iClinicID: iClinicID
						}
					}).done(function(aDoctors){
						$.each(aDoctors, function(index, aDoctor){
							$("#idDoctorAvailModalDoctorControl").append("<option value='"+aDoctor.staff_id+"'>"+aDoctor.staff_name+"</option>");
						});
					});
				}
			});

			$("#idDoctorAvailModalClinicControl, #idDoctorAvailModalDoctorControl, #idDoctorAvailModalRoomControl").on('change', function() {
				
				$('#idDoctorAvailCalendar').fullCalendar( 'refetchEvents' );
			});
			
			$("#idDoctorAvailModal").on('shown', function () {
				rescale();

				$("#idDoctorAvailModalClinicControl option[value!='']").remove();

				// Loading Clinics...
				$.ajax({
					url: "ajaxEhr.php?sFlag=GetAllClinicList"
				}).done(function(aClinics) {
					var aClinicList = $.parseJSON(aClinics);
					$.each(aClinicList, function(index, aClinic){
						if(iStaffClinicID == aClinic.clinic_id){
							$("#idDoctorAvailModalClinicControl").append("<option value='"+aClinic.clinic_id+"' selected>"+aClinic.clinic_name+"</option>");
						}else{
							$("#idDoctorAvailModalClinicControl").append("<option value='"+aClinic.clinic_id+"'>"+aClinic.clinic_name+"</option>");
						}
					});
					$("#idDoctorAvailModalClinicControl").trigger("change");
				});

				$('#idDoctorAvailCalendar').fullCalendar({
					defaultView: 'agendaWeek',
					allDaySlot: false,
					height: $('#idDoctorAvailCalendar').closest('.modal-body').height() - $("#idDoctorAvailModalController").height() - 30,
					slotDuration: '00:20:00',
					slotLabelInterval: '00:20:00',
					minTime: "07:00:00",
					maxTime: "22:22:00",
					selectable: true,
					selectConstraint: function(){
						return "background";
					},
					select: function( start, end, jsEvent, view){
						// var displayDate = start.format("DD-MM-YYYY"),
						// 	displayTime = start.format("hh:mm A"),
						// 	time = start.format("HH:mm"),
						// 	$calendar = $('#idDoctorAvailCalendar'),
						// 	allowedDuration = "20",
						// 	iSelectedClinicID = $("#idDoctorAvailModalClinicControl").val();

						// // Check if time slot is allowed timeslot
						// if(confirm("Are you sure want to add schedule at "+displayDate+" "+displayTime+"?")){
						// 	var $patientSearchModal = $('#idSerachPatientModal');

			   //          	$("#idDoctorAvailModal").modal("hide");
			   //          	$patientSearchModal.find("#idSchDate").val(displayDate);
			   //          	$patientSearchModal.find("#idTime").val(time);
			   //          	$patientSearchModal.find("#idTime option[value='"+time+"']").prop("selected", true);
			   //          	if(iSelectedClinicID){
			   //          		$patientSearchModal.find("#idApptClinic").val(iSelectedClinicID);
			   //          		$patientSearchModal.find("#idApptClinic option[value='"+iSelectedClinicID+"']").prop("selected", true);
			   //          	}
			   //          	$patientSearchModal.modal('show'); 
						// 	$calendar.fullCalendar("unselect");
						// } else {
						// 	$calendar.fullCalendar("unselect");
						// }

						let sDatePickerFormat = "DD-MM-YYYY";
						let sDefaultTimeslot = "20";
						// use callback
						let oParamerters = {};
						oParamerters.start = start;
						oParamerters.end = end;
						oParamerters.jsEvent = jsEvent;
						oParamerters.sDatePickerFormat = sDatePickerFormat;
						oParamerters.view = view;
						oParamerters.sDefaultTimeslot = sDefaultTimeslot;
						if(oDoctorAvailability.iAction == 0){
							checkDoctorAvailability(function(){
								addScheduleFromDoctorAvailabiltyModal(oParamerters);
							});								
						}else if(oDoctorAvailability.iAction == 1){
							checkDoctorAvailability(function(){
								updateScheduleDateTime(oParamerters);
							});
						}
					},
    				selectOverlap: function(event) {
    					console.log(event);
				        return event.rendering === 'background';
				    },
					slotLabelFormat: {
					    agenda: 'hh:mm A'
					},
					columnFormat: {
			            week: 'D-M-YYYY ddd',
			            day: 'D-M-YYYY dddd'
			        },
					header: false,
					events: function(start, end, timezone, callback) {
						var iStaffID = $("#idDoctorAvailModalDoctorControl").val();
						var iClinicID = $("#idDoctorAvailModalClinicControl").val();
						var iRoomID = $("#idDoctorAvailModalRoomControl").val();

						if(iClinicID){
							$.ajax({
								url: 'ajaxEhr.php',
								data: {
									sFlag: "getDoctorAvailablityStatus",
									iStaffID: iStaffID,
									iClinicID: iClinicID,
									iRoomID: iRoomID,
									sStartDate: start.format("YYYY-MM-DD"),
									sEndDate: end.format("YYYY-MM-DD")
								},
								success: function(aStatus) {
					                var events = [];
									$.each(aStatus, function(sType, aTimeslots) {
										$.each(aTimeslots, function(index, aTimeslot) {
										 	events.push(createFullCalendarEventObject(sType, aTimeslot));
										});
									});

									callback(events);
								}
							});
						} else {
							callback([]);
						}
				    },
				    eventClick: function(event, jsEvent, view) {
				    	if(event.sType == "scheduled"){
				    		window.open("viewSchedule.php?iScheduleID="+event.aData.schedule_id, '_blank');
				    	}
				    },
				    eventRender: function(event, element){
					    if(event.sType == "available"){
					        element.append("<div class='text-center' style='opacity: 0.9'><strong>"+event.title+"</strong></div>");
					    }
					}
				});
			});

			$("#idDoctorAvailModal").on('hidden', function () {
				$('#idDoctorAvailCalendar').fullCalendar( 'destroy' );
			});

			function rescale(){
			    var size = {width: $(window).width() , height: $(window).height() };
			    var offset = 100;
			    var $modal = $('#idDoctorAvailModal');

			    $modal.css({
			    	'height': "90%",
			    	'top': "3%"
			    });

			    var iModalBodyHeight = $modal.outerHeight() - ($modal.find(".modal-header").outerHeight() + $modal.find(".modal-footer").outerHeight());

			    $modal.find('.modal-body').css({
			    	'maxHeight': iModalBodyHeight,
			    	'height': iModalBodyHeight
			    });
			}

			function createFullCalendarEventObject(sType, aData) {

				var allDay = false;
					start = "",
					end = "",
					backgroundColor = "",
					textColor = "",
					overlap = sType != "available",
					title = ""
					url = "";

				if(sType == "available"){
					start = moment(aData.sDate+" "+aData.from_time);
					end = moment(aData.sDate+" "+aData.to_time);
					backgroundColor = "lightgreen";
					className = "classDoctorEventAvailable";
					title = aData.clinic_name;
					textColor = "white";
				} else if(sType == "scheduled"){
					start = moment(aData.schedule_date+" "+aData.schedule_time);
					end = moment(aData.schedule_date+" "+aData.schedule_end_time);
					backgroundColor = "blue";
					textColor = "white";
					title = aData.patient_name;
					className = "classDoctorEventScheduled";
				}else if(sType == "room_booked"){
					start = moment(aData.schedule_date+" "+aData.schedule_time);
					end = moment(aData.schedule_date+" "+aData.schedule_end_time);
					backgroundColor = "orange";
					textColor = "white";
					title = sFilteredRoomName;
					className = "classDoctorEventScheduled";
				} else {
					start = moment(aData.start_date+" 00:07:00");
					end = moment(aData.end_date+" 22:40:00");
					backgroundColor = "red";
					textColor = "white";
					title = "Leave";
					className = "classDoctorEventLeave";
				}

				var event = {
					title: title,
					className: className,
					allDay: allDay,
					start: start,
					end: end,
					overlap:overlap,
					backgroundColor: backgroundColor,
					textColor: textColor,
					
					sType: sType,
					aData: aData
				};

				if(sType == "available"){
					event['rendering'] = "background";
				}

				return event;
			}

			$(window).bind("resize", rescale);

		})()
	</script>
	
<a class="new classDashboardNotifier classShowReceivedMessageDiv" id="idFooterNotifier" style="display: none;" title="Unread Messages">
	<i class="bell fa fa-bell-o"></i><div class="badge1" id="idShowReceivedMessageDiv">0</div>	
</a>
<script type ="text/javascript" src="js/bootstrap-datetimepicker.js"></script>
<script type="text/javascript" src="assets/bootstrap-timepicker/js/bootstrap-timepicker.js"></script>

<link rel="stylesheet" href="assets/bootstrap-datepicker/dist/css/bootstrap-datepicker3.min.css">

<style>
	.classTaskFunctionalityRow{
		margin-bottom: 5px;
		margin-top: 5px;
	}
	label{
		text-align: left;
		color: #000;
	}
	h4{
		color: #000;
	}
</style>

<div class="modal fade hide" id="idAddTaskModal" role="dialog" aria-hidden="true">
	<input type="hidden" id="idAddTaskFunctionalityTaskType" name="idAddTaskFunctionalityTaskType">
	<input type="hidden" id="idAddTaskFunctionalityTaskTypeReferenceId" name="idAddTaskFunctionalityTaskTypeReferenceId">
	<input type="hidden" id="idAddTaskFunctionalityReloadScreen" name="idAddTaskFunctionalityReloadScreen" value='0'>

	<input type="hidden" id="iTaskMappedToEntityID" name="iTaskMappedToEntityID" >
	<input type="hidden" id="iTaskMappedToEntityTypeID" name="iTaskMappedToEntityTypeID" >
    <div class="modal-dialog">
        <div class="modal-content">
            <div class = "modal-header">
                <h4 class="modal-title" id="idModalAppointmentCancellationLabel">Add Task</h4>
            </div>
            <div class="modal-body">
                <div class="row-fluid">
                	<div class="span12">
	                	<div class="span2">
	                		<label>Title<span id="mandatory">*</span></label>
	                	</div>
	                	<div class="span10">
	                		<input type="text" class="classInputTextS " id="idTaskFunctionalityTitle" style="width: 100%;" />
	                	</div>
                	</div>
                </div>
                <div class="row-fluid">
                	<div class="span12">
                		<div class="span2">
                			<label>Description</label>
                		</div>
                		<div class="span10">
                			<textarea type="text" class="classInputTextS " id="idTaskFunctionalityDescription" style="width: 100%;"></textarea>
                		</div>
                	</div>
                </div>       
                <div class="row-fluid">
                	<div class="span12">
                		<div class="span2">
                			<label>Start Date</label>
                		</div>
                		<div class="span4">
                			<input type="text" class="classInputTextS classTaskFunctionalityDate" id="idTaskFunctionalityStartDate" readonly style="width: 100%;" />
                		</div>
                		<div class="span2">
                			<label>End Date</label>
                		</div>
                		<div class="span4">
                			<input type="text" class="classInputTextS  classTaskFunctionalityDate" id="idTaskFunctionalityEndDate" readonly style="width: 100%;" />
                		</div>
                	</div>
                </div>  
                <div class="row-fluid">
                	<div class="span12">
                		<div class="span2">
                			<label>Assign<span id="mandatory">*</span></label>
                		</div>
                		<div class="span4">
                			<select type="text" class="classInputTextS " id="idTaskFunctionalityAssignTo" style="width: 100%;" ></select>
                		</div>
                		<div class="span2">
                			<label>Or Assign<span id="mandatory">*</span></label>
                		</div>
                		<div class="span4">
                			<select type="text" class="classInputTextS" id="idTaskFunctionalityAssignToUserType" style="width: 100%;" ></select>
                		</div>
                	</div>
                </div>                
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="idSaveTaskFromModal">Add Task</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>

	$(document).ready(function(){
		// hide the modal
		$('#idAddTaskModal').modal('hide');

		//attach datepicker
		$(".classTaskFunctionalityDate").datepicker({
		    changeMonth: true,
		    dateFormat: 'dd-mm-yy',
		    changeYear: true,
		});
	});

	function assignTaskFromTaskFunctionality(sTitle,sDesc,dStartDate,dEndDate,iAssignedType,iAssignedId,iTaskTypeId,iReferenceId,sAssignedTo='', iTaskMappedToEntityID='', iTaskMappedToEntityTypeID=''){
		$('#idAddTaskFunctionalityTaskType').val(iTaskTypeId);
		$('#idAddTaskFunctionalityTaskTypeReferenceId').val(iReferenceId);

		// clear the input fields before showing modal
		$('#idTaskFunctionalityTitle').val(sTitle);
		$('#idTaskFunctionalityDescription').val(sDesc);
		$('#idTaskFunctionalityStartDate').val(dStartDate);
		$('#idTaskFunctionalityEndDate').val(dEndDate);

		$('#iTaskMappedToEntityID').val(iTaskMappedToEntityID);
		$('#iTaskMappedToEntityTypeID').val(iTaskMappedToEntityTypeID);

		
		// user
		if(iAssignedType==0){
			$('#idTaskFunctionalityAssignTo').html( $('<option selected></option>').val(iAssignedId).text(sAssignedTo) );
			$('#idTaskFunctionalityAssignToUserType').html( $('<option selected></option>').val('0').text('') );
		}else{
			$('#idTaskFunctionalityAssignTo').html( $('<option selected></option>').val('0').text('') );
			$('#idTaskFunctionalityAssignToUserType').html( $('<option selected></option>').val(iAssignedId).text(sAssignedTo) );
		}	
		$('#idAddTaskModal').modal('show');

		//attach datepicker
		$(".classTaskFunctionalityDate").datepicker({
		    changeMonth: true,
		    dateFormat: 'dd-mm-yy',
		    changeYear: true,
		});
	}

	// assign to staff
	$('#idTaskFunctionalityAssignTo').select2({
		width: '100%',
		placeholder: 'Assign to',
		allowClear: true,
		minimumInputLength: 3,
		width: 'resolve',
		ajax: {
		    url: "ajaxEhr.php?sFlag=searchUserByName",
		    data: function (params) {
				return {
					sUserName: params.term
				};
		    },
	        processResults: function (data, params) {
	        	var results = [];

	        	$.each(data, function(index, oUser) {
	        		results.push({
	        			id: oUser.user_id,
	        			text: oUser.name
	        		});
	        	});

				return { results: results };
		    }
		}
	}).on('change', function() {
		// clear user type
		$('#idTaskFunctionalityAssignToUserType').val('');
	}).on('unselect', function() {

	});

	// assign user type
	$('#idTaskFunctionalityAssignToUserType').select2({
		width: '100%',
		placeholder: 'User type',
		allowClear: true,
		minimumInputLength: 3,
		width: 'resolve',
		ajax: {
		    url: "ajaxEhr.php?sFlag=getAllUserTypes",
		    data: function (params) {
				return {
					sUserType: params.term
				};
		    },
	        processResults: function (data, params) {
	        	var results = [];

	        	$.each(data, function(index, oUserType) {
	        		results.push({
	        			id: oUserType.user_type_id,
	        			text: oUserType.user_type
	        		});
	        	});

				return { results: results };
		    }
		}
	}).on('change', function() {
		// clear staff
		$('#idTaskFunctionalityAssignTo').val('');
	}).on('unselect', function() {

	});

	// save task
	$(document).on('click','#idSaveTaskFromModal',function(){
		
		var iTaskTypeId = $('#idAddTaskFunctionalityTaskType').val(); 
		var iTaskTypeReferenceId = $('#idAddTaskFunctionalityTaskTypeReferenceId').val(); 

		var idTaskFunctionalityTitle = $('#idTaskFunctionalityTitle').val();
		var idTaskFunctionalityDescription = $('#idTaskFunctionalityDescription').val();
		var idTaskFunctionalityStartDate = $('#idTaskFunctionalityStartDate').val();
		var idTaskFunctionalityEndDate = $('#idTaskFunctionalityEndDate').val();
		var idTaskFunctionalityAssignTo = $('#idTaskFunctionalityAssignTo').val();
		var idTaskFunctionalityAssignToUserType = $('#idTaskFunctionalityAssignToUserType').val();

		var iTaskMappedToEntityID = $('#iTaskMappedToEntityID').val();
		var iTaskMappedToEntityTypeID = $('#iTaskMappedToEntityTypeID').val();

		var sAlertMessage = '';

		if(idTaskFunctionalityTitle==""){
			sAlertMessage="Please specify a title";
		}
		if(idTaskFunctionalityAssignTo=='' || idTaskFunctionalityAssignTo==null){
			if(idTaskFunctionalityAssignToUserType=='' || idTaskFunctionalityAssignToUserType==null){
				sAlertMessage="Please assign the task";
			}
		}

		// if valide, create task
		if(sAlertMessage!=''){
			alert(sAlertMessage);
		}else{
			// create the task
			$.ajax({
				url:"ajaxEhr.php?sFlag=addTaskFromFunctionalty",
				type:"POST",
				data:{
					sTaskTitle:idTaskFunctionalityTitle,
					sTaskDescription:idTaskFunctionalityDescription,
					dTaskStartDate:idTaskFunctionalityStartDate,
					dTaskEndDate:idTaskFunctionalityEndDate,
					iTaskAssignedTo:idTaskFunctionalityAssignTo,
					iTaskUserType:idTaskFunctionalityAssignToUserType,
					iTaskTypeId:iTaskTypeId,
					iTaskTypeReferenceId:iTaskTypeReferenceId,
					iTaskMappedToEntityID: iTaskMappedToEntityID,
					iTaskMappedToEntityTypeID: iTaskMappedToEntityTypeID
				},
				success: function(data){
					if(!data){
						alert("Error in creating task");
						return false;
					}
					alert("Task created successfully");
					// hide the modal
					$('#idAddTaskModal').modal('hide');

					// reload the screen
					if( $('#idAddTaskFunctionalityReloadScreen').val() =='1' ){
						$('#idAddTaskFunctionalityReloadScreen').val('0');
						location.reload();	
					}
				}
			});
		}
	});
</script>
<style>
	.classTaskFunctionalityRow{
		margin-bottom: 5px;
		margin-top: 5px;
	}
	label{
		text-align: left;
		color: #000;
	}
	h4{
		color: #000;
	}
    .tdFont{
        font-size: 13px;
    }
    .tableMRIBorder{
        border:1px solid black !important;
        text-align: center !important;
    }
</style>

 <div id="idAddRecommedationModal" class="modal hide" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="idModalViewMortuaryLabel" aria-hidden="true" style="width: 950px;margin-left: -450px;">
        <div class="modal-header special-modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h3 id="idModalViewLabel">OPD Recommedation Details</h3>
        </div>
             <div class="modal-body classModalLarge">
                        <table class='table table-condensed classTableView' id="id_hlp_RTC_table" style='border:0px'>
                            <tr class="classRow">
                                <td><span class="classLabel">Recommendation In</span></td>
                                <td><span class="classLabel" style='width:150px;'>Reason</span></td>
                                <td><span class="classLabel" style='width:150px;'>Adedd On</span></td>
                                <td><span class="classLabel" style='width:150px;'>Doctor Name</span></td>
                            </tr>
                            <tr class="classRecomedationRow" id='idTableRow'>
                                <td id="idRecommedationIn"></td>
                                <td id="idRecommedationNotes"> </td>
                                <td id="idRecommedationAddedOn"></td>
                                <td id="idRecommedationDoctorName"> </td>
                            </tr>
                        </table> 
                                                                                 <a class="btn btn-success pull-right" id="idPatientRecommedationLinK" title="Recommedation Link" target="_blank" style="padding: 10px;font-size: 15px;margin-bottom: 10px;">Recommedation Link</a>
                                                                    </div>
            <div class="modal-footer classModalFooter">
                <button type="button" class="btn btn-danger" data-dismiss="modal" aria-hidden="true">Close</button>
            </div>
</div>

<script>
    var iPatientID                      = '96';
    var iServiceID                      = '';
    var iScheduleID                     = '0';
    var iEnableResonForRecommendation   = 0;
    var iEnableCustomMRIRecommendation  = 0;
	$(document).ready(function(){
		// hide the modal
		$('#idAddRecommedationModal').modal('hide');
	});

	function fDisplayRecommdationModal(iRecommedationID){
        if(iRecommedationID>0){
            $('#idAddRecommedationModal').modal('show');
            getRecommendationDetailsForPatientPopup(iRecommedationID);
            if(iEnableResonForRecommendation==1){
                fGetReasonForRecommedationDetails(iRecommedationID,iPatientID);
            } 
            if(iEnableCustomMRIRecommendation==1){
                var iRecommedationMRIChecklistCount=fGetMRIChecklistCount(iRecommedationID,iPatientID);
                if(iRecommedationMRIChecklistCount>0){
                    $('#idMRIChecklistForRecommedationPopup').show();
                    fGetMRIChecklistDetails(iRecommedationID,iPatientID);
                }
            }
            fGetRecommededConsultationLnk(iRecommedationID,iPatientID);
        }
	}
      //! Function for get recommedation details for recommedatio id..
    function getRecommendationDetailsForPatientPopup(iRecommedationID){
        var aRecommedationDetails=[];
        $.ajax({
            url:"ajaxIPDManager.php?sFlag=getRecommendationDetailsForPatient",
            type: "POST",
            data: {iRecommedationID:iRecommedationID},
            success: function (data){
                if(data != false){
                      aRecommedationDetails = $.parseJSON(data);
                      $('#idRecommedationIn').text(aRecommedationDetails['clinicName']);
                      $('#idRecommedationNotes').text(aRecommedationDetails['notes']);
                      $('#idRecommedationAddedOn').text(aRecommedationDetails['datetime']);
                      $('#idRecommedationDoctorName').text(aRecommedationDetails['sUserName']);
                }
            }
        });
    }
     //! Function for get reason for recommedation details .
    function fGetReasonForRecommedationDetails(iRecommedationID,iPatientID){
        var sReasonRecommedationDetails='';
        $.ajax({
            url:"ajaxEhr.php?sFlag=getReasonForRecommedationDetails",
            type: "POST",
            async: false,
            data: {iPatientID:iPatientID,iRecommedationID:iRecommedationID},
            success: function (data){
                if(data != false){
                      sReasonRecommedationDetails = data;
                      $('#idRecommedationReason').text(sReasonRecommedationDetails);
                }
            }
        });
    }
     //! Function for get MRI checklist details .
    function fGetMRIChecklistDetails(iRecommedationID,iPatientID){
        var aMRIChecklistDetails=[];
        $.ajax({
            url:"ajaxEhr.php?sFlag=getMRIChecklistDetails",
            type: "POST",
            data: {iPatientID:iPatientID,iRecommedationID:iRecommedationID},
            success: function (data){
                if(data != false){
                        aMRIChecklistDetails = $.parseJSON(data);
                        console.log(aMRIChecklistDetails);
                        if(aMRIChecklistDetails['metal_worker']==1){
                            $('#metal_worker').prop("checked",true);
                        }else{
                            $('#metal_worker').prop("checked",false);
                        }
                        if(aMRIChecklistDetails['eye_injury']==1){
                            $('#eye_injury').prop("checked",true);
                            $('#modal_eye_injury_type').text(aMRIChecklistDetails['eye_injury_type']);
                        }
                        }else{
                            $('#eye_injury').prop("checked",false);
                        }

                        if(aMRIChecklistDetails['prior_surgery']==1){
                            $('#prior_surgery').prop("checked",true);
                              $('#modal_prior_surgery_type').text(aMRIChecklistDetails['prior_surgery_type']);
                        }else{
                            $('#prior_surgery').prop("checked",false);
                        }
                        if(aMRIChecklistDetails['metal_in_body']==1){
                            $('#metal_in_body').prop("checked",true);
                              $('#modal_metal_in_body_describe').text(aMRIChecklistDetails['metal_in_body_describe']);
                        }else{
                            $('#metal_in_body').prop("checked",false);
                        }

                        if(aMRIChecklistDetails['pacemaker_heart_valve']==1){
                            $('#pacemaker_heart_valve').prop("checked",true);
                              $('#modal_pacemaker_hear_valve_type').text(aMRIChecklistDetails['pacemaker_hear_valve_type']);
                        }else{
                            $('#pacemaker_heart_valve').prop("checked",false);
                        }

                        if(aMRIChecklistDetails['medication']==1){
                            $('#medication').prop("checked",true);
                              $('#modal_medication_name').text(aMRIChecklistDetails['medication_name']);
                        }else{
                            $('#medication').prop("checked",false);
                        }

                        if(aMRIChecklistDetails['allergies']==1){
                            $('#allergies').prop("checked",true);
                              $('#modal_allergies_describe').text(aMRIChecklistDetails['allergies_describe']);
                        }else{
                            $('#allergies').prop("checked",false);
                        }

                         if(aMRIChecklistDetails['affecting_blood']==1){
                            $('#affecting_blood').prop("checked",true);
                              $('#modal_affecting_blood_describe').text(aMRIChecklistDetails['affecting_blood_describe']);
                        }else{
                            $('#affecting_blood').prop("checked",false);
                        }

                         if(aMRIChecklistDetails['female_pregnant']==1){
                            $('#female_pregnant').prop("checked",true);
                        }else{
                            $('#female_pregnant').prop("checked",false);
                        }

                         if(aMRIChecklistDetails['worried_or_afraid']==1){
                            $('#worried_or_afraid').prop("checked",true);
                        }else{
                            $('#worried_or_afraid').prop("checked",false);
                        }
                }
            });
    }
    //! Function for get reason for recommedation details .
    function fGetRecommededConsultationLnk(iRecommedationID,iPatientID){
        var sRecommededConsultationLnk='';
        $.ajax({
            url:"ajaxEhr.php?sFlag=getRecommededConsultationLnk",
            type: "POST",
            async: false,
            data: {iPatientID:iPatientID,iRecommedationID:iRecommedationID},
            success: function (data){
                if(data != false){
                      sRecommededConsultationLnk = $.parseJSON(data);
                      $('#idPatientRecommedationLinK').attr("href", sRecommededConsultationLnk); // Set herf value
                }
            }
        });
    }
      //! Function for get count MRI checklist for recommedationID
    function fGetMRIChecklistCount(iRecommedationID,iPatientID){
        var iRecommedationMRIChecklistCount='';
        $.ajax({
            url:"ajaxEhr.php?sFlag=getMRIChecklistCountForRecommedation",
            type: "POST",
            async: false,
            data: {iPatientID:iPatientID,iRecommedationID:iRecommedationID},
            success: function (data){
                if(data != false){
                      iRecommedationMRIChecklistCount = $.parseJSON(data);
                }
            }
        });
        return iRecommedationMRIChecklistCount;
    }
</script>

<script type="text/javascript" language="javascript" src="assets/gasparesganga-jquery-loading-overlay/dist/loadingoverlay.min.js"></script>
<!-- <script type="text/javascript" language="javascript" src="assets/gasparesganga-jquery-loading-overlay/extras/loadingoverlay_progress/loadingoverlay_progress.min.js"></script> -->
<script type="text/javascript">
	function initiateCall(iEntityTypeID, iEntityID) {
		//open add follow-up modal
		fOpenFollowupFromModalFooterB3('411','Kekeli Jiresse Dogbevi',iEntityID,iEntityTypeID);
		$.ajax({
			url:"ajaxCall.php?sFlag=INITIATE_CALL",
			type:"POST",
			data:{
				iEntityID: iEntityID,
				iEntityTypeID: iEntityTypeID
			},
			beforeSend: function() {
			},
			success: function(data){
				if(data) {
					generate("success", "Call requested successfully.");
				}
				else {
					generate("error", "Call request failed.");
				}
			},
			complete: function() {
			}
		});
	}
</script>
<link rel="stylesheet" type="text/css" href="css/patientRecordPopupView.css">
<!-- start: Modal Patient record Popup view -->
<div class="modal fade classPatientRecordPopupTabViewModal hide" id="idPatientRecordPopupTabViewModal" tab-index="-1" data-backdrop="static" role="dialog" aria-hidden="true" style="width: 1100px;margin-left: -530px;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header modal-header-custom">
      	<div class="close_btn" id="idClosePatientRecordPopupTabViewModal">X</div>
        <div class="patient_header">
            <div class="patient_actions">
              	<!-- <button class="btn header-btn-primary btn-custom-xs " type="button" title="Make a Call" ><i class="fa fa-phone"></i></button> -->
              	<br>              
            </div>
            <div class="patient_pic">
              <img src="img/default_user_splash_pic_100.jpg">
            </div>
            <div class="patient_details">
	            <h4 class="classPatientNameBlock"><span class="classPatientTitle"></span><span class="classPatientFullName"></span><span class="classPatientNo"></span>
                    <span id="idPatientPopUpVIP"></span>
                    <input type="hidden" class="classPendingBillsPatientNo" value="" />
                    <span class="pull-right" style="margin-right: 40px;">
                        <!-- Add appointment -->
                                                    <a class="btn btn-primary btn-mini" title="Add Appointment" href="scheduleManager.php?iAddAppointment=1&iPatientId=96" target="_blank">Add Appointment</a>                            
                        
                        
                        <!-- Add Motivation -->
                        
                                            </span>
                </h4>
            	<div class="span3 classHeaderDetalsBlock">
            		<div>
		              	<!-- <p style="margin-bottom:0px;">
		              		<span class="patient-info" id="idPRPPGlobalID">Global ID</span>:&nbsp;<span class="classPatientGlobalID"></span>
		              	</p> -->
                        <p style="margin-bottom:0px;">
                            <span class="patient-info" id="idPRPPMembershipType">Membership Type</span>:&nbsp;<span class="classPatientMembershipType"></span>
                        </p>
                        <p style="margin-bottom:0px;">
                            <span class="patient-info" id="idPRPPNHIANo">NHIA No.</span>:&nbsp;<span class="classPatientNHIANo"></span>
                        </p>
                        <p style="margin-bottom:0px;">
                            <span class="patient-info" id="idPRPPUniqueNo">MOH No</span>:&nbsp;<span class="classPatientUniqueNumber"></span>
                        </p>
		             	<!-- <p style="margin-bottom:0px;">
		             		<span class="patient-info" id="idPRPPLocalID">Local ID</span>:&nbsp;<span class="classPatientLocalID"></span>
		             	</p> -->
	             	</div>
	              	<!-- <div>
	                	Payment Status : <span style="color:#EDBE3B;font-size:13px;"><i class="fa fa-exclamation-circle"></i>&nbsp;<i class='fa fa-money'></i> <span class="classPatientAllPendigAmount"></span></span> <br>
	              	</div>   -->
              	</div>
              	<div class="span3 classHeaderDetalsBlock">
              		<p style="margin-bottom:0px;">
              			<span class="patient-info" id="idPRPPDOB">DOB</span>:&nbsp;<span class="classPatientDOB"></span>
              		</p>
              		<p style="margin-bottom:0px;">
              			<span class="patient-info" id="idPRPPMobileNo">Mobile No.</span>:&nbsp;<span class="classPatientMobile"><button class="btn btn-custom-xs btn-call " type="button" title="Make a Call" ><i class="fa fa-phone"></i></button></span>
              		</p>
              		<p style="margin-bottom:0px;">
              			<span class="patient-info" id="idPRPPGendar" >Gender</span>:&nbsp;<span class="classPatientGendarAndAge"></span>
              		</p>
              	</div>            
            </div>
            <div class="clearfix"></div>
          </div>
          	<header class="panel-heading tab-bg-dark-navy-blue">
	            <ul class="nav nav-tabs classUlNavTabPatientPopup">                    
	                <li class="active" style="display: block">
	                    <a data-toggle="tab" class="tab-heading classTabAnchor" href="#idTab_1" data-patient_id="">
	                        Basic Details	                    </a>
	                </li>                        
                    <li style="display: none">
                        <a data-toggle="tab" class="tab-heading classTabAnchor" href="#idTab_2" data-patient_id="">
                            Basic Medical History                        </a>
                    </li>                       
                    <!-- <li style="display: block">
                        <a data-toggle="tab" class="tab-heading classTabAnchor" href="#idTab_3" data-patient_id="">
                            Treatment Package                        </a>
                    </li>  --> 
                    <li style="display: block">
                        <a data-toggle="tab" class="tab-heading classTabAnchor" href="#idTab_4" data-patient_id="">
                            Package History                        </a>
                    </li>                      
                    <li style="display: block">
                        <a data-toggle="tab" class="tab-heading classTabAnchor" href="#idTab_5" data-patient_id="">
                            Appointment History                        </a>
                    </li>                       
                    <li style="display: block">
                        <a data-toggle="tab" class="tab-heading classTabAnchor" href="#idTab_6" data-patient_id="">
                            Service Taken                        </a>
                    </li>                       
                    <li style="display: block">
                        <a data-toggle="tab" class="tab-heading classTabAnchor" href="#idTab_7" data-patient_id="">
                            Payment History                        </a>
                    </li>                        
                    <!-- <li style="display: block">
                        <a data-toggle="tab" class="tab-heading classTabAnchor" href="#idTab_8" data-patient_id="">
                            Motivation Listing                        </a>
                    </li>                        
                    <li style="display: block">
                        <a data-toggle="tab" class="tab-heading classTabAnchor" href="#idTab_9" data-patient_id="">
                            Follow-ups                        </a>
                    </li>  -->                       
                    <li style="display: block">
                        <a data-toggle="tab" class="tab-heading classTabAnchor" href="#idTab_10" data-patient_id="">
                            Attachments                        </a>
                    </li>
                    <li style="display: block">
                        <a data-toggle="tab" class="tab-heading classTabAnchor" href="#idTab_11" data-patient_id="">
                            Billing History                        </a>
                    </li>
                    <!-- <li style="display: block">
                        <a data-toggle="tab" class="tab-heading classTabAnchor" href="#idTab_12" data-patient_id="">
                            Advice                        </a>
                    </li>  -->                                    	                
	            </ul>
	        </header>
      	</div>
      	<div class="modal-body custom-modal-body">
	        <!--Here comes the modal content-->	        
	        <div class="panel-body">  
                <div class="tab-content tasi-tab classContentNavTabPatientPopup">                	
                    <div id="idTab_1" class="tab-pane active full">     
                    	<!-- <div class="loader_animation"></div> -->
                    	<!-- loader -->
	        			<div class="classOverlay" ><div class="circle circle1 circle1-1"><div class="circle circle1 circle2-1"><div class="circle circle1 circle3-1"></div></div></div></div>
                    	<style type="text/css">
    .classTblHeadingPatient{
        width: 40%;
    }
    .classLeftTD{
        word-wrap: break-word;
    }
</style>
<div class="pull-right">
	<a class="btn btn-primary btn-shadow btn-sm basic_details_edit_btn" href="#" ><i class="fa fa-pencil"></i> Edit Details</a>
</div>
<br>
<br>
<br>
<div class="row-fluid">
	<table class="table table-hover classTabPatientBasicDetailsTable">
		<tbody>
			<tr>
				<td class="classTblHeadingPatient">Patient Name</td>
				<td class="classLeftTD" ><span id="idTabBSCDTLPatientName" >Amol Akhare</span></td>
			</tr>
			<tr>
				<td class="classTblHeadingPatient">Patient No</td>
				<td class="classLeftTD" ><span id="idTabBSCDTLPatientNo" ></span></td>
			</tr>
			<!-- <tr>
				<td class="classTblHeadingPatient">Global Id</td>
				<td class="classLeftTD" ><span id="idTabBSCDTLPatientGlobalID" ></span></td>
			</tr>
			<tr>
				<td class="classTblHeadingPatient">Local Id</td>
				<td class="classLeftTD" ><span id="idTabBSCDTLPatientLocalID" ></span></td>
			</tr> -->
			<tr>
				<td class="classTblHeadingPatient">Gender</td>
				<td class="classLeftTD" ><span id="idTabBSCDTLPatientGendar" ></span></td>
			</tr>
			<tr>
				<td class="classTblHeadingPatient">DOB</td>
				<td class="classLeftTD" ><span id="idTabBSCDTLPatientDOB" ></span></td>
			</tr>
			<tr>
				<td class="classTblHeadingPatient">Age</td>
				<td class="classLeftTD" ><span id="idTabBSCDTLPatientAge" ></span></td>
			</tr>
			<tr>
				<td class="classTblHeadingPatient">Blood group</td>
				<td class="classLeftTD" ><span id="idTabBSCDTLPatientBloodGrp" ></span></td>
			</tr>
			<tr>
				<td class="classTblHeadingPatient">Mobile No</td>
				<td class="classLeftTD" ><span id="idTabBSCDTLPatientMobile" ></span></td>
			</tr>
			<tr>
				<td class="classTblHeadingPatient">Email</td>
				<td class="classLeftTD" ><span id="idTabBSCDTLPatientEmail" ></span></td>
			</tr>
			<tr>
				<td class="classTblHeadingPatient">Primary Center</td>
				<td class="classLeftTD" ><span id="idTabBSCDTLPatientCenter" ></span></td>
			</tr>
			<tr>
				<td class="classTblHeadingPatient">Address</td>
				<td class="classLeftTD" ><span id="idTabBSCDTLPatientAddress" ></span></td>
			</tr>
			<tr>
				<td class="classTblHeadingPatient">City</td>
				<td class="classLeftTD" ><span id="idTabBSCDTLPatientCity" ></span></td>
			</tr>			
		</tbody>
	</table>
</div>
<script type="text/javascript">
	$(document).ready(function(){	
		sHref_1 = '#idTab_1';//Set value for loader
	});		
	//Set Patient details in Basic details Tab
	function fSetPatientBasicDetailsTab(data){
		fShowLoader(sHref_1);//Show loader
		
		//Set Patients' Name
    	if("oPatient" in data){

            if(data.oPatient.iPatientID){
                var sHrefPatientEdit = 'updatePatient.php?iPatientID='+data.oPatient.iPatientID;
                $('.basic_details_edit_btn').attr('href', sHrefPatientEdit);
            }else{
                $('.basic_details_edit_btn').attr('href', 'javascript:void(0)');
            }

    		//Set name
    		if(data.oPatient.sPatientName){
    			$('#idTabBSCDTLPatientName').text(data.oPatient.sPatientName);
    		}else{
    			$('#idTabBSCDTLPatientName').html('-');
    		}

    		//Set Patient Number
    		if(data.oPatient.sPatientNo){
        		$('#idTabBSCDTLPatientNo').text(data.oPatient.sPatientNo);
    		}else{
    			$('#idTabBSCDTLPatientNo').html('-');
    		}

    		//Set Patient DOB
    		if(data.oPatient.dDOB){
        		$('#idTabBSCDTLPatientDOB').text(data.oPatient.dDOB);
    		}else{
    			$('#idTabBSCDTLPatientDOB').html('-');
    		}

    		//Set Mobile
    		if(data.oPatient.iMobile){  
                $('#idTabBSCDTLPatientMobile').html(data.oPatient.iMobile);
    		}else{
    			$('#idTabBSCDTLPatientMobile').html('-');
    		}	

    		//Set Gendar
    		if(data.oPatient.sGender){
        		$('#idTabBSCDTLPatientGendar').text(data.oPatient.sGender);
    		}else{
    			$('#idTabBSCDTLPatientGendar').html('-');
    		}

    		//Set Age
    		if(data.oPatient.iAgeString){
        		$('#idTabBSCDTLPatientAge').text(data.oPatient.iAgeString);
    		}else{
    			$('#idTabBSCDTLPatientAge').html('-');
    		}

    		//Set Email
    		if(data.oPatient.sEmail){
        		$('#idTabBSCDTLPatientEmail').text(data.oPatient.sEmail);
    		}else{
    			$('#idTabBSCDTLPatientEmail').html('-');
    		}

    		//Set Center
    		if(data.oPatient.sPatientPrimaryClinicName){
        		$('#idTabBSCDTLPatientCenter').text(data.oPatient.sPatientPrimaryClinicName);
    		}else{
    			$('#idTabBSCDTLPatientCenter').html('-');
    		}

    		//Set Blood Group
    		if(data.oPatient.sBloodGroup){
        		$('#idTabBSCDTLPatientBloodGrp').text(data.oPatient.sBloodGroup);
    		}else{
    			$('#idTabBSCDTLPatientBloodGrp').html('-');
    		}

    		//Set Address
    		if(data.oPatient.sAddress){
        		$('#idTabBSCDTLPatientAddress').text(data.oPatient.sAddress);
    		}else{
    			$('#idTabBSCDTLPatientAddress').html('-');
    		}

    		//Set Address
    		if(data.oPatient.sCity){
        		$('#idTabBSCDTLPatientCity').text(data.oPatient.sCity);
    		}else{
    			$('#idTabBSCDTLPatientCity').html('-');
    		}   			            		
    	}
    	//Check for Global Id
    	if("idPatientGlobalID" in data && data.idPatientGlobalID){           
    		$('#idTabBSCDTLPatientGlobalID').text(data.idPatientGlobalID);
    	}else{
    		$('#idTabBSCDTLPatientGlobalID').html('-');
    	}

    	//Check for Local Id
    	if("idPatientLocalID" in data && data.idPatientLocalID){
    		$('#idTabBSCDTLPatientLocalID').text(data.idPatientLocalID);
    	}else{
    		$('#idTabBSCDTLPatientLocalID').html('-');
    	} 

    	//Hide loader
        fHideLoader(sHref_1);
	}
</script>	                </div>
                    <div id="idTab_2" class="tab-pane full">
                    	<!-- loader -->
	        			<div class="classOverlay" ><div class="circle circle1 circle1-1"><div class="circle circle1 circle2-1"><div class="circle circle1 circle3-1"></div></div></div></div>
                    	                	</div>
                    <div id="idTab_3" class="tab-pane full">
                    	<!-- loader -->
	        			<div class="classOverlay" ><div class="circle circle1 circle1-1"><div class="circle circle1 circle2-1"><div class="circle circle1 circle3-1"></div></div></div></div>
                    	<style type="text/css">
    #idTblTreatmentPackage thead{
        font-size: 14px;
        color:#884646;
    }
    #idTblTreatmentPackage tbody{
        font-size: 14px;
        color: #636161;
    }
    .clasTab2 #idActionColumn{
        width: 16% !important;
    }
    .clasTab2 .action_btn{
        margin-bottom: 2%;
    }
    .classFullwidth_100{
        width: 100%;
        display: inline-flex;
    }
    .classLable label {
        color: #737373ed;
        font-size: 13px;
    }
    .btn-report{
        width: 52px;
        height: 10px;
        padding: 0px 8px 10px 8px;
    }
    #idAvailableServicesColumn{
        width: 60px !important;
    }
</style>
<p style='margin-top: 5%;font-size: 20px;color: brown;'><b>This Feature is disabled...</b></p>	                </div>
                    <div id="idTab_4" class="tab-pane full">
                    	<!-- loader -->
	        			<div class="classOverlay" ><div class="circle circle1 circle1-1"><div class="circle circle1 circle2-1"><div class="circle circle1 circle3-1"></div></div></div></div>
                    	<style type="text/css">
    .clasTab3{
        width: 100%;
        height: 100%
    }
    .classFullwidth{
        width: 100%;
        margin-bottom: 2%;
    }
    .class_width_100{
        width: 100%;  
        display: inline-flex;      
    }
    .class_width_100_no_float{
        width: 100%;         
    }
    .class_width_50{
        width: 50%;        
    }
    .class_width_20{
        width: 20%;
    }
    .class_width_10{
        width: 10%;
    }
    .class_width_12{
        width: 12%;
    }
    .class_width_5{
        width: 5%;
    }
    .treament_package_info{
        width: 100%; 
        border: 1px solid lightgray;
        border-radius: 5px;
        display: inline-flex;
        color: black;
    }
    .treament_package_info .treament_package_count{
        width: 15%;
        background: #aaa;
        color: white;
        font-size: 2em;
        padding: 68px 0px 10px 0px;
        border-radius: 4px 0px 0px 4px;
        font-weight: bold;
    }
    .treament_package_info .treament_package_data{
        width: 85%;
        background: #e8e8e6;
        border-radius: 0px 5px 5px 0px;        
    }
    .treament_package_session_info{
        width: 100%;         
        display: inline-flex;
        color: black;
    }
    .treament_package_session_info .treament_package_session_empty{
        width: 15%;
        display: hidden;
    }
    .treament_package_session_info .treament_package_session_data{
        width: 85%;
        border: 1px solid lightgray;
    }
    .treament_package_info .action_btn{
        padding: 6px;
    }
    .incomplete {
        background: #26b0e4b8 !important;
    }
    .classPackage_heading{
        font-size: 14px;
        color: #4c3030;
        font-weight: bold;
        text-align: left;
        padding: 10px;
        text-shadow: 2px 3px 6px #777777;
    }
    .class_icon{
        padding: 4px;
        margin-left: 6px;
    }
    .class_key{
        padding: 2px;
    }
    .class_value{
        padding: 3px;
        color: #776e6e;
    }
    .text-danger{
        color: brown;
    }
    .session_heading{
        background: #6ccac9;
        color: white;
        padding: 10px;
        font-size: 14px;
        width: 100%;
        text-align: left;
        font-weight: bold;
    }
    .sess_no{
        margin: 9px 0px 0px 0px;
        background: #c5cece;
        color: white;
        padding: 3px;
        border-bottom-right-radius: 4px;
        border-top-right-radius: 4px;
        width: 50%;
    }
    .session_block{
        padding: 5px 0px 26px 0px;
        border-bottom: 1px solid lightgray;
        background: #f6f6f6;
    }
    .schedule_date_block{
        width: 32%;
        padding: 5px;        
    }
    .schedule_date_block_time{
        background: #57c8f2;
        color: white;
        border-bottom: 3px solid #48aacf;
        padding: 4px 15px 4px 15px;
        text-align: center;
        border-top-left-radius: 5px;
        border-top-right-radius: 5px;
    }
    .schedule_date_block_date{
        background: #fff;
        border-bottom: 3px solid #eee;
        padding: 7px 15px 7px 15px;
        text-align: center;
        -webkit-border-radius: 0px 0px 6px 6px;
        border-radius: 0px 0px 6px 6px;
        height: 50px;
    }
    .schedule_date_block_date_day{
        font-size: 20px;
        margin-top: 5px;
    }
    .schedule_date_block_date_month_year{
        color: #828282;
        margin-top: 14px;
    }
    .treament_package_count p span{
        font-size: 12px;
        line-height: 20px;
    }

    #idTablePatientUpcomingSchedules thead{
        font-size: 14px;
        color:#884646;
    }
    #idTablePatientUpcomingSchedules tbody{
        font-size: 14px;
        color: #636161;
    }
    #idTab3Date{
        width: 10% !important;
    }
    #idTab3Timing{
        width: 14% !important;
    }
</style>
<h4>Today's And Upcoming Appointments</h4>
<table class="table table-hover table-bordered" id="idTablePatientUpcomingSchedules" >
    <thead> 
        <tr>
            <th>#</th>
            <th id="idTab3Date">Date</th>
            <th id="idTab3Timing">Timings</th>
            <th>Center</th>
            <th>Therapy</th>
            <!-- <th>Area</th> -->
            <th>Perform by</th>
            <th>Booked by</th>
            <th>Comments</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody id="idTablePatientUpcomingSchedules" align="center">
    </tbody>
</table>
<div class="classTab3"></div>
<script type="text/javascript">
    $(document).ready(function(){   
        sHref_3 = '#idTab_3';//Set value for loader            
    });
    $(document).on('click', '.classShowSession', function(){
        var sId = $(this).attr('id');
        var aParts = sId.split('_');
        var sBlock = "#idBlockSession_"+aParts[1];
        $(sBlock).show(500);
        $('#idHideSession_'+aParts[1]).show();
        $('#idShowSession_'+aParts[1]).hide();
    });

    $(document).on('click', '.classHideSession', function(){
        var sId = $(this).attr('id');
        var aParts = sId.split('_');
        var sBlock = "#idBlockSession_"+aParts[1];
        $(sBlock).hide(500);
        // $('.treament_package_session_info').hide(1000);
        $('#idHideSession_'+aParts[1]).hide();
        $('#idShowSession_'+aParts[1]).show();
    });

    function fLoadTabPageData3(iTabPage3PatientID){
        fShowLoader(sHref_3);
        $.ajax({
            type: 'get',
            url:"ajaxPatienRecordPopup.php?sFlag=GetPatientPackageHistoryDataForPopup",
            data: {
                iPatientDetailsPatientID: iTabPage3PatientID,                
            },
            success : function (data){
                getPatientUpcomingAppointments(iTabPage3PatientID);    
                fRendarDataForPatientPackageHistory(data);   
            }
        });        
    }

    //Rendar Patient Package History data
    function fRendarDataForPatientPackageHistory(data){
        if(data.length > 0){
            var sBlockPatientPackageHistory = '';
            $.each(data, function(iIndex, aHealthPackageData){
                var iCount = (iIndex + 1);
                var sCompleteClass = aHealthPackageData['sCompleteClass'];
                var iUserServieCount = aHealthPackageData['iUserServieCount'];
                var iTotalServices = aHealthPackageData['iTotalServices'];
                var sPackageName = aHealthPackageData['sPackageName'];
                var iBillID = aHealthPackageData['iBillID'];
                var sBillAmount = aHealthPackageData['fBillAmount'];   
                var fBillPaidAmount = aHealthPackageData['fBillPaidAmount']; 
                var sBillStatus = aHealthPackageData['fBillStatus'];
                var dPackageValidFrom = aHealthPackageData['dPackageValidFrom'];
                var dPackageValidTill = aHealthPackageData['dPackageValidTill'];
                var sActivatedBy = aHealthPackageData['sActivatedBy'];
                var sPackageActivationNotes = aHealthPackageData['sPackageActivationNotes'];      

                var sBlockPatientPackageHistoryStart ='<div class="classFullwidth"><div class="treament_package_info"><div class="treament_package_count '+sCompleteClass+'">'+iUserServieCount+'/'+iTotalServices+'<p><span>Sessions</span></p></div><div class="treament_package_data"><div class="class_width_100"><div class="class_width_50"><div class="classPackage_heading"><span>'+sPackageName+'</span></div></div><div class="class_width_50" ><div class="action_btn"><a class="btn btn-primary btn-shadow btn-sm pull-right" target="_blank" title="View Bill" href="viewOPDBill.php?iBillID='+iBillID+'" title="View Bill"><i class="fa fa-money"></i></a><a href="javascript:void(0)" id="idHideSession_'+iCount+'" class="btn btn-primary btn-shadow btn-sm pull-right classHideSession" title="Show Session" title="Show Sessions" style="margin-right: 5px;display: none;"><i class="fa fa-chevron-up"></i></a><a href="javascript:void(0)" id="idShowSession_'+iCount+'" class="btn btn-primary btn-shadow btn-sm pull-right classShowSession" title="Show Session" title="Show Sessions" style="margin-right: 5px;"><i class="fa fa-chevron-down"></i></a></div></div></div><div class="class_width_100"><div class="classPackage_info"><div class="class_width_100"><div class="class_width_20"><div class="class_width_100"><div class="class_icon"><i class="fa fa-inr"></i></div><div class="class_key">Bill Amount</div></div><div class="class_width_100"><div class="class_icon"><i class="fa fa-inr"></i></div><div class="class_key">Paid Amount</div></div><div class="class_width_100"><div class="class_icon"><i class="fa fa-inr"></i></div><div class="class_key">Payment Status</div></div><div class="class_width_100"><div class="class_icon"><i class="fa fa-clock-o"></i></div><div class="class_key">Validity</div></div><div class="class_width_100"><div class="class_icon"><i class="fa fa-user"></i></div><div class="class_key">Activated By</div></div><div class="class_width_100"><div class="class_icon"><i class="fa fa-comment"></i></div><div class="class_key">Activation Note</div></div></div><div class="class_width_50" style="text-align: left;"><div class="class_value"><span>'+sBillAmount+'</span></div><div class="class_value"><span>'+fBillPaidAmount+'</span></div><div class="class_value"><span>'+sBillStatus+'</span></div><div class="class_value"><span>'+dPackageValidFrom+' to '+dPackageValidTill+'</span></div><div class="class_value"><span>'+sActivatedBy+'</span></div><div class="class_value"><span>'+sPackageActivationNotes+'</span></div></div></div><div class="class_width_100_no_float"></div></div></div></div></div><div class="treament_package_session_info" style="display: none;" id="idBlockSession_'+iCount+'"><div class="treament_package_session_empty"></div><div class="treament_package_session_data"><div class="class_width_100"><div class="session_heading"><i class="fa fa-bars"></i><span>USAGE INFORMATION</span></div></div>';

                    var sBlockPatientPackageHistoryMiddle = '';       

                    $.each(aHealthPackageData['aUsageData'], function(iIndexItem, aHealthPackageItemData){
                        var sSessNo = aHealthPackageItemData['sess_no'];
                        var sServiceCount = aHealthPackageItemData['iServiceCount'];
                        var fItemRate = aHealthPackageItemData['item_rate'];
                        var dUsedOn = aHealthPackageItemData['used_on'];
                        var dDay = aHealthPackageItemData['sDay'];
                        var sMonthYear = aHealthPackageItemData['sMonthYear'];
                        let sScheduleStatus = aHealthPackageItemData['sScheduleStatus'];
                        let sDisplay = (dDay == "")?"none":"";

                        sBlockPatientPackageHistoryMiddle += `
                        <div class="class_width_100 session_block" >
                                <div class="class_width_5">
                                    <div class="sess_no">
                                        <span>`+sSessNo+`</span>
                                    </div>
                                </div>
                                <div class="class_width_12">
                                    <div class="class_width_100">
                                        <div class="class_key">Service Name
                                        </div>
                                    </div>
                                    <div class="class_width_100">
                                        <div class="class_key">Usage Charge
                                        </div>
                                    </div>
                                    <div class="class_width_100">
                                        <div class="class_key">Usage Date
                                        </div>
                                    </div>
                                    <div class="class_width_100">
                                        <div class="class_key">Status
                                        </div>
                                    </div>
                                </div>
                                <div class="class_width_20" style="text-align: left;">
                                    <div class="class_value">
                                        <span>`+sServiceCount+`</span>
                                    </div>
                                    <div class="class_value">
                                        <span>`+fItemRate+`</span>
                                    </div>
                                    <div class="class_value">
                                        <span>`+dUsedOn+`</span>
                                    </div>
                                    <div class="class_value">
                                        <span>`+sScheduleStatus+`</span>
                                    </div>
                                </div>
                                <div class="class_width_50" style="text-align: -webkit-right;" title="Used ON">
                                    <div class="schedule_date_block" style="display:`+sDisplay+`" >
                                        <div class="schedule_date_block_time" >
                                            <span>Schedule Date</span>
                                        </div>
                                        <div class="schedule_date_block_date" >
                                            <div class="schedule_date_block_date_day">
                                                <span>`+dDay+`</span>
                                            </div>
                                        <div class="schedule_date_block_date_month_year">
                                            <span>`+sMonthYear+`</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                    });
                       
                   var sBlockPatientPackageHistoryEnd = '</div></div></div>';
                sBlockPatientPackageHistory += sBlockPatientPackageHistoryStart+sBlockPatientPackageHistoryMiddle+sBlockPatientPackageHistoryEnd;
            });
            fHideLoader(sHref_3);            
        }else{
            sBlockPatientPackageHistory += '<h4>No Package History data available</h4>';
            fHideLoader(sHref_3);
        }
        $('.classTab3').html(sBlockPatientPackageHistory);
    }

    // get patient upcoming appointments
    function getPatientUpcomingAppointments(iPatientId){
        window.oTableUIDataTablApmntHistory = $('#idTablePatientUpcomingSchedules').dataTable( {
            "processing": true,
            "serverSide": true,
            "searching": false,
            "ordering": false,
            "destroy": true,
            "pageLength":5,
            "order": [[ 0, "asc" ]],
            "columnDefs": [ { "targets": [0,1,2,3,4,5,6,7,8], "orderable": false } ],
            "ajax": {
                "url": "ajaxPatienRecordPopup.php?sFlag=GetPatientAppointmentHistory&isDataTable=1",
                "data": function(d) {
                    d.iPatientDetailsPatientID = iPatientId;
                    d.dDateFrom = moment().format('YYYY-MM-DD');
                    d.dDateTo = moment().add('2','years').format('YYYY-MM-DD');
                    d.iIsUpcomingAppointments = 1;
                },
            },
            "lengthChange": false,
            drawCallback:function(){
                //$('#idTblAppointmentHistory td:contains(Cancelled)').parent().css('background','red');
            }           
        });
    }
</script>

	                </div>
                    <div id="idTab_5" class="tab-pane full">
                    	<!-- loader -->
	        			<div class="classOverlay" ><div class="circle circle1 circle1-1"><div class="circle circle1 circle2-1"><div class="circle circle1 circle3-1"></div></div></div></div>
                    	<style type="text/css">
    #idTblAppointmentHistory thead{
        font-size: 14px;
        color:#884646;
    }
    #idTblAppointmentHistory tbody{
        font-size: 14px;
        color: #636161;
    }
    #idTab6Date{
        width: 10% !important;
    }
    #idTab6Timing{
        width: 14% !important;
    }
    .classAddAppointmentFromPatientDetailsPopup{
        margin-bottom: 10%;
    }
</style>
<div class="">
    <div class="pull-right">
        <!-- <a class="btn btn-primary btn-shadow btn-sm classAddAppointmentFromPatientDetailsPopup" href="javascript:void(0)" onclick="fOpenPatientSerachModal('20-07-2018','');" ><i class="fa fa-plus"></i> Add Appointment</a> -->
    </div>
	<!-- Listing -->
    <table class="table table-hover table-bordered" id="idTblAppointmentHistory" >
        <thead> 
            <tr>
                <th>#</th>
                <th id="idTab6Date">Date</th>
                <th id="idTab6Timing">Timings</th>
                <th>Center</th>
                <th>Therapy</th>
                <!-- <th>Area</th> -->
                <th>Perform by</th>
                <th>Booked by</th>
                <th>Comments</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody id="idBodyAppointmentHistory" align="center">
        </tbody>
    </table>
    <!-- End of Listing -->
</div>
<script type="text/javascript">
	$(document).ready(function(){	
		sHref_6 = '#idTab_6';//Set value for loader       
    });

    function fLoadTabPageData6(iTabPage6PatientID){
        fShowLoader(sHref_6);        
        // get patient appointment history         
        window.oTableUIDataTablApmntHistory = $('#idTblAppointmentHistory').dataTable( {
            "processing": true,
            "serverSide": true,
            "searching": false,
            "ordering": false,
            "destroy": true,
            "pageLength":15,
            "order": [[ 0, "asc" ]],
            "columnDefs": [ { "targets": [0,1,2,3,4,5,6,7,8], "orderable": false } ],
            "ajax": {
                "url": "ajaxPatienRecordPopup.php?sFlag=GetPatientAppointmentHistory&isDataTable=1",
                "data": function(d) {
                    d.iPatientDetailsPatientID = iTabPage6PatientID;
                    d.dDateFrom = getCurrentDate('yy-mm-dd', 'last_month');
                    d.dDateTo = getCurrentDate('yy-mm-dd');
                },
            },
            "lengthChange": false,
            drawCallback:function(){
                $('#idTblAppointmentHistory td:contains(Cancelled)').parent().css('background','#ff9292');
            }           
        });
  
        fHideLoader(sHref_6);
    }

    $(document).on('click', '.classAddAppointmentFromPatientDetailsPopup', function(){
        var iPatientIdForAddAppointment = $('.classTabAnchor').attr('data-patient_id');
        if(iPatientIdForAddAppointment){
            window.location.href = "appointmentCalendar.php?openScheduleManager&iAddAppointment=1&iPatientId="+iPatientIdForAddAppointment;
        }
    });       
</script>	                </div>
                    <div id="idTab_6" class="tab-pane full">
                    	<!-- loader -->
	        			<div class="classOverlay" ><div class="circle circle1 circle1-1"><div class="circle circle1 circle2-1"><div class="circle circle1 circle3-1"></div></div></div></div>
                    	
<style type="text/css">
    #idTblServicetHistory thead{
        font-size: 14px;
        color:#884646;
    }
    #idTblServicetHistory tbody{
        font-size: 14px;
        color: #636161;
    }
    .classSchHrefLink{
        color: #636161 !important;
    }
</style>

    <div class="classPanelBody" id='idPanelBody'>

        <div class="row-fluid">

            <div class="span2">
                <label class="control-label classLabel" for="idResult">From</label>
                <input  class='classInputText classServiceFromDate' type='text' name='idServiceFromDate' id='idServiceFromDate' readonly='readonly' style="width:100%;"/>
            </div>

            <div class="span2">
                <label class="control-label classLabel" for="idResult">To</label>
                <input  class='classInputText classServiceDate' type='text' name='idServiceToDate' id='idServiceToDate' readonly='readonly' style="width: 100%;"/>
            </div>

            <div class="span2">
                <label class="control-label classLabel" for="idResult">Type</label>
                <select  class='classSelectBox' name="idServiceCategory" id="idServiceCategory" style="width: 100%;">
                    <option value="0">Select Any</option>
                    <option value="1">Consultation</option>
                    <option value="2">Investigation</option>
                    <option value="3">Radiology</option>
                    <option value="4">IPD</option>
                </select>
            </div>

            <div class="span1">
                <span class="btn btn-small btn-primary classBtnSearchServices" id="idBtnSearchServices" style="margin-top: 25px;">Search</span>
            </div>
        </div>
        <hr>

        <!-- Listing -->
        <table class="table table-hover table-bordered" id="idTblServicetHistory" >
            <thead> 
                <tr>
                    <th width= "4%">Sr. No</th>
                    <th>Visit Date</th>

                                        <th>Type</th>
                    
                    <th>Modality</th>
                    <th>Procedure / Surgery</th>
                    <th>Doctor/Team</th>
                    <th>Finalized By</th>
                    <th>Action</th>
                    <th><input type="checkbox" name="idAllPatientMedicalRecordPrint" id="idAllPatientMedicalRecordPrint" class="classAllPatientMedicalRecordPrint" /></th>
                </tr>
            </thead>


            <tbody id="idBodyServiceHistory" align="center">
            </tbody>
        </table>
        <!-- End of Listing -->

        <input  class='btn btn-success btn-small pull-right' id="idPrintBulkServiceReports" type='button' value='Bulk Print' style="display: none;margin: 5px;">
        <input  class='btn btn-success btn-small pull-right' id="idPrintAdmissionSummaryInSinglePDF" type='button' value='Admission Summary Bulk Print' style="display: none;margin: 5px;">

    </div>

<script type="text/javascript">

    var iPatientID = "96";
    var iLoggedInStaffID = "411";
    var iStaffClinicID = "2";
    var iReportBulkPrintCount = 0;
    var iSummaryBulkPrintCount = 0;
    var iManageSuperService = "1";

	$(document).ready(function(){
		sHref_4 = '#idTab_4';//Set value for loader

        var dThreeMonthDate = "09-08-2025";
        var dOneYearDate = "09-11-2024";
        var dCurrentDate = "09-11-2025";

        $('.classServiceDate').datepicker({
            changeMonth: true,
            dateFormat: "dd-mm-yy",
            changeYear: true,
        }).datepicker("setDate", dCurrentDate);

        $('.classServiceFromDate').datepicker({
            changeMonth: true,
            dateFormat: "dd-mm-yy",
            changeYear: true,
        }).datepicker("setDate", dThreeMonthDate)

        //! For check and uncheck all..
        $(".classAllPatientMedicalRecordPrint").on("click",function () {
            $("#idPrintBulkServiceReports").css("display","none");
            if ($(this).prop("checked")) {
                $(".classPrintServiceBulkReport").prop("checked", true);
                if ($(document).find(".classPrintServiceBulkReport").length > 0) {
                    $("#idPrintBulkServiceReports").css("display","");
                }
            } else {
                $(".classPrintServiceBulkReport").prop("checked", false);
            }
        });
    });

    // Search Service with Attached filter
    $('#idBtnSearchServices').click(function(){
        var dFromDate = $('#idServiceFromDate').val();
        var dToDate  = $('#idServiceToDate').val();
        var iServiceCategoryID = $('#idServiceCategory').val();

        var iIsIPD = 0;

        if(iServiceCategoryID == 4){
            iIsIPD = 1;
        }

        //! for added datatable...
        if ( $.fn.dataTable.isDataTable( '#idTblServicetHistory' ) ) {
            table = $('#idTblServicetHistory').DataTable();
            table.destroy();
        }

        if(iIsIPD == 1){
            fGetServicesForPatientByCategoryIPD(iPatientID,dFromDate,dToDate)
        }else{
            fGetServicesForPatientByCategory(iPatientID,dFromDate,dToDate,iServiceCategoryID);
        }
    });

    // Function to format output
    function fFormatOutput(sValue,sPlaceholder = "NA"){

        if(sValue == "" || sValue == null || sValue == undefined){
            return sPlaceholder;
        }else{
            return sValue;
        }
    }

    //functio to get all services details for patint's admission
    function fGetServicesForPatientByCategoryIPD(iPatientID,dFromDate,dToDate){

        // set max print count to 0
        iSummaryBulkPrintCount = 0;

        var aData = {iPatientID:iPatientID,dFromDate:dFromDate,dToDate:dToDate,iIsIPD:1};

        $.ajax({
            url: "ajaxPatientServices.php?sFlag=fGetServiceForPatient",
            type: 'POST',
            data:aData,
            success: function (data){

                if($.trim(data) != false) {
                    var oTempData = $.parseJSON(data);
                    var sTemplate = '';
                    var iSrNo = 1;
                    var iDisplayLength = 0;

                    for (var ppp=0; ppp <oTempData.length ; ppp++) {

                        var dAdmitDate = oTempData[ppp]['dAdmitDate'];
                        var sType = fFormatOutput(oTempData[ppp]['super_service_type']);
                        var sReasonForAdmission = oTempData[ppp]['admission_reason'];
                        var sModality = fFormatOutput(oTempData[ppp]['service_type']);
                        var sStaffName = oTempData[ppp]['staff_name'];
                        var sFinalizedBy = fFormatOutput(oTempData[ppp]['last_updated_by']);
                        var sDischargedBy = fFormatOutput(oTempData[ppp]['sDischargedBy']);
                        var iBillID = oTempData[ppp]['iBillID'];
                        var sVisitNo = oTempData[ppp]['visit_no'];
                        var sBedNo = oTempData[ppp]['sBedNo'];
                        var iAdmitID = oTempData[ppp]['admit_id'];
                        var tAdmitTime = oTempData[ppp]['tAdmitTime'];
                        var sRoomWardName = oTempData[ppp]['sRoomWardName'];

                        var aSurgeryDetails = oTempData[ppp]['aSurgeryDetails'];

                        sTemplate +=  '<tr>';
                        sTemplate +=  '<td>'+iSrNo+'</td>';
                        sTemplate +=  '<td>'+dAdmitDate+'</td>';

                        // Directorate --Show only when config enabled-- 
                        if(iManageSuperService == 1){
                            sTemplate +=  '<td>'+sType+'</td>';
                        }

                        sTemplate +=  '<td>'+sModality+'</td>';
                        sTemplate +=  '<td>'+sRoomWardName+' ( Bed - '+sBedNo+' ) </td>';
                        sTemplate +=  '<td>'+sStaffName+'</td>';
                        sTemplate +=  '<td>'+sDischargedBy+'</td>';

                        sTemplate +=  '<td><a href="viewIPDBill.php?iBillID='+iBillID+'" target="_blank" class="btn btn-mini btn-primary" title="View Bill">View Bill</a><br><a class="btn btn-mini btn-primary classPrintCurrentAdmissionSummary" id="id_'+iAdmitID+'" data-admit-date='+dAdmitDate+' data-admit-time='+tAdmitTime+' data-visit-no='+sVisitNo+' data-bed-no='+sBedNo+' style="margin-top: 5px;" title="Print Admission Summary">Export</a><br><a href="ipdManager.php?iAdmitID='+iAdmitID+'&iPatientID='+iPatientID+'" target="_blank" class="btn btn-mini btn-primary" style="margin-top: 5px;" title="View Admission">View</a></td>';

                        sTemplate +=  '<td><input type="checkbox" class="classExportAdmissionSummary" name="idExportAdmissionSummary" id="idExportAdmissionSummary" data-admit-id='+iAdmitID+' data-admit-date='+dAdmitDate+' data-admit-time='+tAdmitTime+' data-visit-no='+sVisitNo+' data-bed-no='+sBedNo+' value="0"/></td>';

                        sTemplate +=  '</tr>';

                        iSrNo++;
                    }

                    $('#idBodyServiceHistory').html("");
                    $('#idBodyServiceHistory').html(sTemplate);

                    //! for added datatable...
                    if ( $.fn.dataTable.isDataTable( '#idTblServicetHistory' ) ) {
                        table = $('#idTblServicetHistory').DataTable();
                    }
                    else {
                        $('#idTblServicetHistory').DataTable({
                            "bSearchable": false,
                            "bLengthChange": false,
                            "bFilter": false,
                            "bInfo": false,
                            'iDisplayLength': 8,
                            "bResponsive":true,
                            "aLengthMenu": [[10, 25, 50, 100, 200, -1], [10, 25, 50, 100, 200, "All"]],
                            "bSort":false,
                        });
                    }

                    // change column names dynamically
                    sTable = $('#idTblServicetHistory').DataTable();
                    $(sTable.column(1).header()).text('Admit Date');
                    $(sTable.column(4).header()).text('Ward/Bed');
                    $(sTable.column(6).header()).text('Discharged By');
                }
                else{
                    ('#idBodyServiceHistory').html('<tr><td colspan="7">No records availlable.</td></tr>');
                }
            }
        });
    }

    //function to get all patient services details [Radiology , Consultation , Pathology]
    function fGetServicesForPatientByCategory(iPatientID,dFromDate,dToDate,iServiceCategoryID){

        // set bulk print count to 0
        iReportBulkPrintCount = 0;

        var iServiceType = iServiceCategoryID;

        var aData = {iPatientID:iPatientID,dFromDate:dFromDate,dToDate:dToDate,iServiceCategoryID:iServiceCategoryID};

        $.ajax({
            url: "ajaxPatientServices.php?sFlag=fGetServiceForPatient",
            type: 'POST',
            data:aData,
            success: function (data){
                if($.trim(data) != false) {
                    var oTempData = $.parseJSON(data);
                    var sTemplate = '';
                    var iSrNo = 1;
                    var iDisplayLength = 0;

                    for (var ppp=0; ppp <oTempData.length ; ppp++) {
                            var dVisitDate = oTempData[ppp]['schedule_date'];
                            var sType = fFormatOutput(oTempData[ppp]['super_service_type']);
                            var sProcedure = oTempData[ppp]['service_name'];
                            var sModality = oTempData[ppp]['service_type'];
                            var sStaffName = oTempData[ppp]['staff_name'];
                            var sFinalizedBy = fFormatOutput(oTempData[ppp]['last_updated_by']);
                            var iBillID = oTempData[ppp]['iBillID'];
                            var iConsultationID = oTempData[ppp]['consultation_id'];
                            var iServiceID = oTempData[ppp]['service_id'];
                            var iScheduleID = oTempData[ppp]['schedule_id'];
                            var iIsCancelledAppt = oTempData[ppp]['is_cancelled_appointment'];

                            if(iIsCancelledAppt == 1){
                                sTemplate +=  '<tr style="background-color:#fbcdd2;">';
                            }else{
                                sTemplate +=  '<tr>';
                            }

                            sTemplate +=  '<td>'+iSrNo+'</td>';
                            sTemplate +=  '<td>'+dVisitDate+'</td>';

                            // Directorate --Show only when config enabled-- 
                            if(iManageSuperService == 1){
                                sTemplate +=  '<td>'+sType+'</td>';
                            }

                            sTemplate +=  '<td>'+sModality+'</td>';
                            sTemplate +=  '<td>'+sProcedure+'</td>';
                            sTemplate +=  '<td>'+sStaffName+'</td>';
                            sTemplate +=  '<td>'+sFinalizedBy+'</td>';

                            if(iIsCancelledAppt != 1){
                                sTemplate +=  '<td><a href="viewOPDBill.php?iBillID='+iBillID+'" target="_blank" class="btn btn-mini btn-primary" title="View Bill">View Bill</a><br><a class="btn btn-mini btn-primary classPrintCurrentConsultationReport" data-consultation-id='+iConsultationID+' data-service-id='+iServiceID+' data-service-category='+iServiceType+' style="margin-top: 5px;" title="Print Report">Print</a><br><a href="gotoStudy.php?schedule_id='+iScheduleID+'&service_id='+iServiceID+'" target="_blank" class="btn btn-mini btn-primary" style="margin-top: 5px;" title="View Consultation">View</a></td>';

                                sTemplate +=  '<td><input type="checkbox" class="classPrintServiceBulkReport" name="idBulkServiceReport" id="idBulkServiceReport" data-consultation-id='+iConsultationID+' data-service-id='+iServiceID+' value="0"/></td>';
                            }else{

                                sTemplate +=  '<td></td>';
                                sTemplate +=  '<td></td>';
                                
                            }

                            sTemplate +=  '</tr>';

                            iSrNo++;
                        }

                        $('#idBodyServiceHistory').html("");
                        $('#idBodyServiceHistory').html(sTemplate);

                        //! for added datatable...
                        if ( $.fn.dataTable.isDataTable( '#idTblServicetHistory' ) ) {
                            table = $('#idTblServicetHistory').DataTable();
                        }
                        else {
                            $('#idTblServicetHistory').DataTable({
                                "bSearchable": false,
                                "bLengthChange": false,
                                "bFilter": false,
                                "bInfo": false,
                                'iDisplayLength': 30,
                                "bResponsive":true,
                                "aLengthMenu": [[10, 25, 50, 100, 200, -1], [10, 25, 50, 100, 200, "All"]],
                                "bSort":false,
                            });
                        }

                        // change column names dynamically
                        sTable = $('#idTblServicetHistory').DataTable();
                        // $(sTable.column(4).header()).text('Procedure');
                        // $(sTable.column(6).header()).text('Finalized By');

                        if(iManageSuperService == 0){
                            sTable.column(2).visible(false);
                        }
                    }
                    else{
                        $('#idBodyServiceHistory').html('<tr><td colspan="7">No records availlable.</td></tr>');
                    }
                }
            });
    }

        // To hide/show bulk export consultation reports & validations
        $(document).on("click", ".classPrintServiceBulkReport", function(e){

            iIsChecked = $(this).prop('checked');

            if(iIsChecked){
                iReportBulkPrintCount++;

                if(iReportBulkPrintCount > 10){

                    iReportBulkPrintCount--;

                    $(this).prop('checked',false);
                    alert("Only Max 10 Reports Are Allowed");
                    return false;
                }

                var iConsultationID = $(this).data('consultation-id');

                if(iConsultationID == null || iConsultationID == undefined || iConsultationID == 0){
                    alert("Consultation Must Be Finalized Or In a Draft To Print");
                    $(this).prop('checked',false);
                    iReportBulkPrintCount--;
                    return false;
                }

            }else{
                iReportBulkPrintCount--;
            }

            if(iReportBulkPrintCount > 0){
                $("#idPrintBulkServiceReports").css("display","");
            }else{
                $("#idPrintBulkServiceReports").css("display","none");
            }

        });

        // To hide/show bulk export consultation reports & validations
        $(document).on("click", ".classExportAdmissionSummary", function(e){

            iIsChecked = $(this).prop('checked');

            if(iIsChecked){
                iSummaryBulkPrintCount++;

                if(iSummaryBulkPrintCount > 10){

                    iSummaryBulkPrintCount--;

                    $(this).prop('checked',false);
                    alert("Only Max 10 Reports Are Allowed");
                    return false;
                }

            }else{
                iSummaryBulkPrintCount--;
            }

            if(iSummaryBulkPrintCount > 0){
                $("#idPrintAdmissionSummaryInSinglePDF").css("display","");
            }else{
                $("#idPrintAdmissionSummaryInSinglePDF").css("display","none");
            }

        });


        // To Print consultation reports
        $(document).on("click", ".classPrintCurrentConsultationReport", function(e){

            e.preventDefault();

            var aConsultationDetails = this.id.split("_");

            var iConsultationID = $(this).data('consultation-id');
            var iServiceID = $(this).data('service-id');
            var iServiceType = $(this).data('service-category');
            var sPrintType = "singlePrint";

            if(iConsultationID == null || iConsultationID == undefined || iConsultationID == 0){
                alert("Consultation Must Be Finalized Or In a Draft To Print");
                return false;
            }

            var aData = {iConsultationID:iConsultationID,iServiceID:iServiceID,iStaffClinicID:iStaffClinicID,iLoggedInStaffID:iLoggedInStaffID,sPrintType:sPrintType,iServiceType:iServiceType};

            $.ajax({
                url: "exportPatientRecordServicesToPDF.php",
                type: 'POST',
                data:aData,
                success: function (data){
                    fPrintCurrentConsultationReport(data);
                }
            });
        });

        // Export Consultation Report In Single PDF
        $(document).on("click", "#idPrintBulkServiceReports", function(e){

            var aConsultationID=[];
            var aServiceType=[];
            var aServiceID=[];

            var firstColValues = "";

            sTable = $('#idTblServicetHistory').DataTable();

            sTable.rows().nodes().to$().find('input[type="checkbox"]').each(function(){

                iIsChecked = $(this).prop('checked');

                if(iIsChecked){

                    var iConsultationID = $(this).data('consultation-id');
                    var iServiceID = $(this).data('service-id');

                    if(iConsultationID != 0 && iConsultationID !== undefined && iConsultationID != null){
                        aConsultationID.push(iConsultationID);
                        aServiceID.push(iServiceID);
                    }
                }
            });

            var aData = {aConsultationID:aConsultationID,aServiceID:aServiceID,iStaffClinicID:iStaffClinicID,iLoggedInStaffID:iLoggedInStaffID,iPatientID:iPatientID,bPrintAllPrintableEntities:true};

            $.ajax({
                url: "exportServiceReportsInSinglePDF.php",
                type: 'POST',
                data:aData,
                success: function (data){
                    window.open("viewFile.php?token="+data , '_blank');
                }
            });
        });

        // Export admission summary in single pdf
        $(document).on("click", "#idPrintAdmissionSummaryInSinglePDF", function(e){

            var aAdmitID = [];
            var aBedNo = [];
            var aAdmitDate = [];
            var aAdmitTime = [];
            var aVisitNo = [];

            sTable = $('#idTblServicetHistory').DataTable();
            sTable.rows().nodes().to$().find('.classExportAdmissionSummary').each(function(){

                iIsChecked = $(this).prop('checked');

                if(iIsChecked){

                    var iAdmitID = $(this).data('admit-id');
                    var sBedNo = $(this).data('bed-no');
                    var dAdmitDate = $(this).data('admit-date');
                    var tAdmitTime = $(this).data('admit-time');
                    var sVisitNo = $(this).data('visit-no');

                    // Add current row values in array
                    aAdmitID.push(iAdmitID);
                    aBedNo.push(sBedNo);
                    aAdmitDate.push(dAdmitDate);
                    aAdmitTime.push(tAdmitTime);
                    aVisitNo.push(sVisitNo);

                }

            });

            var aData = {aAdmitID:aAdmitID,aBedNo:aBedNo,aAdmitDate:aAdmitDate,aAdmitTime:aAdmitTime,aVisitNo:aVisitNo,iPatientID:iPatientID};

            $.ajax({
                url: "exportAdmissionSummaryInSinglePDF.php",
                type: 'POST',
                data:aData,
                success: function (data){
                    window.open("viewFile.php?token="+data , '_blank');
                }
            });
        });

        // To export admission summary report
        $(document).on("click", ".classPrintCurrentAdmissionSummary", function(e){

            e.preventDefault();

            var aAdmitDetails = this.id.split("_");
            var iAdmitID = aAdmitDetails[1];
            var sBedNo = $(this).data('bed-no');
            var dAdmitDate = $(this).data('admit-date');
            var tAdmitTime = $(this).data('admit-time');
            var sVisitNo = $(this).data('visit-no');
            var iPrint = 1;

            var aData = "?idExportAdmissionSummaryAdmitID="+iAdmitID+
                         "&idExportAdmissionSummaryPatientID="+iPatientID+
                         "&idExportAdmissionSummaryBedID="+sBedNo+
                         "&idExportAdmissionSummaryVisitNo="+sVisitNo+
                         "&idExportAdmissionSummaryAdmitDate="+dAdmitDate+
                         "&idExportAdmissionSummaryAdmitTime="+tAdmitTime+
                         "&idExportAdmissionSummaryTreatmentDetails="+iPrint+
                         "&idExportAdmissionSummaryRecommendation="+iPrint+
                         "&idExportAdmissionSummaryPrescription="+iPrint+
                         "&idExportAdmissionSummaryVitals="+iPrint+
                         "&idExportAdmissionSummaryDoctorNurseNotes="+iPrint+
                         "&idExportAdmissionSummaryChiefComplaints="+iPrint+
                         "&idExportAdmissionSummaryAdditionalServices="+iPrint+
                         "&idExportAdmissionSummaryDiagnosis="+iPrint+
                         "&idExportAdmissionSummaryOperations="+iPrint+
                         "&idExportAdmissionSummaryFluidMonitoring="+iPrint+
                         "&idExportAdmissionSummaryDiet="+iPrint+
                         "&idExportAdmissionSummaryClinicalNotes="+iPrint;


            var sSummaryURL = 'exportAdmissionSummaryPDF.php'+aData;


            window.open(sSummaryURL, '_blank');

        });

        // function to print consultation report
        function fPrintCurrentConsultationReport(aReportData){
            if (aReportData['url'] && aReportData['query_data']) {
                $.ajax({
                    type: 'POST',
                    url: aReportData['url'],
                    data:aReportData['query_data'],
                    success: function (data){
                        if($.trim(data) != false) {
                            window.open("viewFile.php?token="+data , '_blank');
                        }
                    }
                });
            }
        }

    function fLoadTabPageData4(iPatientID){

        var dFromDate = $('#idServiceFromDate').val();
        var dToDate  = $('#idServiceToDate').val();
        var iServiceCategoryID = $('#idServiceCategory').val();

        fGetServicesForPatientByCategory(iPatientID,dFromDate,dToDate,iServiceCategoryID);

    }

    function markCancelledAppointments(){
        $('.classCancelledAppointment').parent().parent().css('background','red');        
    }
</script>	                </div>
                    <div id="idTab_7" class="tab-pane full">
                    	<!-- loader -->
	        			<div class="classOverlay" ><div class="circle circle1 circle1-1"><div class="circle circle1 circle2-1"><div class="circle circle1 circle3-1"></div></div></div></div>
                    	<style type="text/css">
	#idPatientsBillTable thead{
		font-size: 14px;
		color:#884646;
	}
	#idPatientsBillTable tbody{
		font-size: 14px;
		color: #636161;
	}
	.full-width{
		width: 100%;
	}
	.classPatientTotalPaidAmount{
		color: cornflowerblue;
    	font-size: 14px;
    	margin-bottom: 4px;
    	cursor: help;
	}
	.classTab8{
		flex-wrap: wrap;
    	overflow: auto;
	}
</style>
<div class="classTab8">
	<div class="full-width">
		<p class="pull-right classPatientTotalPaidAmount" title="Patients' total paid amount from registration"><span>Total Paid Amount : </span>&nbsp;<i class='fa fa-money'></i> <span id="idfPatientTotalPaidAmount"></span></p>
	</div>
	<!-- Listing -->
	<table id="idPatientsBillTable" class="table table-hover table-bordered">
		<thead >
			<tr>
				<th width="3%">#</th>
				<th>Service/Package</th>
				<th>Type</th>
				<!-- <th>Session Status</th> -->
				<th>Expiry</th>
				<th>Bill No</th>				
				<th>Bill Date</th>
				<th>Bill Amount</th>
				<th>Payment Status</th>
				<th>Payment Mode</th>
				<th>Balance</th>
				<th>Payment Date</th>				
				<th>Recieved By</th>
				<th>Comment</th>
			</tr>
		</thead>
		<tbody id="idPatientsBillTableBody">
		</tbody>
	</table>	
	<!-- End of Listing -->
</div>
<script type="text/javascript">

	$(document).ready(function(){        
        sHref_8 = '#idTab_8';//Set value for loader
    });

    //! For Setting auto laod Patient id data
    function fLoadTabPageData8(iTabPage8PatientID){
        fShowLoader(sHref_8);
       
    	window.oTableUIDataTableBill = $('#idPatientsBillTable').dataTable( {
    	    "processing": true,
    	    "serverSide": true,
    	    "searching": false,
    	    "ordering": true,
    	    "destroy": true,		    	    
    	    "pageLength": 15,		    	    
    	    "columnDefs": [ { "targets": [0,1,2,3,4,5,6,7,8,9,10,11], "orderable": false }],
    	    "ajax": {
    	        "url": "ajaxPatienRecordPopup.php?sFlag=GetPatientPaymentHistoryDetails&isDataTable=1",
    	        "data": function(d) {  
    	            d.iPatientDetailsPatientID = iTabPage8PatientID;
        			d.dDateFrom = getCurrentDate('yy-mm-dd', 'last_month');
					d.dDateTo = getCurrentDate('yy-mm-dd'); 
    	        },    	        
    	    },
    	    "lengthChange": false
    	});
       
 		getPatientAllPaidAmount(iTabPage8PatientID);
 		fHideLoader(sHref_8);
    }  

	//To get total paid amount from patients' registration
	function getPatientAllPaidAmount(iTabPage8PatientID){
		fShowLoader(sHref_8);
		$.ajax({
	        url: "ajaxPatienRecordPopup.php?sFlag=GetPatientsTotalPaidAmount",
	        data:{
	        		iPatientDetailsPatientID: iTabPage8PatientID,	        		
	        	},
	        asyn: false,
	        success: function (data){
	        	if(data){
	        		if(data.fPatintTotalPaidAmt > 0){
		                data.fPatintTotalPaidAmt = (data.fPatintTotalPaidAmt).toFixed(2);
		            }
	        		$('#idfPatientTotalPaidAmount').text(data.fPatintTotalPaidAmt);
	        		fHideLoader(sHref_8);
	        	}else{
	        		fHideLoader(sHref_8);
	        	}
	        }
	    });
	} 
</script>	                </div>
                    <div id="idTab_8" class="tab-pane full">
                    	<!-- loader -->
	        			<div class="classOverlay" ><div class="circle circle1 circle1-1"><div class="circle circle1 circle2-1"><div class="circle circle1 circle3-1"></div></div></div></div>
                    	<style type="text/css">
	#idTablListngMotivation thead{
		font-size: 14px;
		color:#884646;
	}
	#idTablListngMotivation tbody{
		font-size: 14px;
		color: #636161;
	}
</style>
<div class="classTab9">
	<!-- Listing -->
	<table class="table table-hover table-bordered" id="idTablListngMotivation" >
	    <thead> 
	        <tr>
	            <th align='left' width="3%">#</th>
	            <th align='left' width="3%" align="center"></th>
	            <th align='left' width="12%">Assigned to</th>
	            <th align='left' width="8%">Service/Package</th>
	            <th align='left' width="8%">Reason</th>
	            <th align='left' width="10%">Status</th>
	            <th align='left' width="100px">Suggested By</th>
	            <th align='left' width="100px">Suggested on</th>
	            <th align='left' width="100px">Target Date</th>
	            <th align='left' width="9%">Clinic</th>
	            <th align='left' width="17%">Action</th>
	        </tr>
	    </thead>
	    <tbody id="idBodyMotivationListing" align="center">

	    </tbody>
	</table>
	<!-- End of Listing -->
</div>
<script type="text/javascript">
	// get patient enquiries			
    $(document).ready(function(){
		sHref_5 = '#idTab_5';//Set value for loader  
    });

    function fLoadTabPageData5(iTabPage5PatientID){
	    fShowLoader(sHref_5);
	    	  
    	window.oTableUIDataTableMotivation = $('#idTablListngMotivation').dataTable( {
    	    "processing": true,
    	    "serverSide": true,
    	    "searching": false,
    	    "ordering": true,
    	    "destroy": true,
    	    "pageLength":15,
    	    "order": [[ 7, "desc" ]],
    	    "columnDefs": [ { "targets": [7], "orderable": false },{ "targets": [0,1,2,3,4,5,6,8,9,10], "orderable": false }, { "visible": false,  "targets": [ 1,2,10 ] } ],
    	    "ajax": {
    	        "url": "ajaxEhr.php?sFlag=getMotivationDetails&isDataTable=1",
    	        "data": function(d) { 
    	            d.iIsPackage = 0;
    	            d.iPatientId = iTabPage5PatientID;    	           
    	            d.dSugestionFromDate = getCurrentDate('yy-mm-dd', 'last_month');
    	            d.dSugestionToDate = getCurrentDate('yy-mm-dd');
    	            d.iIsFromPopUp = 1;    	             	            
    	        },
    	    },
    	    "lengthChange": false,
    	    // "drawCallback": function( settings ) {
         //    	$('.classMissedTargetDate').parent().parent().css('background','#E55039');
    	    // }
    	});
	   
        fHideLoader(sHref_5);
    }
</script>	                </div>
                    <div id="idTab_9" class="tab-pane full">
                    	<!-- loader -->
	        			<div class="classOverlay" ><div class="circle circle1 circle1-1"><div class="circle circle1 circle2-1"><div class="circle circle1 circle3-1"></div></div></div></div>
                    	<style type="text/css">
	#idPatientsFollowupTable thead{
		font-size: 14px;
		color:#884646;
	}
	#idPatientsFollowupTable tbody{
		font-size: 14px;
		color: #636161;
	}
</style>
<div class="classTab9">
	<!-- Listing -->
	<table id="idPatientsFollowupTable" class="table table-hover table-bordered">
		<thead >
			<tr>
				<th width="3%">#</th>
				<th>Patient Name</th>
				<th>Type</th>
				<!-- <th>Followup type</th> -->
				<th width="127px">Date</th>
				<th>Assign To</th>
				<th>Status</th>
				<th>Description</th>
				<!-- <th>Action</th> -->
			</tr>
		</thead>
		<tbody id="idPatientsFollowupTableBody">
		</tbody>
	</table>	
	<!-- End of Listing -->
</div>
<script type="text/javascript">
	 $(document).ready(function(){
        sHref_9 = '#idTab_9';//Set value for loader    	
    });

	function fLoadTabPageData9(iTabPage9PatientID){
		fShowLoader(sHref_9);     

	 	window.oTableUIDataTableFollowup = $('#idPatientsFollowupTable').dataTable( {
    	    "processing": true,
    	    "serverSide": true,
    	    "searching": false,
    	    "ordering": true,	
    	    "destroy": true,	    	    
    	    "pageLength": 15,		    	    
    	    "columnDefs": [ { "targets": [0,1,2,3,4,5,6], "orderable": false }, { "visible": false,  "targets": [ 1,2 ] }],
    	    "ajax": {
    	        "url": "ajaxFollowupList.php?sFlag=getAllFollowupListDetails&isDataTable=1",
    	        "data": function(d) {
    	            d.iPatientId = iTabPage9PatientID;
    	            d.dStartDate = getCurrentDate('yy-mm-dd', 'last_month');
    	            d.dToDate= getCurrentDate('yy-mm-dd');
    	            d.Type = 3; //Default for followup   	            
    	        },
    	    },
    	    "lengthChange": false
    	});		
	    fHideLoader(sHref_9);
	}
</script>	                </div>
                    <div id="idTab_10" class="tab-pane full">
                    	<!-- loader -->
	        			<div class="classOverlay" ><div class="circle circle1 circle1-1"><div class="circle circle1 circle2-1"><div class="circle circle1 circle3-1"></div></div></div></div>
                    	
<style type="text/css">
    #idTblPatientPopupAttachments thead{
        font-size: 14px;
        color:#884646;
    }
    #idTblPatientPopupAttachments tbody{
        font-size: 14px;
        color: #636161;
    }
    #idColumnAttachment{
        width: 10%;
    }
    .classTab10 .classFullWidth_100{
        width: 100%;
    }
    .classTab10 .classFormSaveBtn{
        width: 100%;
        text-align: right;
        margin: -31px 7px 14px 0px;
    }
    .classTab10 .classFullWidth_50{
        width: 50%;
    }
    .classTab10 .classFullWidth_20{
        width: 20%;
    }
    .classTab10 .classFullWidth_10{
        width: 10%;
    }
    .classAddNewAttachments{
        border: 1px solid #ccc;
        border-radius: 4px;
        margin: 0px 0px 10px 0px;
        padding: 10px 0px 10px 10px;
        min-height: 100px;
    }
    .classAddNewAttachments .classFormHeadingBlock{
        margin-left: 7px;        
    }
    .classFormHeadingBlock label{
        font-size: 14px;
        color: #884646;
    }
    .classFormValueBlock{
        margin: 0px 0px 35px 0px;
    }
    .classFormValueBlock .classUploadDateForPatientPopup{
        width: 100%;
        margin-right: 2px;
    }
    .classFormValueBlock input {
        background-color: #fff;
        border: 1px solid #aaa;
        border-radius: 4px;
        padding: 13px;
        color: #00000078;
    }
    .classAddRowBtnDivPopup{
        text-align: right;
    } 
    .classAddRowBtnDivPopup .classAddRowBtnPopup{
        background: #03d5a2;
        color: white;
    }    
    .classFormValueBlock input[type="file"]{
        padding: 3px;
        width: 100%;
        margin: 0px 0px 0px 3px;
    }
</style>

<div class="classTab10">    
    <div class="classAddNewAttachments">
        <div class="row-fluid">
            <div class="span2">
                <label class="classLabel">File Name</label>
            </div>
            <div class="span2">
                <label class="classLabel">Date</label>
            </div>
            <div class="span2">
                <label class="classLabel">Uploaded By</label>
            </div>
            <div class="span3">
                <label class="classLabel">Attachments</label>
            </div>
            <div class="span2">
                <label class="classLabel">Description / Note</label>
            </div>
            <div class="span1">
            </div>
        </div>
        <div class="classFormValueBlock">
            <div class="row-fluid" id="idDiv_0">
                <div class="span2">
                    <input type="text" class="classField1 classInputTextM" name="idFileNameForPatientPopup[]" id="idFileNameForPatientPopup">
                </div>
                <div class="span2">
                    <input type="text" class="classUploadDateForPatientPopup classField2 classInputTextS" name="idUploadDateForPatientPopup[]" id="idUploadDateForPatientPopup" readonly/>
                </div>
                <div class="span2">
                    <select class="classUploadedByForPatientPopup classField3 classSelectBoxS" name="idUploadedByForPatientPopup[]" id="idUploadedByForPatientPopup"></select>
                </div>
                <div class="span3">
                    <input type="file" class="classFileForPopup classField4 classInputTextS" name="idAttachmentsForPatientPopup[]" id="idAttachmentsForPatientPopup" title="Browse File to attach" onchange="validateSize(this)" >
                </div>
                <div class="span2">
                    <textarea type="text" class="classField5" name="idDescOrNoteForPatientPopup[]" id="idDescOrNoteForPatientPopup" cols="2" rows="1"></textarea>
                </div>
                <div class="span1">
                </div>
            </div>
            <div class="ClassAppendNewBlock"></div>
            <hr>
            <div class="row-fluid">
                <div class="span2">
                    <label class="control-label classLabel" for="idResult">From</label>
                    <input  class='classInputText classUploadFromdate' type='text' name='idUploadFromdate' id='idUploadFromdate' readonly='readonly' style="width:100%;"/>
                </div>

                <div class="span2">
                    <label class="control-label classLabel" for="idResult">To</label>
                    <input  class='classInputText classUploadToDate' type='text' name='idUploadToDate' id='idUploadToDate' readonly='readonly' style="width: 100%;"/>
                </div>

                <div class="span1">
                    <span class="btn btn-small btn-primary classBtnSearchAttachments" id="idBtnSearchAttachments" style="margin-top: 25px;">Search</span>
                </div>
            </div>
        </div>
        <div class="classFormSaveBtn pull-right">          
            <a class="btn btn-success btn-sm classAddRowBtnDivPopup"  title="Add New Row"><i class="fa fa-plus"></i>&nbsp;Add New Row</a>
            <a class="btn btn-primary btn-sm" href="javascript:void(0);" id="idSaveAttachmentFormPopup"><i class="fa fa-save"></i>&nbsp;Save</a>
        </div>
    </div>
    <!-- Listing -->
    <table class="table table-hover table-bordered" id="idTblPatientPopupAttachments" >
        <thead> 
            <tr>
                <th>#</th>
                <th>File Name</th>                
                <th>Date</th>
                <th>Time</th>
                <th>Uploaded By</th>
                <th>Description/ Notes</th>
                <th id="idColumnAttachment">Attachments</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="idBodyTblPatientPopupAttachments" align="center">
        </tbody>
    </table>
    <!-- End of Listing -->   

    <hr>
    <div id="idShowPinnedHistoryTab" style="display:none;">
        <table class="table table-hover table-bordered" id="idShowPinnedHistory">
            <thead> 
                <tr>
                    <th>#</th>
                    <th>Status</th>
                    <th>Pinned/Unpinned by</th>                
                    <th>Date & Time</th>
                </tr>
            </thead>
            <tbody id="idBodyTblShowPinnedHistory" align="center">
            </tbody>
        </table>
    </div>
</div>
<!-- <script type="text/javascript" src="js/bootstrap-filestyle.min.js"></script> -->
<script type="text/javascript">

    var iPatientID = "96";

    $(document).ready(function(){   
        sHref_10 = '#idTab_10';//Set value for loader 

        var dThreeMonthDate = "09-08-2025";
        var dOneYearDate = "09-11-2024";
        var dCurrentDate = "09-11-2025";

        $('.classUploadToDate').datepicker({
            changeMonth: true,
            dateFormat: "dd-mm-yy",
            changeYear: true
        }).datepicker("setDate", dCurrentDate);

        $('.classUploadFromDate').datepicker({
            changeMonth: true,
            dateFormat: "dd-mm-yy",
            changeYear: true
        }).datepicker("setDate", dThreeMonthDate);

        // Search Attachments
        $('#idBtnSearchAttachments').click(function(){
            fLoadTabPageData10(iPatientID);
        });

        $('.classUploadDateForPatientPopup').val(getCurrentDate('dd-mm-yy'));//set current date
        //Set Select2 to Uploaded by field
        setSelect2UploadedBy();
        //set default uploaded by as logged in user
        setDefaultUserToUploadedByForPopup();
        // $(".classFileForPopup").filestyle({classButton: "btn btn-inverse",'buttonText': 'Browse'});
    });

    function fLoadTabPageData10(iTabPage10PatientID){
        fShowLoader(sHref_10);
        
        // get patient treatment package details        
        window.oTableUIDataAttachmentsPopup = $('#idTblPatientPopupAttachments').dataTable( {
            "processing": true,
            "serverSide": true,
            "searching": false,
            "ordering": false,
            "destroy": true,          
            "pageLength":15,
            "order": [[ 0, "asc" ]],
            "columnDefs": [ { "targets": [0,1,2,3,4,5], "orderable": false } ],
            "ajax": {
                "url": "ajaxPatienRecordPopup.php?sFlag=getPatientAllAttachments",
                "data": function(d) {
                    d.iPatientDetailsPatientID = iTabPage10PatientID;
                    d.dDateFrom = $('#idUploadFromdate').val();
                    d.dDateTo = $('#idUploadToDate').val();
                },
            },            
            "lengthChange": false,           
        });
       
        fHideLoader(sHref_10);
    }

    // Show Pinned History
    $(document).on('click', '.classShowPinnedHistory', function(){
        var iRecordID = this.getAttribute("data-id");
        $("#idShowPinnedHistoryTab").show();
        $('#idShowPinnedHistory').dataTable({
            "processing": true,
            "serverSide": true,
            "searching": false,
            "ordering": false,
            "destroy": true,          
            "columnDefs": [ { "targets": [0,1,2,3], "orderable": false } ],       
            "ajax": {
                "url": "ajaxPatienRecordPopup.php?sFlag=GetAttachmentPinnedHistory&isDataTable=1",
                "data": function(d) {
                    d.iRecordID = iRecordID;
                },
            },  
            "lengthChange": false,   
        });               
    });   

    //Pinned row
    $(document).on('click', '.classStatusChange', function(){
        var sPinBtnStatus = this.innerHTML;
        var iRecordID = this.getAttribute("data-id");
        var iPatientID = this.getAttribute("data-pid");
        var iIsPin = (sPinBtnStatus == "Pin") ? 1 : 0;
        var sFileName = this.parentNode.parentElement.childNodes[1].innerHTML;

        $.ajax({
            type: 'post',
            url:"ajaxPatienRecordPopup.php?sFlag=UpdatePinStatus",
            data: {iIsPin:iIsPin,iRecordID:iRecordID,iLoggedINstaffID:iLoggedINstaffID,sFileName:sFileName,iPatientID:iPatientID},
            beforeSend:function(){                  
                $(document.body).LoadingOverlay("show");
            },
            success : function (data){
                if(data){
                    oTableUIDataAttachmentsPopup.fnDraw();
                    $("#idShowPinnedHistoryTab").hide();
                }else{
                    alert("Error to pin report.")
                }                       
            },
            complete:function(){                    
                $(document.body).LoadingOverlay("hide");
            }
        });
    });   

    //Add new row
    $(document).on('click', '.classAddRowBtnDivPopup', function(){
        var iLengthFiles = $('.classField4').length;
        var iCountFile = 0;
        $('.classField4').each(function (iIndex, aChkValue) {             
            if((aChkValue.files[0])){
                iCountFile++;
            }
        });

        if(iCountFile != iLengthFiles){
            alert("Please select file then add new row.");
            return false;
        }else{
            addAttachementRowForPopup();
        }
    });

    //Remove row
    $(document).on('click', '.classRemoveBtnForPopup', function(){
        $(this).parent().parent().remove();
    });

    //For file object creation
    var aFormAttachments = new FormData();
    var iFileCount = 0;
    function prepareUpload(event)
    {
        files = event.target.files;
        $.each(files, function(key, value)
        {   
            aFormAttachments.append(iFileCount, value);
            iFileCount++;
        });
    }

    //GLOBAL OBJECT TO STORE FORMDATA
    var aAttachementDataForPopup = [{
                'FileTitleName': {},
                'UploadDate': {},
                'UploadedBy': {},                
                'fileOriginalName':{},
                'fileUploadedName':{},                
                'fileSize':{},                
                'description': {}
            }];

    //Save Attachments
    $(document).on('click', '#idSaveAttachmentFormPopup', function(){ 

        var counterTitle = 0;
        var counterUploadDate = 0;
        var counterUploadedBy = 0;
        var counterFile = 0;
        var counterDescription = 0;

        var LengthTitle = $('.classField1').length;
        var LengthUploadDate = $('.classField2').length;
        var LengthUploadedBy = $('.classField3').length;
        var LengthFile = $('.classField4').length;
        var LengthDescription = $('.classField5').length;       


        $('.classField1').each(function (iIndex, aValue) { 
            if(!($(this).val())){
                alert("File Name can not be empty.");
                return false;
            } 
            aAttachementDataForPopup[0]['FileTitleName'][iIndex] = $(this).val();
            counterTitle++;
        });

        $('.classField2').each(function (iIndex, aValue) { 
            if(!($(this).val())){
                alert("Uploaded date can not be empty.");
                return false;
            } 
            aAttachementDataForPopup[0]['UploadDate'][iIndex] = $(this).val();
            counterUploadDate++;
        });

        $('.classField3').each(function (iIndex, aValue) { 
            if(!($(this).val())){
                alert("Uploaded by can not be empty.");
                return false;
            }
            aAttachementDataForPopup[0]['UploadedBy'][iIndex] = $(this).val();
            counterUploadedBy++;
        });

        $('.classField4').each(function (iIndex, aValue) { 
            if(!(aValue.files[0])){
                alert("Please select file.");
                return false;
            }else{
                aAttachementDataForPopup[0]['fileOriginalName'][iIndex] = aValue.files[0].name;
                aAttachementDataForPopup[0]['fileUploadedName'][iIndex] = '';
                aAttachementDataForPopup[0]['fileSize'][iIndex] = aValue.files[0].size;
                counterFile++;
            }
        });

        $('.classField5').each(function (iIndex, aValue) { 
            aAttachementDataForPopup[0]['description'][iIndex] = $(this).val();
            counterDescription++;
        });      

        if((counterTitle == LengthTitle) && (counterUploadDate == LengthUploadDate) && (counterUploadedBy == LengthUploadedBy) && (counterFile == LengthFile)){
            bAjaxCall = true;
        }else{
            bAjaxCall = false;
        }        

        if(bAjaxCall){
            //Upload files
            $.ajax({
                type: 'post',
                url:"ajaxPatienRecordPopup.php?sFlag=AddPatientAttachementFilesForPopup",
                data: aFormAttachments,
                enctype: 'multipart/form-data',
                processData: false,
                contentType: false,
                beforeSend:function(){                  
                    $(document.body).LoadingOverlay("show");
                },
                success : function (data){
                    if(data){
                        fStoreAttachmentsData(data);
                    }else{
                        alert("Files can not be uploaded.")
                    }                       
                },
                complete:function(){                    
                    $(document.body).LoadingOverlay("hide");
                }
            });
        } 
    });

    //Create files object
    $(document).on('change', '.classField4', prepareUpload);    

    //Set select2 for Uploaded By
    function setSelect2UploadedBy(){
        $('.classUploadedByForPatientPopup').select2({
            width: '100%',
            allowClear: true,
            minimumInputLength: 3,
            width: 'resolve',
            placeholder: {
               id: "",
               placeholder: "Search by Patient name"
            },
            ajax: {
                url:"ajaxEhr.php?sFlag=SearchStaff",
                data: function (params) {
                    return {
                        sStaffName: params.term,
                    };
                },
                processResults: function (data,params) {
                    var results=[];
                    for(var iii=0; iii < data.length; ++iii){
                        value = data[iii];
                        var iPatientId = value['staff_id'];
                        var sPatientName = value['staff_name'];
                        results.push({
                            id: iPatientId,
                            text: sPatientName 
                        });
                    }
                    return { results: results };
                },
            }
        }); 
    }
   
    //Add row
    var iDivCount = 1;
    function addAttachementRowForPopup(){
        var sDivID = "idDiv_"+iDivCount;
        var sBlockAttachmentForPopup = `
            <div class="row-fluid" id="${sDivID}">
                <div class="span2">
                    <input type="text" class="classField1 classInputTextM" name="idFileNameForPatientPopup[]" id="idFileNameForPatientPopup">
                </div>
                <div class="span2">
                    <input type="text" class="classUploadDateForPatientPopup classField2 classInputTextS" name="idUploadDateForPatientPopup[]" id="idUploadDateForPatientPopup" readonly/>
                </div>
                <div class="span2">
                    <select class="classUploadedByForPatientPopup classField3 classSelectBoxS" name="idUploadedByForPatientPopup[]" id="idUploadedByForPatientPopup"></select>
                </div>
                <div class="span3">
                    <input type="file" class="classFileForPopup classField4 classInputTextS" name="idAttachmentsForPatientPopup[]" id="idAttachmentsForPatientPopup" onchange="${validateSize1(this,sDivID)}" title="Browse File to attach">
                </div>
                <div class="span2">
                    <textarea type="text" class="classField5" name="idDescOrNoteForPatientPopup[]" id="idDescOrNoteForPatientPopup" cols="2" rows="1"></textarea>
                </div>
                <div class="span1">
                    <a class="btn btn-danger btn-sm classRemoveBtnForPopup pull-right" href="javascript:void(0);" title="Delete"><i class="fa fa-minus"></i></a>
                </div>
            </div>
        `;

        $('.ClassAppendNewBlock').append(sBlockAttachmentForPopup);
        iDivCount++;

        //Set Select2 to Uploaded by field
        setSelect2UploadedBy();

        //set default uploaded by as logged in user
        setDefaultUserToUploadedByForPopup();

        $('.classUploadDateForPatientPopup').val(getCurrentDate('dd-mm-yy'));
    }

    //set current user as default uploaded by
    function setDefaultUserToUploadedByForPopup(){ 
        $(".classUploadedByForPatientPopup").empty();
        $(".classUploadedByForPatientPopup").append($("<option></option>").attr("value", iLoggedINstaffID).text(iLoggedINstaffName));
    }

    //Store attachment details
    function fStoreAttachmentsData(data){
        //Add uploaded file auto craeted name into file details object
        $.each(data, function(iIndex, aValue){
            aAttachementDataForPopup[0]['fileUploadedName'][iIndex] = aValue['uploaded_file_name'];            
        });

        var  iPatientDetailsPatientID = $('.classTabAnchor').attr('data-patient_id');

        $.ajax({
            url:"ajaxPatienRecordPopup.php?sFlag=AddPatientAttachementDataForPopup",
            data: {
                iPatientDetailsPatientID: iPatientDetailsPatientID,
                aAttachementDataForPopup: aAttachementDataForPopup,
                dAttachementDateForPopup: getCurrentDate('yy-mm-dd'),
            },
            success : function (data){
                console.log("data");
                if(data){
                    alert('File and details uploaded successfully.');
                    oTableUIDataAttachmentsPopup.fnDraw();

                    fClearAttachmentRowPop();
                    
                }else{
                    alert('Error in File and details upload.');                    
                }
            }
        });
    }


    //function to clear attachments fields rows
    function fClearAttachmentRowPop(){
        //re-initialize object array
        aAttachementDataForPopup = [{
                            'FileTitleName': {},
                            'UploadDate': {},
                            'UploadedBy': {},                
                            'fileOriginalName':{},
                            'fileUploadedName':{},                
                            'fileSize':{},                
                            'description': {}
                        }];

        aFormAttachments.length = 0;//reset files array object
        iFileCount = 0; //reset associated count for file object
        iDivCount = 1;//row div count reseted to 1       

        $('.ClassAppendNewBlock').empty();

        //Restet Parent block fields' values
        $('#idDiv_0').find('[id="idFileNameForPatientPopup"]').val('');
        $('#idDiv_0').find('[id="idAttachmentsForPatientPopup"]').val('');
        $('#idDiv_0').find('[id="idDescOrNoteForPatientPopup"]').val('');

        //set default uploaded by as logged in user
        $(".classUploadedByForPatientPopup").html($("<option></option>").attr("value", iLoggedINstaffID).text(iLoggedINstaffName));
    }
</script>
 <script>
        function validateSize(input) {
        const fileSize = input.files[0].size / 1000 / 1000; // in kB
        if (fileSize > 20) { 
        alert('Uploadable file size should be less than or equal to 20 Mb.');
           $("#idExternalReportFile").val(''); //for clearing with Jquery
         } else {
          // Proceed further
        }
        }       
</script>
 <script>
        function validateSize1(input,divId) {
            console.log(divId);
        const fileSize = input.files[0].size / 1000 / 1000; // in kB
        var maindivId=divId.id; //storing the divid in variable
        if (fileSize > 20) {
        alert('Uploadable file size should be less than or equal to 20 Mb.');
        $("#"+maindivId+"").find(input).val('');//for clearing input of div with Jquery
         } else {
          // Proceed further
        }
        }       
</script>
	                </div>
                    <div id="idTab_11" class="tab-pane full">
                        <!-- loader -->
                        <div class="classOverlay" ><div class="circle circle1 circle1-1"><div class="circle circle1 circle2-1"><div class="circle circle1 circle3-1"></div></div></div></div>
                        <style type="text/css">
	#idopdBillB3ReportTable thead{
		font-size: 14px;
		color:#884646;
	}
	#idopdBillB3ReportTable tbody{
		font-size: 14px;
		color: #636161;
	}
	.full-width{
		width: 100%;
	}
	.classTab11{
		flex-wrap: wrap;
    	overflow: auto;
	}
</style>
<div class="pull-right">
    <a class="btn btn-primary classExportPatientPaidUnpaidBillCardToPDF">Print All Bills (POS Format)</a>
    <a class="btn btn-primary classExportPatientPaidUnpaidBillToPDF">Print All Bills</a>
</div>
<br>
<br>
<br>
<div class="classTab11">
	<!-- Listing -->                    
    <table id="idopdBillB3ReportTable" class="table table-hover table-bordered" >
        <thead >
            <tr>
                <th>Sr No.</th>
                <th>Bill No</th>
                <th>Bill Date</th>
                <th>Bill For</th>
                                <th>Clinic</th>
                <th>Bill Amount</th>
                <th>Paid Amount</th>
                <th>Balance</th>
                <th>Payment</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="idopdBillB3ReportTableBody">
        </tbody>
    </table>                   
    <!-- End of Listing --> 
</div>
<script type="text/javascript">

	$(document).ready(function(){        
        sHref_11 = '#idTab_11';//Set value for loader
    });

    //! For Setting auto laod Patient id data
    function fLoadTabPageData11(iTabPage8PatientID){
        fShowLoader(sHref_11);
    	window.oTableUIopdBillReportB3DataTable = $('#idopdBillB3ReportTable').dataTable( {
            "processing": true,
            "serverSide": true,
            "searching": false,
            "ordering": true,
            "destroy": true,                   
            "pageLength":20,                    
            "columnDefs": [ { "targets": [0,1,2,3,4,5,6,7,8,9], "orderable": false },{ "visible": false,  "targets": []}],
            "ajax": {
                "url": "ajaxMisReports.php?sFlag=GetopdBillB3ReportDetails&isDataTable=1",
                "data": function(d) {
                    d.iPatientId = iTabPage8PatientID;
                    d.dStartDate = getCurrentDate('yy-mm-dd', 'last_month');
                    d.dToDate= getCurrentDate('yy-mm-dd');
                },
            },
            "lengthChange": false,
		});

 		fHideLoader(sHref_11);
    } 
</script>                    </div>
                    <div id="idTab_12" class="tab-pane full">
                        <!-- loader -->
                        <div class="classOverlay" ><div class="circle circle1 circle1-1"><div class="circle circle1 circle2-1"><div class="circle circle1 circle3-1"></div></div></div></div>
                        <style type="text/css">
	.full-width{
		width: 100%;
	}
	.classTab12{
		flex-wrap: wrap;
    	overflow: auto;
	}
    .classPopAdvicePanel{
        overflow-wrap: break-word;
        word-break: break-word;
    }
    #idPatientAdviceTabTbl .classPopAdvicePanel{
        font-size: 15px;
    }
</style>
<div class="classTab12">
	<!-- Listing -->                    
    <table id="idPatientAdviceTabTbl" class="table" >
        <tbody id="idPatientAdviceTab" style="">
            <!-- Show Advice Data -->
        </tbody>
    </table>
    <table id="idPatientAdviceTabTable" class="table" >
        <input type="hidden" id="idPatientAdvicePopUpPatientId" value="0" />
        <tbody id="idPatientAdviceTabBody" style="">
            <tr class="classPatientAdviceFormValueBlock" id="idPatientAdviceFormValueBlock">
                <td>
                    <div class="classPatientAdviceFormValueBlock">
                        <div class="classPatientAdviceBlk" id="idPatientAdviceBlk_0" style="">
                            <textarea class="form-control advice_textarea classPatientOwnAdvice" placeholder="Your advice goes here.." style="width:100%;"></textarea>
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="classFormSaveBtn pull-right"> 
                   <!-- Access only with user having update consultation access -->
                                        </div>
                </td>
            </tr>
        </tbody>
    </table>                   
    <!-- End of Listing --> 
</div>
<script type="text/javascript">

	$(document).ready(function(){        
        sHref_12 = '#idTab_12';//Set value for loader

        $(document).on('click', '#idSavePatientAdvicePopup', function(){
            var sPatientAdvice = $(".classPatientOwnAdvice").val();

            if(sPatientAdvice == ''){
                alert('Please give your advice First');
                return false
            }else{
                fAddPatientAdvice();
            }
        });
    });
    //Load the advice data
    function fLoadTabPageData12(iTabPage12PatientID){
        $("#idPatientAdvicePopUpPatientId").val(iTabPage12PatientID);
        $.ajax({
            type: 'get',
            url:"ajaxPatienRecordPopup.php?sFlag=GetPatientsAdviceDetailsForPopup",
            data: {
                iPatientDetailsPatientID: iTabPage12PatientID,                
            },
            success : function (data){
                fRendarDataForPatientAdviceHistory(data);   
            }
        });        
    }
    //To add advice
    function fAddPatientAdvice(){
        var iTabPage12PatientID = $("#idPatientAdvicePopUpPatientId").val();
        var sPatientAdvice = $(".classPatientOwnAdvice").val();
        $.ajax({
            url:"ajaxPatienRecordPopup.php?sFlag=AddPatientAdviceDataForPopup",
            data: {
                iPatientDetailsPatientID: iTabPage12PatientID,                
                sPatientAdvice: sPatientAdvice,                
            },
            success : function (data){  
                $(".classPatientOwnAdvice").val(""); 
                fLoadTabPageData12(iTabPage12PatientID);   
            }
        });
    }
    //Render the data
    function fRendarDataForPatientAdviceHistory(data){
        let sBlockPaAdviceckageHistory= '';
        let iCount = "";
        if(data.length > 0){
            $.each(data, function(iIndex, aPatientAdviceDetail){
                iCount = (iIndex + 1);
                var sPatientAdvice = aPatientAdviceDetail['advice_note'];
                var sAdvicedGiveBy = aPatientAdviceDetail['sAdvicedGiveBy'];
                var dAdviceGiveDate = aPatientAdviceDetail['dAdviceGiveDate'];
                var tAdviceGivenTime = aPatientAdviceDetail['tAdviceGivenTime'];
                var sAdvicedGiveId = aPatientAdviceDetail['sAdvicedGiveId'];
                var iServiceId = aPatientAdviceDetail['iServiceId'];      

                sBlockPaAdviceckageHistory +=`
                <tr class="classAdviceMetaDataViewBlk" id="idAdviceMetaDataViewBlk_`+iCount+`">
                    <td>
                        <div class="panel-group">
                            <div class="panel panel-primary">
                                <div class="panel-heading">
                                    <span class="meta_info pull-right">`+tAdviceGivenTime+` - `+dAdviceGiveDate+`
                                    </span>
                                    <span class="person_name" >`+sAdvicedGiveBy+`
                                    </span>
                                </div>
                                <div class="panel-body classPopAdvicePanel" id="idPatientAdviveContent_`+sAdvicedGiveId+`" >`+sPatientAdvice+`
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>`;
            });    
        }else{
            sBlockPaAdviceckageHistory += '<h4>No Advice available</h4>';
        }
        $('#idPatientAdviceTab').html(sBlockPaAdviceckageHistory);
    }
   
</script>                    </div>
                </div>
            </div>
      	</div>
      	<div class="modal-footer custom-footer">
        	<!--Here comes the modal action buttons-->
      	</div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- end: Modal -->

<script type="text/javascript">
    //var iPatientDetailsPatientID = "< ? php echo $iPatientDetailsPatientID; ? >
    var iLoggedINstaffID = "411";
    var iLoggedINstaffName = "Kekeli Jiresse Dogbevi"; 
    var iUniqueNumber = "1"; 
    var aAllHealthPackgeDataForPopup = [];
	//Opens Patient tab view Pop-up
	$(document).on('click', '#idClosePatientRecordPopupTabViewModal', function(){
		$('#idPatientRecordPopupTabViewModal').modal('hide');
        $('body').css('overflow', 'auto');
	});

	//Get all Patient header details for patient
	function fGetPatientHeaderDetails(iPatientDetailsPatientID){
		
		//Fetch data for patient
		$.ajax({
            url: "ajaxPatienRecordPopup.php?sFlag=GetPatientHeaderDetails&iPatientDetailsPatientID="+iPatientDetailsPatientID,
            asyn: false,
            success: function (data){
            	if(data){
            		//Set Patient header details
            		fSetPatientPopupPatientHeaderDetails(data);
                    aPatientDetailsForPopup = data; // Set global patient details array

            		//Set Patient Basic details Tab
            		fSetPatientBasicDetailsTab(aPatientDetailsForPopup);
            	}
            }
        });
	}

    //Set Patient header details
	function fSetPatientPopupPatientHeaderDetails(data){
		//Set Patients' Name
    	if("oPatient" in data){
            // console.log("data : ", data);
    		//Check patient pic present
    		if(data.oPatient.sImage){
    			$('.patient_pic img').attr("src", "images/patient_images/"+data.oPatient.sImage);
    		}else{
    			$('.patient_pic img').attr("src", "img/default_user_splash_pic_100.jpg");
    		}

    		//Check if title present
    		if(data.oPatient.sPatinetTitle){
    			$('.classPatientTitle').text(data.oPatient.sPatinetTitle+".");
    		}else{
    			$('.classPatientTitle').text("Mr./Mrs.");
    		}

    		//Set name
    		if(data.oPatient.sPatientName){
    			$('.classPatientFullName').text(data.oPatient.sPatientName);
    		}else{
    			$('.classPatientFullName').empty();
    		}

    		//Set Patient Number
    		if(data.oPatient.sPatientNo){
        		$('.classPatientNo').text("("+data.oPatient.sPatientNo+")");
                $('.classPendingBillsPatientNo').val(data.oPatient.sPatientNo);
    		}else{
    			$('.classPatientNo').empty();
    		}

    		//Set Patient DOB
    		if(data.oPatient.dDOB){
        		$('.classPatientDOB').text(data.oPatient.dDOB);
    		}else{
    			$('.classPatientDOB').empty();
    		}

            // is patient VIP            
            if(parseInt(data.oPatient.iIsVIP) == 1){
                $('#idPatientPopUpVIP').html('<i class="fa fa-star"></i>');
            }else{
                $('#idPatientPopUpVIP').html('');
            }

    		//Set Mobile
    		if(data.oPatient.iMobile){
    			var sActionCallBtn = '';
        		
                $('.classPatientMobile').html(data.oPatient.iMobile+" "+sActionCallBtn);
    		}else{
    			$('.classPatientMobile').html('-');

    		}	

    		//Set Gendar and Age
    		if(data.oPatient.sGender && data.oPatient.iAgeString){
        		$('.classPatientGendarAndAge').text(data.oPatient.sGender+" - "+data.oPatient.iAgeString);
    		}else{
    			$('.classPatientGendarAndAge').html('-');
    		}	

            //Set Patient NHIA No.
            if(data.oPatient.sNHIANo){
                $('.classPatientNHIANo').text(data.oPatient.sNHIANo);
            }else{
                $('.classPatientNHIANo').html('-');
            }

            //Set Patient Membership Type
            if(data.oPatient.sMembershipType){
                $('.classPatientMembershipType').text(data.oPatient.sMembershipType);
            }else{
                $('.classPatientMembershipType').html('-');
            }	 
            console.log(data.oPatient.sUID);
            if (iUniqueNumber == 1) {
                //Set Patient Unique number..
                if(data.oPatient.sUID){
                    $('.classPatientUniqueNumber').text(data.oPatient.sUID);
                }else{
                    $('.classPatientUniqueNumber').html('-');
                }
            }
    	}

    	//Check for Global Id
    	/*if("idPatientGlobalID" in data && data.idPatientGlobalID){
    		$('.classPatientGlobalID').text(data.idPatientGlobalID);
    	}else{
    		$('.classPatientGlobalID').empty();
    	}

    	//Check for Local Id
    	if("idPatientLocalID" in data && data.idPatientLocalID){
    		$('.classPatientLocalID').text(data.idPatientLocalID);
    	}else{
    		$('.classPatientLocalID').empty();
    	}*/

    	//Set Patient all pending amount 
    	if("iAllPendingAmtPatientPopup" in data){
            if(data.iAllPendingAmtPatientPopup > 0){
                data.iAllPendingAmtPatientPopup = (data.iAllPendingAmtPatientPopup).toFixed(2);
            }
    		$('.classPatientAllPendigAmount').text(data.iAllPendingAmtPatientPopup+" pending");
    	}else{
    		$('.classPatientAllPendigAmount').text("0 pending");
    	} 
	}

	//Get tab call
	$(document).on('click', '.tab-heading', function(){		
        var iTabPagePatientID = $(this).attr('data-patient_id');
		var sHref = $(this).attr('href');        
        fLoadTabPageData(iTabPagePatientID, sHref);
	});

	//show loader
	function fShowLoader(sHref) {
		$(sHref+' .classOverlay').addClass('overlay-loader-active');			
	}
	//Hide loader	
	function fHideLoader(sHref) {
		$(sHref+' .classOverlay').removeClass('overlay-loader-active');			
	}

    //Load new Patient details Pop-up
    function fLoadNewPatientDetailsPopup(iPopupPatientID){
        $('.classTabAnchor').attr('data-patient_id', iPopupPatientID);
        $('#idPatientRecordPopupTabViewModal').modal('show');
        //set default page on opening
        $('.classUlNavTabPatientPopup > li').removeClass('active');
        $('.classUlNavTabPatientPopup > li:first-child').addClass('active');
        $('.classContentNavTabPatientPopup > div').removeClass('active');
        $('.classContentNavTabPatientPopup > div:first-child').addClass('active'); 
        $('body').css('overflow', 'hidden');
        fGetPatientHeaderDetails(iPopupPatientID);
        // fGetAllHealthPackagesForNewPatientPopupB3();
    }

    //Load Tab data
    function fLoadTabPageData(iTabPagePatientID, sHref){
        var aParts = sHref.split('_');             
        //Call respective tab page load function
        if(aParts[1] == 2){
            fLoadTabPageData7(iTabPagePatientID);
        }else if(aParts[1] == 3){
            fLoadTabPageData2(iTabPagePatientID);
        }else if(aParts[1] == 4){
            fLoadTabPageData3(iTabPagePatientID);
        }else if(aParts[1] == 5){
            fLoadTabPageData6(iTabPagePatientID);
        }else if(aParts[1] == 6){
            fLoadTabPageData4(iTabPagePatientID);
        }else if(aParts[1] == 7){
            var iBasicMedicalHistoryHelperID = 13;
            fLoadTabPageData8(iTabPagePatientID, iBasicMedicalHistoryHelperID);
        }else if(aParts[1] == 8){
            fLoadTabPageData5(iTabPagePatientID);
        }else if(aParts[1] == 9){
            fLoadTabPageData9(iTabPagePatientID);
        }else if(aParts[1] == 10){
            fLoadTabPageData10(iTabPagePatientID);
        }else if(aParts[1] == 11){
            fLoadTabPageData11(iTabPagePatientID);
        }else if(aParts[1] == 12){
            fLoadTabPageData12(iTabPagePatientID);
        }
    }

    //css function 
    function setModalMaxHeight(element) {
      this.$element     = $(element);  
      // console.log("this.$element  : ", this.$element );
      this.$content     = this.$element.find('.modal-content');
      var borderWidth   = this.$content.outerHeight() - this.$content.innerHeight();
      var dialogMargin  = $(window).width() < 768 ? 20 : 60;
      var contentHeight = $(window).height() - (dialogMargin + borderWidth);
      var headerHeight  = this.$element.find('.modal-header').outerHeight() || 0;
      var footerHeight  = this.$element.find('.modal-footer').outerHeight() || 0;
      var maxHeight     = contentHeight - (headerHeight + footerHeight);

      this.$content.css({
          'overflow': 'hidden'
      });
      
      this.$element
        .find('.modal-body').css({
          'max-height': maxHeight,
          'overflow-y': 'auto'
      });
    }

    // $('.modal .classPatientRecordPopupTabViewModal').on('show.bs.modal', function() {
    //   $(this).show();
    //   setModalMaxHeight(this);
    // });

    $(window).resize(function() {
      if ($('.modal .classPatientRecordPopupTabViewModal .in').length != 0) {
        setModalMaxHeight($('.modal .classPatientRecordPopupTabViewModal .in'));
      }
    });

     //Get All health packages
    function fGetAllHealthPackagesForNewPatientPopupB3(){
        $.ajax({
            url: "ajaxPatienRecordPopup.php?sFlag=GetAllHealthPackagesForNewPatientPopupB3",
            async: false,
            success: function (data){
                if(data){
                    aAllHealthPackgeDataForPopup = data;
                    fRendarHeathPackageSelectOption(aAllHealthPackgeDataForPopup);
                }
            }
        });
    } 
</script>

<!-- included here to have package popups available this new popup if new popup feature is enabled then medixcelFooter_CustomizeCreatePackages.php file will get included here only-->
<style type="text/css">
	#idEHRCustomPackagePanel .select2-container{
		width: 100% !important ;
	}
	#idEHPPaymentAmount,
	#idEHPCardNo,
	#idEHPPaymentMM,
	#idEHPPaymentYY{
		width: 100%;
	}
</style>
<div id="idEHRCustomPackagePanel" class="modal classModalMediumContainer hide fade" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="color: black !important;width: 1100px;margin-left:-430px;">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		<h3 id="idEHRCustomPackagePanelHeader">Create / Customize Package</h3>
	</div>
	<div class="modal-body">
		<form id="idCustomPackageForm">
			<input type="hidden" id="idCustomizedPackageID" name="package_id">
			<div class="form-horizontal">
				<div class="row-fluid control-group">
					<div class="span2">
						<label class="control-label classRequiredField">Package Name</label>
					</div>
					<div class="span3">
						<input type="text" name="package_name" id="idName" class="input-block-level" placeholder="Package Name">
					</div>
				</div>
				<div class="row-fluid control-group">
					<div class="span2">
						<label class="control-label classRequiredField">Total Cost with Normal Rate</label>
					</div>
					<div class="span3 input-append">
						<span class='add-on classCurrencyIcon' title="Click to copy calculated amount">GHS </span>
						<input type="number" value="0" name="" class="input-block-level" id="idPackageCalculatedCost" placeholder="" readonly=""">
					</div>
					<div class="span1"></div>
					<div class="span2">
						<label class="control-label classRequiredField">Package Gross Amount</label>
					</div>
					<div class="span3 input-append">
						<span class='add-on classCurrencyIcon' title="Click to copy calculated amount">GHS </span>
						<input type="number" name="package_gross_amount" class="input-block-level" id="idGrossAmount" placeholder="Gross Amount" min=0>
						<span class='add-on classCalendarIcon' title="Click to copy calculated amount" onclick="copyCalculatedAmount()"><i class='fa fa-copy'></i></span>
					</div>
				</div>
				<div class="row-fluid control-group">
					<div class="span2">
						<label class="control-label classRequiredField">Package Discount</label>
					</div>
					<div class="span3 input-append">
						<span class='add-on classCurrencyIcon' title="Click to copy calculated amount">GHS </span>
						<input type="number" value="0" name="package_discount" class="input-block-level" id="idPackageDiscount" placeholder="Package Discount" min=0>
					</div>
					<div class="span1"></div>
					<div class="span2">
						<label class="control-label classRequiredField">Package Net Amount</label>
					</div>
					<div class="span3 input-append">
						<span class='add-on classCurrencyIcon' title="Click to copy calculated amount">GHS </span>
						<input type="number" name="package_amount" class="input-block-level" id="idAmount" placeholder="Package Amount" readonly>
					</div>
				</div>
				<div class="row-fluid control-group">
					<div class="span2">
						<label class="control-label classRequiredField">Effective From<span class="classMandatorySign">*</span></label>
					</div>
					<div class="span3 input-append">
						<input type="text" name="package_from" id="idCustomPackageFrom" class="input-block-level classPackageDates" placeholder="From Date" >
						<span class='add-on classCalendarIcon'><i class='fa fa-calendar'></i></span>
					</div>
					<div class="span1"></div>
					<div class="span2">
						<label class="control-label classRequiredField">Effective Till<span class="classMandatorySign">*</span></label>
					</div>
					<div class="span3 input-append">
						<input type="text" name="package_to" id="idCustomPackageTo" class="input-block-level classPackageDates" placeholder="To Date" >
						<span class='add-on classCalendarIcon'><i class='fa fa-calendar'></i></span>
					</div>
				</div>
				<div class="row-fluid control-group">
					<div class="span2">
						<label class="control-label classRequiredField">Validity Period <small>(In Days)</small></label>
					</div>
					<div class="span3">
						<input type="number" name="package_validity" id="idValidity" class="input-block-level" placeholder="Validity in days">
					</div>
				</div>
			</div>
			<table id="idPackageItems" class="table table-condensed" style="width: 100%">
				<thead>
					<tr>
						<th>Sr No</th>
						<th>Modality</th>
						<th>Procedure</th>
						<th>Normal Rate</th>
						<th>Count</th>
						<th>Usage Amount</th>
												<th></th>
					</tr>
				</thead>
				<tbody></tbody>
			</table>
			<strong>Add Service</strong>
			<div class="row-fluid">
				<div class="span2">
					<select id="idCustomPackageServiceType" class="input-block-level" style="width: 100%">
						<option value="">Select Service Type</option>
													<option value="1">IPD</option>
														<option value="2">TRANSFUSION MEDICINE UNIT</option>
														<option value="3">SURGERY TEMPLATE</option>
														<option value="4">DAY SURGERY</option>
														<option value="5">DENTAL - DAY SURGERY</option>
														<option value="6">EYE - DAY SURGERY</option>
														<option value="7">ENT - DAY SURGERY</option>
														<option value="8">GENERAL OPD</option>
														<option value="9">DENTAL CLINIC</option>
														<option value="10">EYE CLINIC</option>
														<option value="11">ENT CLINIC</option>
														<option value="12">EMERGENCY TRIAGE</option>
														<option value="13">DETENTION FOR OBSERVATION</option>
														<option value="14">GENERAL LAB SERVICES</option>
														<option value="16">ULTRASOUND</option>
														<option value="17">X RAY</option>
														<option value="18">CHILD HEALTH CLINIC</option>
														<option value="19">OBSTETRICS AND GYNAECOLOGY CLINIC</option>
														<option value="20">ANTENATAL / POSTNATAL CLINIC</option>
														<option value="21">DRESSING AND TREATMENT ROOM</option>
														<option value="22">PHYSIOTHERAPY CLINIC</option>
														<option value="23">MENTAL HEALTH CLINIC</option>
														<option value="24">VCT</option>
														<option value="25">TELECONSULTATION CENTRE</option>
														<option value="26">DIETETICS UNIT</option>
														<option value="27">PUBLIC HEALTH</option>
														<option value="28">HERBAL CLINIC</option>
														<option value="29">SPECIAL CLINIC</option>
														<option value="30">UROLOGY</option>
														<option value="31">BROUGHT IN DEAD</option>
														<option value="32">ECG</option>
														<option value="33">TB Clinic</option>
														<option value="34">SURGICAL OPD</option>
														<option value="35">CLINICAL PSYCHOLOGY</option>
														<option value="37">DIALYSIS</option>
														<option value="38">OBSTETRICS TRIAGE</option>
														<option value="39">PRESTIGE UNIT</option>
														<option value="40">ANAESTHESIA CLINIC </option>
														<option value="41">PHYSICIAN SPECIALIST CLINIC </option>
														<option value="42">ORTHOPAEDIC CLINIC</option>
												</select>
				</div>
				<div class="span3">
					<select id="idCustomPackageService" class="input-block-level" style="width: 100%">
						<option value="">Select Service</option>
					</select>
				</div>
				<div class="span2">
					<input type="number" min="0" id="idCustomPackageServiceQty"  class="input-block-level" placeholder="Qty">
				</div>
				<div class="span2">
					<input min="0" type="number" id="idCustomPackageServiceItemRate"  class="input-block-level" placeholder="Rate Per Usage" step="any">
				</div>
				<div class="span1 input-append hidden">
					<input type="number" id="idCustomPackageServiceItemFrequencyDays" value="0"  class="input-block-level" placeholder="Frequency in Days">
					<span class='add-on'>Days</span>
				</div>
				<div class="span2">
					<button type="button" href="#" class="btn btn-primary" id="idAttachServiceToPackage">Add</button>
				</div>
			</div>
			<div class="alert alert-danger">
				Rate Per Usage is the amount that person is to be charged on every usage above the package cost.
			</div>
			<div class="classContainerActivatePanel" style="display: none;">
				<input type="hidden" name="basePackageID" id="idCustomPackageBasePackageID" />
				<input type="hidden" name="hpPatientID" id="idCustomPackagePatientID" />
				<div class="alert alert-danger">
					Activating Package for the selected patient.
				</div>
				<div class="form-horizontal">
					<div class="control-group">
	                    <label class="control-label">Activate Package From</label>
	                    <div class="controls">
	                        <div class="span3 input-append">
	                        	<input type='text' name='dPackageStartDate' id='idCustomPackageStartDate' class='classInputText' placeholder='Date'/>
								<span class='add-on classCalendarIcon'><i class='fa fa-calendar'></i></span>
							</div>
	                    </div>
	                </div>
	                
	                
                    <div class="control-group" id="idPackageClinicIdDIV">
	                    <label class="control-label">Clinic</label>
	                    <div class="controls">
	                        <div class="span3">
	                        	<select class="classActivateHPClinicId" id="idActivatePackageClinicId" name="idActivatePackageClinicId"></select>
							</div>
	                    </div>
	                </div>

	                <div class="control-group">
	                    <label class="control-label">Activation Notes</label>
	                    <div class="controls">
	                        <div class="span3">
	                        	<textarea name='sActivationNotes' id='idActivationNotes' class='span4'></textarea>
							</div>
	                    </div>
	                </div>
	                	            </div>	            
			</div>
			<div class="row-fluid">
				<h5>Inventory Products</h5>
			</div>
			<div class="row-fluid">
				<table id="idHPProducts" class="table table-bordered">
					<thead>
						<th>Sr.No.</th>
						<th>Product Name</th>
						<th>Normal Rate</th>
						<th>Count</th>
						<th>Usage Amount</th>
						<th></th>
					</thead>
					<tbody id="idHPProductsTBody">
					</tbody>
				</table>
			</div>
			<div class="row-fluid">
				<div class="span3">
					<select id="idCustomPackageProductId" name="idCustomPackageProductId">
					</select>
				</div>
				<div class="span2">
					<input type="number" min="0" id="idCustomPackageProductQty"  class="input-block-level" placeholder="Qty">
				</div>
				<div class="span2">
					<input min="0" type="number" id="idCustomPackageProductRate"  class="input-block-level" placeholder="Rate Per Usage" step="any">
				</div>
				<div class="span2">
					<button type="button" href="#" class="btn btn-primary" id="idAttachProductToPackage">Add</button>
				</div>
			</div>

			<!-- Payment div -->
						<!-- End of Payment div -->

		</form>
	</div>
	<div class="modal-footer">
		<button class="btn classCloseEHRCustomPackagePanel" aria-hidden="true" onclick='clearFields()'>Close</button>
		<button class="btn btn-primary" id="idSavePAckageFormBtn">Save</button>
	</div>
</div>

<script type="text/javascript" src="js/paymentFunctions.js?ver=1.0"></script>
<script type="text/javascript">
	var loadHealthPackageCustomizer;
	var loadHealthPackagePanel;
	let iAllowEditingPackageName = 1;
	let iAllowAddingItems = 1;
	let iPackageItemCounter = 0;
	let iDefaultValidityForPackages = 365;
	let sModalitiesWithOneYearValidity = '';
	let aModalitiesWithOneYearValidity = (sModalitiesWithOneYearValidity!='') ?sModalitiesWithOneYearValidity.split(',') :[];
	aModalitiesWithOneYearValidity = aModalitiesWithOneYearValidity.map(function(iServiceTypeId){
		return parseInt(iServiceTypeId);
	});

	const iBotoxFillerVaildation = 0;
	const aBotoxModalities = [{iServiceTypeId:2,sServiceTypeName:"Botox"},{iServiceTypeId:15,sServiceTypeName:"Filler"},{iServiceTypeId:50,sServiceTypeName:"Filler"},{iServiceTypeId:51,sServiceTypeName:"Filler"},{iServiceTypeId:52,sServiceTypeName:"Filler"},{iServiceTypeId:53,sServiceTypeName:"Filler"},{iServiceTypeId:72,sServiceTypeName:"Skin Booster"}];
	const iEHPPaymentRequired = 0;
	const iEHPPaymentMinPaymentRequired = 0;

	(function () {

		$('#idCustomPackageFrom').datepicker({
			changeMonth: true,
			dateFormat: 'dd-mm-yy',
			changeYear: true
		});

		$('#idCustomPackageTo').datepicker({
			changeMonth: true,
			dateFormat: 'dd-mm-yy',
			changeYear: true
		});

		$('#idCustomPackageStartDate').datepicker({
			changeMonth: true,
			dateFormat: 'dd-mm-yy',
			changeYear: true
		});

		$(document).ready(function(){	
			//Set Curent date with formate dd-mm-yy
			$('#idCustomPackageStartDate').val(getCurrentDate('dd-mm-yy'));

			let aEHPPayment = [];
			aEHPPayment['getPaymentAllModes'] = "#idEHPPaymentMode";
			aEHPPayment['getPaymentBankList'] = "#idEHPSelectBank";
			aEHPPayment['getPaymentCardType'] = "#idEHPSelectCardType";
			aEHPPayment['generateMonthAndYears'] = "#idEHPPaymentYY";
			aEHPPayment['generatePaymentYears'] = "#idEHPPaymentMM";
			initializePaymentOptions(aEHPPayment);

			if (iEHPPaymentRequired == 1) {
				$('#idSavePAckageFormBtn').prop('disabled',true);
			}
		});

		$("#idCustomPackageServiceType").select2();
		$("#idCustomPackageService").select2();

		$("#idCustomPackageServiceType").on('change', function(event) {
			event.preventDefault();

			$("#idCustomPackageService").find('option[value!=""]').remove();
			$("#idCustomPackageService").val("");
			$("#idCustomPackageService").trigger("change");

			var $this = $(this),
			iServiceTypeID = $this.val();

			$.ajax({
				url: 'ajaxHealthPackages.php?sFlag=getServicesForModality',
				data: {iServiceTypeId: iServiceTypeID},
			})
			.done(function(aServices) {
				var aServices = JSON.parse(aServices);

				$.each(aServices, function(index, aService) {
					$("#idCustomPackageService").append("<option value='"+aService.service_id+"'>"+aService.service_name+"</option>");
				});
			});
		});

		$("#idAttachServiceToPackage").on('click', function(event) {
			event.preventDefault();

			var iServiceTypeID = $("#idCustomPackageServiceType").val(),
			sServiceTypeName = $("#idCustomPackageServiceType option:selected").text(),
			iServiceID = $("#idCustomPackageService").val(),
			sServiceName = $("#idCustomPackageService option:selected").text(),
			iQty = $("#idCustomPackageServiceQty").val();
			iItemRate = $("#idCustomPackageServiceItemRate").val();
			iItemFrequencyDays = $("#idCustomPackageServiceItemFrequencyDays").val();

			// check for botox/filler validation
			if(iBotoxFillerVaildation == 1){
				iServiceTypeID = parseInt(iServiceTypeID);
				for(let iii=0; iii < aBotoxModalities.length; ++iii){
					if(iServiceTypeID == aBotoxModalities[iii].iServiceTypeId){
						iQty = 1;
						break;
					}
				}
			}

			iQty = parseInt(iQty);
			iItemRate = parseInt(iItemRate);

			if(iQty <= 0 || isNaN(iQty)){
				alert('Count must be greater than 0');
				$("#idCustomPackageServiceQty").val(0).change();
				return false;
			}

			if(iItemRate < 0 || isNaN(iItemRate)){
				alert('Item rate cannot be less than 0');
				$("#idCustomPackageServiceItemRate").val(0).change();
				return false;
			}

			var iServiceRate = 0;

			//! Load Service Rate
			$.ajax({
				url: 'ajaxHealthPackages.php',
				data: {
					iServiceID: iServiceID,
					sFlag: "getServiceRate"
				},
				async: false
			})
			.done(function(data) {
				iServiceRate = data;
			});

			if(iServiceTypeID == 0){
				alert("Please Select Modality.");
			} else if(iServiceID == 0){
				alert("Please Select Procedure.");
			} else if(iQty == 0){
				alert("Please Select Count of Procedure");
			} else {
				loadPackageItemToPanel(new PackageItem({
					iServiceTypeID: iServiceTypeID,
					sServiceTypeName: sServiceTypeName,
					iServiceID: iServiceID,
					sServiceName: sServiceName,
					iQty: iQty,
					iServiceRate: iServiceRate,
					iItemFrequencyDays: iItemFrequencyDays,
					iItemRate: iItemRate,
					iServiceTypeID:iServiceTypeID
				}));

				$("#idCustomPackageServiceType").val("").trigger('change');
				$("#idCustomPackageServiceQty").val(0);
				$("#idCustomPackageServiceItemRate").val(0);
				$("#idCustomPackageServiceItemFrequencyDays").val(0);

				getPackageCalculatedRate();
			}

			// set package validity based on service type
			let dPackageFromDate = $('#idCustomPackageFrom').val();
			if(aModalitiesWithOneYearValidity.indexOf( parseInt(iServiceTypeID) ) > -1){
				// set one year as package validity
				let oMomentFrom = moment(dPackageFromDate,'DD-MM-YYYY');
				let dPackageToDate = oMomentFrom.add(365,'days').format('DD-MM-YYYY');
				$('#idCustomPackageTo').datepicker('setDate',dPackageToDate);
				console.log('dPackageToDate 1',dPackageToDate);
			}else{
				//set default package validity
				let oMomentFrom = moment(dPackageFromDate,'DD-MM-YYYY');
				let dPackageToDate = oMomentFrom.add(iDefaultValidityForPackages,'days').format('DD-MM-YYYY');
				$('#idCustomPackageTo').datepicker('setDate',dPackageToDate);
			}
			calculateDaysFromPackageDuration();
		});

		$("#idAddPanel").on('click', function(event) {
			event.preventDefault();

			loadHealthPackagePanel();
		});

		loadHealthPackageCustomizer = function(iPackageID) {
			//! This is creating new package so reset existing data
			$('#idCustomizedPackageID').val("");
			$('#idCustomPackageBasePackageID').val(0);
			$('#idCustomPackagePatientID').val(0);
			$('.classContainerActivatePanel').hide();
			$.ajax({
				url: 'ajaxHealthPackages.php',
				data: {
					iPackageID: iPackageID,
					sFlag: "getPackageByPackageID"
				},
				async: false
			})
			.done(function(aPackage) {

				var aPackageItems = [];

				$.each(aPackage['aItems'], function(index, oItem) {
					if(oItem.iItemTypeID==1){
						aPackageItems.push(new PackageItem({
							iItemTypeID: oItem.iItemTypeID,
							iServiceTypeID: oItem.iServiceTypeID,
							sServiceTypeName: oItem.sServiceTypeName,
							iServiceID: oItem.iItemID,
							sServiceName: oItem.sItemName,
							iQty: oItem.iItemQty,
							iItemRate: oItem.iItemRate,
							iItemFrequencyDays: oItem.iItemFrequencyDays,
							iServiceRate: oItem.iServiceNormalRate
						}));
					}else if(oItem.iItemTypeID==2){
						loadHPProductDetails(oItem.iItemID,oItem.sItemName,oItem.iItemQty,oItem.iItemRate,oItem.iItemNormalRate);
					}
				});

				loadHealthPackagePanel(new Package({
					iPackageID:aPackage['iPackageID'],
					sName:aPackage['sPackageName'],
					iAmount:aPackage['iPackageAmount'],
					sEffectiveFrom: moment(aPackage['dEffectiveFrom']).format("DD-MM-YYYY"),
					sEffectiveTo: moment(aPackage['dEffectiveTill']).format("DD-MM-YYYY"),
					iValidity:aPackage['iValidity'],
					aItems: aPackageItems
				}));

				getPackageCalculatedRate();
			});
		}

		loadHealthPackagePanel = function(oPackage) {

			$('[name="package_name"]').attr('readonly',false);
			$('#idAttachServiceToPackage').attr('disabled',false);
			$('#idAttachProductToPackage').attr('disabled',false);

			if(oPackage === undefined){
				oPackage = new Package({
					sEffectiveFrom: getCurrentDate('dd-mm-yy'),
					sEffectiveTo: getCurrentDate('dd-mm-yy', 'year_after_current_date'),
				});
			}else{
				if(iAllowEditingPackageName == 0){
					$('[name="package_name"]').attr('readonly',true);					
				}
				if(iAllowAddingItems == 0){
					$('#idAttachServiceToPackage').attr('disabled',true);
					$('#idAttachProductToPackage').attr('disabled',true);
				}
			}

			// console.log(oPackage);

			var $table = $("#idPackageItems"),
			$tBody = $table.find('tbody'),
			$modal = $("#idEHRCustomPackagePanel"),
			$name = $("#idName"),
			$packageID = $("#idCustomizedPackageID");

			$tBody.empty();
			$name.val(oPackage.sName);
			$("#idAmount").val(oPackage.iAmount).change();
			$("#idGrossAmount").val(oPackage.iAmount);
			$("#idPackageDiscount").val(0);
			$("#idCustomPackageFrom").val(oPackage.sEffectiveFrom);
			$("#idCustomPackageTo").val(oPackage.sEffectiveTo);
			$("#idValidity").val(oPackage.iValidity);
			$packageID.val(oPackage.iPackageID);

			if(oPackage.iPackageID==0) {
				//! This is a new package creation, save it for all
				$('#idSavePackageForAll').prop("checked", "checked");
			}
			else {
				//! This is customization, don't save it for all
				$('#idSavePackageForAll').prop("checked", false);
			}

			$modal.find("#idEHRCustomPackagePanelHeader").text(oPackage.sName ? "Customize Health Package: "+oPackage.sName : "Create New Health Package");

			if(oPackage.aItems.length){
				$.each(oPackage.aItems, function(index, oPackageItem) {
					loadPackageItemToPanel(oPackageItem);
				});
			} else {
				$tBody.append('<tr class="text-center classNoPackageItemRow"><td class="text-center" colspan="7">No Procedure Attached to the Package</td></tr>');
			}

			$modal.modal("show");
			
			calculateDaysFromPackageDuration();
		}

		function loadPackageItemToPanel (oPackageItem) {
			var $tBody = $("#idPackageItems").find('tbody'),
			iServiceID = oPackageItem.iServiceID,
			iQty = oPackageItem.iQty,
			iItemRate = parseFloat(oPackageItem.iServiceRate),
			iItemFrequencyDays = oPackageItem.iItemFrequencyDays,
			iPackageID = oPackageItem.iPackageID,
			iServiceTypeID = oPackageItem.iServiceTypeID;
			++iPackageItemCounter;

			var removerBtn = "";
			if(iAllowAddingItems){
				if(iPackageID){
					removerBtn = "<a href='#' class='classPackageItemRemover btn btn-danger' data-package-id='"+iPackageID+"' data-package-item-id='"+iServiceID+"'><i class='icon-white icon-trash'></i></a>";
				} else {
					removerBtn = "<a href='#' class='classPackageItemRemover btn btn-danger' data-package-item-id='"+iServiceID+"'><i class='icon-white icon-trash'></i></a>";
				}
			}

			if(iPackageID){
				removerBtn += "<input type='hidden' name='package_service_id[]' class='classCustomizePackageServiceID' value='"+iServiceID+"'><input type='hidden' name='package_service_qty[]' class='classCustomizePackageServiceQty' value='"+iQty+"' id='idHPServiceQty_"+iPackageItemCounter+"' ><input type='hidden' name='package_service_item_rate[]' value='"+iItemRate+"' id='idHPServiceRate_"+iPackageItemCounter+"'><input type='hidden' name='package_service_frequency[]' value='"+iItemFrequencyDays+"'>";
			} else {
				removerBtn += "<input type='hidden' name='package_service_id[]' class='classCustomizePackageServiceID' value='"+iServiceID+"'><input type='hidden' name='package_service_qty[]' value='"+iQty+"'  class='classCustomizePackageServiceQty' id='idHPServiceQty_"+iPackageItemCounter+"' ><input type='hidden' name='package_service_item_rate[]'  value='"+iItemRate+"' id='idHPServiceRate_"+iPackageItemCounter+"' ><input type='hidden' name='package_service_frequency[]' value='"+iItemFrequencyDays+"'>";
			}

			$tBody.find('.classNoPackageItemRow').remove();

			var iIndex = $tBody.find('tr').length+1;

			var sItemFrequencyDays = "N/A";
			if(oPackageItem.iItemFrequencyDays > 0) {
				sItemFrequencyDays = oPackageItem.iItemFrequencyDays+" Days";
			}

			
			let iItemCount = "<input type='number' min='0' class='classInputTextS classPackageItemCount' id='idHPServiceCount_"+iPackageItemCounter+"' value='"+oPackageItem.iQty+"' data-item-rate='"+iItemRate+"' data-service-type-id='"+iServiceTypeID+"' />";

			$tBody.append([
				"<tr>",
				"<td>"+iIndex+"</td>",
				"<td>"+oPackageItem.sServiceTypeName+"</td>",
				"<td>"+oPackageItem.sServiceName+"</td>",
				"<td>GHS "+oPackageItem.iServiceRate+"</td>",
				"<td>"+iItemCount+"</td>",
				"<td>GHS "+oPackageItem.iItemRate+"</td>",
				"<td>"+sItemFrequencyDays+"</td>",
				"<td>"+removerBtn+"</td>",
				"</tr>"
				].join(""));
		}

		function Package (oPackage) {
			this.iPackageID = oPackage && oPackage.iPackageID ? oPackage.iPackageID : "";
			this.sName = oPackage && oPackage.sName ? oPackage.sName : "";
			this.iAmount = oPackage && oPackage.iAmount ? oPackage.iAmount : 0;

			this.sEffectiveFrom = oPackage && oPackage.sEffectiveFrom ? oPackage.sEffectiveFrom: "";
			this.sEffectiveTo = oPackage && oPackage.sEffectiveTo ? oPackage.sEffectiveTo: "";
			this.iValidity = oPackage && oPackage.iValidity ? oPackage.iValidity: 0;

			this.aItems = oPackage && oPackage.aItems != undefined ? oPackage.aItems : [];
		}

		function PackageItem (oPackageItem) {
			this.iItemTypeID = oPackageItem.iItemTypeID ? oPackageItem.iItemTypeID : 1;
			this.iServiceTypeID = oPackageItem.iServiceTypeID ? oPackageItem.iServiceTypeID: 0;
			this.sServiceTypeName = oPackageItem.sServiceTypeName ? oPackageItem.sServiceTypeName : "";
			this.iServiceID = oPackageItem.iServiceID ? oPackageItem.iServiceID: 0;
			this.sServiceName = oPackageItem.sServiceName ? oPackageItem.sServiceName: "";
			this.iQty = oPackageItem.iQty ? oPackageItem.iQty: 0;
			this.iServiceRate = oPackageItem.iServiceRate ? oPackageItem.iServiceRate: 0;
			this.iItemRate = oPackageItem.iItemRate ? oPackageItem.iItemRate: 0;
			this.iItemFrequencyDays = oPackageItem.iItemFrequencyDays ? oPackageItem.iItemFrequencyDays: 0;
		}

		$("#idCustomPackageForm").on('submit', function(event) {
			event.preventDefault();

			var sName = $("#idName").val(),
			iPackageAmount = $("#idAmount").val(),
			sEffectiveFrom = $("#idCustomPackageFrom").val(),
			sEffectiveTo = $("#idCustomPackageTo").val(),
			iValidity = $("#idValidity").val(),
			iPatientID = $("#idCustomPackagePatientID").val();

			if(sName == ""){
				alert("Please Enter Package Name");
				return false;
			} else if(iPackageAmount === ""){
				alert("Please Enter Package Amount");
				return false;
			} else if(isNaN(iPackageAmount)){
				alert("Package Amount Should be numeric");
				return false;
			} else if(iValidity == ""){
				alert("Please Enter Validity Period");
				return false;
			}

			if(!bCheckValueIsNonEmpty(sEffectiveFrom)){
				alert("Please Select Effective From Date");
				return false;
			}

			if(!bCheckValueIsNonEmpty(sEffectiveTo)){
				alert("Please Select Effective To Date");
				return false;
			}

			
			if(iPatientID != "" && iPatientID != 0 ) {
				var sStartFrom = $('#idCustomPackageStartDate').val();
				if(sStartFrom=="") {
					alert("Please Enter Package Start Date for Patient");
					return false;
				}

				if(!confirm("Are you sure want to customize and activate Health Package?")){
					return false;
				}
			}

			//! Check if any service is added
			//! 
			if($('.classCustomizePackageServiceID').length == 0) {
				alert("Please select at least one Procedure");
				return false;
			}

			var aFormData = $(this).serialize();
			$.ajax({
                url: 'ajaxHealthPackages.php?sFlag=AddUpdateHealthPackage',
                type: 'POST',
                data: aFormData,
                success: function(data)
                {
                	if(data != false) {
                		alert("Package was added.");
                		location.reload();
                	}
                	else {
                		alert("Some error creating this package.");
                	}
                }
            });

		});

		$("#idSavePAckageFormBtn").on('click', function(event) {
			$("#idCustomPackageForm").submit();
		});

		$(".classPackageActivation").on('click', function(event) {
			event.preventDefault();

			var iPackageID = $(this).data('package-id');
			var iCurrentStatus = $(this).data('status');

			var iNewStatus = iCurrentStatus == 1 ? 0 : 1;
			var sActionType = iNewStatus == 1 ? "unfreeze" : "freeze";

			if(confirm("Are you sure want to "+sActionType+" package?")){
				$.ajax({
					url: 'ajaxCph.php',
					type: 'POST',
					data: {
						sFlag: 'freezeUnfreezePackage',
						iPackageID: iPackageID,
						iNewStatus: iNewStatus
					}
				})
				.done(function(iResult) {
					if(iResult){
						if(iNewStatus){
							alert("Package unfreezed successfully.");
						} else {
							alert("Package freezed successfully.");
						}
					} else {
						if(iNewStatus){
							alert("There was error while unfreezing package.");
						} else {
							alert("There was error while freezing package.");
						}
					}

					window.location.reload();
				});
			}


		});

		$(document).on('click', '.classPackageItemRemover', function(event) {
			event.preventDefault();

			if(confirm("Are you sure want to delete this service?")){
				$(this).closest('tr').remove();
			}

			var $tbody = $("#idPackageItems").find('tbody');

			if($tbody.find('tr').length == 0){
				$tbody.append('<tr class="text-center classNoPackageItemRow"><td class="text-center" colspan="5">No Procedure Attached to the Package</td></tr>');
			}
		});

		$('.classCalendarIcon').click(function(){ $(this).closest(".input-append").find("input").focus();})
	})()

	function customizeAndActivatePackage(iPackageID, iPatientID) {
		loadHealthPackageCustomizer(iPackageID);

		//! This is creating new package so reset existing package id
		$('#idCustomizedPackageID').val("");
		$('#idCustomPackageBasePackageID').val(iPackageID);
		$('#idCustomPackagePatientID').val(iPatientID);
		$('.classContainerActivatePanel').show();
	}
</script>

<script type="text/javascript">
	var iPackageCalculatedRate = 0;

	function getPackageCalculatedRate() {
		var aPackageServices = [];
		var aPackageServiceQty = [];

		$('.classCustomizePackageServiceID').each(function(){
			aPackageServices.push($(this).val());
		});

		$('.classCustomizePackageServiceQty').each(function(){
			aPackageServiceQty.push($(this).val());
		});

		$.ajax({
				url: 'ajaxHealthPackages.php?sFlag=getCalculatedPackageRateFromServices',
			data: {aPackageServices: aPackageServices, aPackageServiceQty: aPackageServiceQty},
			})
			.done(function(data) {
				var iCalculatedRate = data;

				$('#idPackageCalculatedCost').val(iCalculatedRate).change();
			});		
	}

	function copyCalculatedAmount() {
		var iCalculatedRate = $('#idPackageCalculatedCost').val();
		$('#idGrossAmount').val(iCalculatedRate);
		updatePackageAmountTotals();
	}

	$('#idGrossAmount').change(function(){
		updatePackageAmountTotals();
	});
	$('#idPackageDiscount').change(function(){
		updatePackageAmountTotals();
	});

	function updatePackageAmountTotals() {
		var iPackageGrossAmount = $('#idGrossAmount').val();
		var iPackageDiscount = $('#idPackageDiscount').val();

		var iPackageNetAmount = iPackageGrossAmount - iPackageDiscount;

		$('#idAmount').val(iPackageNetAmount).change();
	}

	// function to clear fields on closing modal
	function clearFields(){
		$('#idPackageCalculatedCost').val('');
		clearProducts();
	}

	// get inventory products
	$("#idCustomPackageProductId").select2({                
		width: '100%',
		allowClear: false,
		minimumInputLength: 3,
		width: 'resolve',
		placeholder:"Select Product",
		ajax: {
			url:"ajaxInventory.php?sFlag=GetProductInventoryList",
			data: function (params) {
				return {
					sProductName: params.term,
				};
			},
			processResults: function (data, params) {
				var results=[];
				data = $.parseJSON(data);
				$.each(data,function(key,value){
					var iProductId = value['product_id'];
					var sProductName = value['product_name'];
					results.push({
						id: iProductId,
						text: sProductName
				});
			});
			return { results: results };
			}
		}
	});

	$(document).on('click','#idAttachProductToPackage',function(){
		var iHPProductId = $('#idCustomPackageProductId').val();
		var sHPProductName = $('#idCustomPackageProductId').select2('data')[0].text;
		var iCount = $('#idCustomPackageProductQty').val();
		var iUsageAmount = $('#idCustomPackageProductRate').val();
		var aAddedProducts = [];

		iCount = parseInt(iCount);
		iUsageAmount = parseFloat(iUsageAmount);

		if(!(iCount>0)){
			alert('Please enter a proper quantity');
			 $('#idCustomPackageProductQty').val(0);
			return false;
		}

		if(!(iUsageAmount>=0)){
			iUsageAmount=0;
			alert('Please enter a proper usage amount');
			$('#idCustomPackageProductRate').val(0);
			return false;
		}

		$('.classRemoveHPProduct').each(function(key,value){
			var iProductId = $(value).attr('data-product-id');
			aAddedProducts.push(iProductId);
		});

		if(aAddedProducts.indexOf(iHPProductId)!=-1){
			alert('This product is already added');
			return false;
		}

		if(iHPProductId>0){
			$.ajax({
				url:"ajaxInventory.php?sFlag=getProductDetailsByID",
				data:{iProductID:iHPProductId,iGetOtherDetails:1},
				success:function(data){
					if(!data){
						alert('Error in getting product details');
						return false;
					}
					data = $.parseJSON(data);
					var iProductCost = (data.iProductCost == null)?'':data.iProductCost;
					loadHPProductDetails(iHPProductId,sHPProductName,iCount,iUsageAmount,iProductCost);
				}
			});
		}else{
			alert('Please select a valid product');
		}
	});

	// function to load product
	function loadHPProductDetails(iHPProductId,sHPProductName,iCount,iUsageAmount,iProductCost){
		++iPackageItemCounter;
		var iSrNo = $('#idHPProductsTBody').find('tr').length+1;

		var sActionBtn = "";
		if(iAllowAddingItems == 1){
			sActionBtn="<a class='btn btn-danger classRemoveHPProduct' data-product-id="+iHPProductId+"><i class='fa fa-times'></i></a>";
		}
		

		var sHiddenInput = "";
		sHiddenInput+= "<input type='hidden' class='classHiddenProductId' name='idHPProductId[]' value='"+iHPProductId+"'>";
		sHiddenInput+= "<input type='hidden' class='classHiddenProductQty' name='idHPProductQty[]' id='idHPProductQty_"+iPackageItemCounter+"' value='"+iCount+"'>";
		sHiddenInput+= "<input type='hidden' name='idHPProductRate[]' value='"+iUsageAmount+"'>";
		sHiddenInput+= "<input type='hidden' name='idHPProductFrequency[]' value='0'>";

		sActionBtn = sActionBtn+sHiddenInput;

		let sProductCount = "<input type='number' min='0' class='classHPProductCount classInputTextS' id='idHPProductCount_"+iPackageItemCounter+"' data-pacakge-id='"+iHPProductId+"' value='"+iCount+"'>";

		var sTemplate = "";
		sTemplate+="<tr>";
		sTemplate+="<td>"+iSrNo+"</td>";
		sTemplate+="<td>"+sHPProductName+"</td>";
		sTemplate+="<td>"+iProductCost+"</td>";
		sTemplate+="<td>"+sProductCount+"</td>";
		sTemplate+="<td>"+iUsageAmount+"</td>";
		sTemplate+="<td>"+sActionBtn+"</td>";
		sTemplate+="</tr>";

		$('#idHPProductsTBody').append(sTemplate);
		$('#idCustomPackageProductId').html( $('<option></option>').val('').text('Select Product') );
		$('#idCustomPackageProductQty').val('');
		$('#idCustomPackageProductRate').val('');
		calculateProductRate(iHPProductId,iCount,1);
	}

	// to remove HP product
	$(document).on('click','.classRemoveHPProduct',function(){
		if(confirm("Are you sure to delete?")){
			$(this).parent().parent().remove();
			var iProductId = $(this).attr('data-product-id');
			var iQty = $(this).next().next().val();
			calculateProductRate(iProductId,iQty,-1);
		}
	});

	// function to rmeove products from the listing
	function clearProducts(){
		$('#idHPProductsTBody').html('');
		$('#idCustomPackageProductId').html( $('<option></option>').val('').text('Select Product') );
		$('#idCustomPackageProductQty').val('');
		$('#idCustomPackageProductRate').val('');
	}

	// function to add product rate in the total package cost
	function calculateProductRate(iHPProductId,iQty,iOperation=1){
		// console.log('inside calculateProductRate');
		$.ajax({
			url:"ajaxInventory.php?sFlag=getProductDetailsByID",
			data:{iGetOtherDetails:1,iProductID:iHPProductId},
			success : function(data){
				if(!data){
					return false;
				}
				data = $.parseJSON(data);
				var iProductNormalRate = parseFloat(data.iProductCost);
				var iPackageCalculatedCost = $('#idPackageCalculatedCost').val();
				iPackageCalculatedCost = parseFloat(iPackageCalculatedCost);
				
				if(iProductNormalRate > 0){
					iPackageCalculatedCost+=(iProductNormalRate*iQty*iOperation);
					$('#idPackageCalculatedCost').val(iPackageCalculatedCost);
				}
			}
		});
	}

	//Get days on change of package duration dates	
	$(document).on('change', '.classPackageDates', function(){
		calculateDaysFromPackageDuration();
	});

	//Get days on change of package duration dates
	function calculateDaysFromPackageDuration(){

		var dPackageFromDate = $('#idCustomPackageFrom').val();
		var dPackageToDate = $('#idCustomPackageTo').val();

		if( dPackageFromDate && dPackageToDate ){
			var dFrom = dPackageFromDate.split("-");
			var dTo = dPackageToDate.split("-");
			
			dPackageFromDate = new Date(dFrom[2], dFrom[1] - 1, dFrom[0]);
			dPackageToDate = new Date(dTo[2], dTo[1] - 1, dTo[0]);

			var dDiff = new Date(dPackageToDate - dPackageFromDate);
			// get days
			var dDays = dDiff/1000/60/60/24;

			if(dDays < 0){
				alert("Effective Till date can not be earlier than Effective From date.");
				$('#idCustomPackageFrom').val('');
				$('#idCustomPackageTo').val('');
				$('#idValidity').val('');
			}else{
				var dDays = (parseInt(Math.abs(dDays)) + 1); 
				$('#idValidity').val(dDays);	
			}
		}
	}	

	//close pop-up
	$(document).on('click', '.classCloseEHRCustomPackagePanel', function(){
		$('#idEHRCustomPackagePanel').modal('hide');
	});

	$(document).on('change','.classPackageItemCount',function(){
		let iItemCount = $(this).val();
		let iId = $(this).attr('id').split('_')[1];
		let iServiceTypeId = $(this).attr('data-service-type-id');
		iItemCount = parseInt(iItemCount);

		if( isNaN(iItemCount) || iItemCount < 0){
			alert('Please enter a valid quantity');
			iItemCount = 1;
		}

		// check for botox/filler validation
		if(iBotoxFillerVaildation == 1){
			iServiceTypeId = parseInt(iServiceTypeId);
			for(let iii=0; iii < aBotoxModalities.length; ++iii){
				if(iServiceTypeId == aBotoxModalities[iii].iServiceTypeId){
					alert('Count must be 1 for '+aBotoxModalities[iii].sServiceTypeName);
					iItemCount = 1;
					break;
				}
			}
		}

		$(this).val(iItemCount);
		$('#idHPServiceQty_'+iId).val(iItemCount);
		getPackageCalculatedRate();
	});

	$(document).on('change','.classHPProductCount',function(){
		let iItemCount = $(this).val();
		let iHPProductId = $(this).attr('data-pacakge-id');
		iItemCount = parseInt(iItemCount);

		if( isNaN(iItemCount) || iItemCount < 0){
			alert('Please enter a valid quantity');
			iItemCount = 1
		}
		$(this).val(iItemCount);
		let iId = $(this).attr('id').split('_')[1];
		$('#idHPProductQty_'+iId).val(iItemCount);
		calculateProductRate(iHPProductId,iItemCount,1);
	});

	$(document).on('change','#idEHPPaymentMode',function(){
	    let iPaymentMode = $(this).val();

	    if(iPaymentMode == 2 || iPaymentMode == 3){
	        $('#idEHPCardPaymentDIV').css('display','');
	    }else{
	        $('#idEHPCardPaymentDIV').css('display','none');                
	    }
	});

	$(document).on('keyup','#idEHPPaymentAmount',function(){
	    let fPaidAmount = $('#idEHPPaymentAmount').val();
	    let fPackageAmount = $('#idAmount').val();
	    $('#idSavePAckageFormBtn').prop('disabled',true);

	    if(fPaidAmount != '' && fPackageAmount !=''){
	        if (isNaN(fPaidAmount) || fPaidAmount < 0) {
	            alert('Please enter a valid value');
	            $(this).focus();
	            $(this).val(0);
	        }
	        fPaidAmount = parseFloat(fPaidAmount);
	        fPackageAmount = parseFloat(fPackageAmount);

	        if(fPackageAmount == 0){
                $('#idSavePAckageFormBtn').prop('disabled',false);
                return false;
	        }

	        if(fPaidAmount > fPackageAmount){
	            alert('Cannot pay more than Package amount');
	            $(this).val(fPackageAmount);
	            $('#idSavePAckageFormBtn').prop('disabled',false);
	            return false;
	        }
	        if(bValidateValue(fPaidAmount) && bValidateValue(fPackageAmount)){
	            let fPaidAmountPercentage = (fPaidAmount/fPackageAmount)*100;
	            if(fPaidAmountPercentage >= fMinPaymentRequiredBeforeActivation){
	                $('#idSavePAckageFormBtn').prop('disabled',false);
	            }
	        }                
	    }            
	});

	$(document).on('change','#idAmount',function(){
		$('#idEHPPaymentAmount').trigger('keyup');
	});
	
</script>

<style>

</style><script type="text/javascript">
	var iUserTypeId    = '11';
	var iUserID    	   = '411';
	var isUserPermissionForNotifiactionIcon = '1';
	if(isUserPermissionForNotifiactionIcon==1){
		getReceivedMessagesForDoctor(iUserID, function(iMessageCount) {
			if(iMessageCount>0){
				$('.classShowReceivedMessageDiv').show();
				$('#idShowReceivedMessageDiv').html(iMessageCount);
			}
	  });
	}
	if(isUserPermissionForNotifiactionIcon==1){
		setInterval(function(){ 
			getReceivedMessagesForDoctor(iUserID, function(iMessageCount) {
			if(iMessageCount>0){
				$('.classShowReceivedMessageDiv').show();
				$('#idShowReceivedMessageDiv').html(iMessageCount);
			}else if(iMessageCount==null){
				$('.classShowReceivedMessageDiv').hide();
			}

			});
		}, 60000);
	}
  	//! For gets room details by room idd...
    function getReceivedMessagesForDoctor(iUserID,callback){
        var iReceivedMessageCount = null;
        var sDefaultMessageFlag=1;
        $.ajax({
            type: 'GET',
            url: 'ajaxEhr.php?sFlag=getReceivedMessagesCountForDoctor',
            data:{iUserID:iUserID,sDefaultMessageFlag:sDefaultMessageFlag},
            success: function(data) {
                if(data != false) {
                    data = $.parseJSON(data);
                    iReceivedMessageCount = data;
                    callback(iReceivedMessageCount);
                }
            }
        });
    }
	//Get current date
	function getCurrentDate(sFormate, sOption=''){
		var dTodayDate = new Date();

		if(sOption == "last_month"){			
			var dLastMonthDate = new Date(dTodayDate.setMonth(dTodayDate.getMonth() - 1));
			dTodayDate = dLastMonthDate;
		}else if(sOption == "last_3rd_month"){			
			var dLast3rdMonthDate = new Date(dTodayDate.setMonth(dTodayDate.getMonth() - 3));
			dTodayDate = dLast3rdMonthDate;
		}else if(sOption == "year_after_current_date"){			
			var dYearAfterTemp = new Date(dTodayDate.setMonth(dTodayDate.getMonth() + 12 ));
			var dYearAfterCurrentDate = new Date(dYearAfterTemp.setDate((dYearAfterTemp.getDate() - 1)));
			dTodayDate = dYearAfterCurrentDate;
		}

		var dTodayDay = dTodayDate.getDate();
		if(dTodayDay < 10){
            dTodayDay = "0"+dTodayDay;
        }

		var dTodayMonth = dTodayDate.getMonth() + 1;
		if(dTodayMonth < 10){
            dTodayMonth = "0"+dTodayMonth;
        }

		var dTodayYear = dTodayDate.getFullYear();
		var dTodayHour = dTodayDate.getHours();
		var dTodayMinute = dTodayDate.getMinutes();
		var dTodaySeconds = dTodayDate.getSeconds();

		var dCurrentDate = '';		

		if(sFormate == "dd-mm-yy"){
			var dCurrentDate = dTodayDay +"-"+ dTodayMonth +"-"+ dTodayYear;
		}else if(sFormate == "yy-mm-dd"){
			var dCurrentDate = dTodayYear +"-"+ dTodayMonth +"-"+ dTodayDay;
		}else if(sFormate == "dd/mm/yy"){
			var dCurrentDate = dTodayDay +"/"+ dTodayMonth +"/"+ dTodayYear;
		}else if(sFormate == "yy/mm/dd"){
			var dCurrentDate = dTodayYear +"/"+ dTodayMonth +"/"+ dTodayDay;
		}else if(sFormate == "h:i:s"){
			var dCurrentDate = dTodayHour +":"+ dTodayMinute +":"+ dTodaySeconds;
		}else if(sFormate == "h:00"){
			var dCurrentDate = dTodayHour +":00";
		}		
		return dCurrentDate;
	}	
</script>

<!-- Health Packages Pop-ups start-->
<!-- Add Follow-up Modal-->
<style type="text/css">
	.bigdropbigdropFooter {
	    width: 342px !important;
	    font-size: 12px;
	}
	#idAddFollowupModalFooterB3 .select2-container {
	    width: 100% !important;
	}
	#select2-idAddFollowupModalFooter-container {
	    width: 251px !important;
	}
	#idAddFollowupModalFooter .classTextalignLT{
		text-align: left;
	}
</style>
<div class="modal fade hide" id="idAddFollowupModalFooter"  role="dialog"  aria-hidden="true">
	
	<div class="modal-dialog modal-xs">
		<div class="modal-content modal-xs">
			<div class="modal-header">
				<h3 class="modal-title">Add Follow-up<span style="color:#526998;font-size: 10px;">&nbsp;(during call)</span></h3>
			</div>	
			<input type="text" class="hidden" id="idFollowupMappedToEntityIDFooter">
			<input type="text" class="hidden" id="idFollowupMappedToEntityTypeIDFooter">
			<div class="modal-body modal-xs" style="padding: 0px 15px 15px 20px;">
				<div class="row-fluid classTaskFunctionalityRow">
					<div class="span12">
						<div class="span4">
							<label>Follow-up Status<span class="text-danger">*</span></label>
						</div>	
						<div class="span8 classTextalignLT">
							<select class="form-control classFollowupStatusFooter" id="idFollowupStatusFooter">
								<option value="0">Select</option>
							</select>
						</div>					
					</div>					
				</div>						
				<div class="row-fluid classTaskFunctionalityRow">
					<div class="span12">
						<div class="span4">
							<label>Start Date<span class="text-danger">*</span></label>
						</div>	
						<div class="span4 classTextalignLT">
							<input type="text" class="classInputTextS form-control " id="idAddFollowupStartDateFooter" readonly/>
						</div>													
					</div>					
				</div>
				<div class="row-fluid classTaskFunctionalityRow">
					<div class="span12">
						<div class="span4">
							<label>Note</label>
						</div>	
						<div class="span8 classTextalignLT">
							<textarea type="text" class="classInputTextS form-control" id="idAddFollowupDescriptionFooter"></textarea>
						</div>					
					</div>					
				</div>
				<div class="row-fluid classTaskFunctionalityRow">
					<div class="span12">
						<div class="span4">
							<label>Assign<span class="text-danger">*</span></label>
						</div>	
						<div class="span6 classTextalignLT">
							<select type="text" class="classInputTextS form-control classAssignToFooter" id="idAddFollowupAssignToFooter"></select>									
						</div>			
					</div>					
				</div>		
				<div class="row-fluid classTaskFunctionalityRow">
					<div class="span12">
						<div class="span4">
							<label>Complete<span class="text-danger">*</span></label>
						</div>	
						<div class="span6 classTextalignLT">
							<input type="checkbox" id="idaddFollowupStausCompleteFooter" checked>
						</div>			
					</div>					
				</div>			
			</div>
			<div class="modal-footer">
				<div class="col-md-12">
					<a class="btn btn-success" id="idSaveFollowupFromModalFooter" onclick="fAddFollowupFromFooter()"><i class="fa fa-floppy-o" aria-hidden="true"></i>&nbsp;&nbsp; Save Follow-up</a>
					<a class="btn  btn-danger" onclick="fCloseFollowupFromModalFooter()"><i class="fa fa-times" aria-hidden="true"></i>&nbsp;&nbsp;Close</a>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- Add Follow-up Modal ends-->

<script type="text/javascript">
	//Data array for followup statuses 
	var aFollowupStatusFooter = [
				    {
				        id: 1,
				        text: 'Interseted - Fixed appointment'
				    },
				    {
				        id: 2,
				        text: 'Interseted - But not right now'
				    },
				    {
				        id: 3,
				        text: 'Asked to call later'
				    },
				    {
				        id: 4,
				        text: 'Said will call back later'
				    },
				    {
				        id: 5,
				        text: 'Already booked the appoinment'
				    },
				    {
				        id: 6,
				        text: 'Not Interseted'
				    },
				    {
				        id: 7,
				        text: 'Will visit the clinic but time not fixed'
				    },
				    {
				        id: 8,
				        text: 'Asked to not call ever'
				    },
				    {
				        id: 9,
				        text: 'Number does not exist'
				    },
				    {
				        id: 10,
				        text: 'Number busy/switched off'
				    },
				    {
				        id: 11,
				        text: 'Reminder set'
				    },
				    {
				        id: 12,
				        text: 'Client satisfaction level : Highly Satisfied'
				    },
				    {
				        id: 13,
				        text: 'Client satisfaction level : It was Alright'
				    },
				    {
				        id: 14,
				        text: 'Client satisfaction level : Highly Dissatisfied'
				    },
				    {
				        id: 15,
				        text: 'Hospitality Rating : It was Great'
				    },
				    {
				        id: 16,
				        text: 'Hospitality Rating : It was Alright'
				    },
				    {
				        id: 17,
				        text: 'Hospitality Rating : Very Poor.Need to improve'
				    },
				    {
				        id: 18,
				        text: 'Doctor Rating : Excellent Doctor'
				    },
				    {
				        id: 19,
				        text: 'Doctor Rating : It was Alright'
				    },
				    {
				        id: 20,
				        text: 'Doctor Rating : Not Happy with the Doctor'
				    }
				];

	$(document).ready(function(){
		// $(".classFollowupStatusFooter").select2({
		// 	data: aFollowupStatusFooter,
		// 	dropdownCssClass : 'bigdropFooter'
		// });	

		$('#idAddFollowupStartDateFooter').datepicker({
			 dateFormat: 'dd-mm-yy',
		}).val(getCurrentDate('dd-mm-yy'));		

		$('.classAssignToFooter').select2();//init
		$(".classFollowupStatusFooter").select2();//init
		$("#idFollowupStatusFooter").select2();//init

	});

	//Open modal
	function fOpenFollowupFromModalFooterB3(iAssignedId,sAssignedTo,iFollowupMappedToEntityID,iFollowupMappedToEntityTypeID){
		clearFieldsAddFollowupModalFooter();
		fAppendSelect2ToAssignToFooter(iAssignedId,sAssignedTo);
		$('#idAddFollowupModalFooter').modal('show');

		$(".classFollowupStatusFooter").select2({
			data: aFollowupStatusFooter,
			// dropdownCssClass : 'bigdropFooter'
		});

		$('#idFollowupMappedToEntityIDFooter').val(iFollowupMappedToEntityID);
		$('#idFollowupMappedToEntityTypeIDFooter').val(iFollowupMappedToEntityTypeID);	
	}

	//close modal
	function fCloseFollowupFromModalFooter(){
		// clearFieldsAddFollowupModalFooter();
		$('#idAddFollowupModalFooter').modal('hide');
	}

	//clear fields of add followup modal
	function clearFieldsAddFollowupModalFooter(){
		$("#idFollowupStatusFooter").select2("val", "0");
		$("#idAddFollowupDescriptionFooter").val('');
	}

	//Append select2 to Assign to field
	function fAppendSelect2ToAssignToFooter(iAssignedId,sAssignedTo){
		$('.classAssignToFooter').select2('destroy');
		// Assign to filter filter
	    $('.classAssignToFooter').select2({
	    	width: '100%',
	    	allowClear: true,
	    	minimumInputLength: 3,
	    	width: 'resolve',
	    	placeholder: {
	    	   id: "",
	    	   placeholder: "Search by user name"
	    	},
	    	ajax: {
	    	    url:"ajaxEhr.php?sFlag=SearchStaff",
	    	    data: function (params) {
	    	        return {
	    	            sStaffName: params.term,
	    	        };
	    	    },
	    	    processResults: function (data,params) {
	    	        var results=[];
	    	        for(var iii=0; iii < data.length; ++iii){
	    	        	value = data[iii];
	    	        	var istaffIdFooter = value['staff_id'];
	    	        	var sStaffNameFooter = value['staff_name'];
	    		        results.push({
	    		            id: istaffIdFooter,
	    		            text: sStaffNameFooter
	    		        });
	    	        }
	    	        return { results: results };
	    	    }
	    	}
	    });

	    $("#idAddFollowupAssignToFooter").append("<option value='"+iAssignedId+"'>"+sAssignedTo+"</option>");
	}

	//add Followup
	function fAddFollowupFromFooter(){	

		if($("#idFollowupStatusFooter").val() == 0){
			alert("Please! Select follow-up status.")
			return false;
		}else if(!$("#idAddFollowupStartDateFooter").val()){
			alert("Please! Select follow-up date.")
			return false;
		}else if(!$("#idAddFollowupAssignToFooter").val()){
			alert("Please! Select follow-up assign to.")
			return false;
		}else if(!($('#idaddFollowupStausCompleteFooter').is(":checked"))){
			alert("Please! mark follow-up as Complete.")
			return false;
		}else if(!($('#idFollowupMappedToEntityIDFooter').val())){
			console.log("Error: follow-up can not be added patient details not available")
			return false;
		}
		
		$.ajax({
            url:"ajaxFollowupList.php?sFlag=addFollowup",
            data:{
            	iAddFollowupStatus: $("#idFollowupStatusFooter").val(),
				dAddFollowupStartDate: $("#idAddFollowupStartDateFooter").val(),
				sAddFollowupDescription: $("#idAddFollowupDescriptionFooter").val(),
				iAddFollowupAssignTo: $("#idAddFollowupAssignToFooter").val(),
				iaddFollowupStausComplete: $('#idaddFollowupStausCompleteFooter').is(":checked"),
				iFollowupMappedToEntityID: $('#idFollowupMappedToEntityIDFooter').val(),
				iFollowupMappedToEntityTypeID: $('#idFollowupMappedToEntityTypeIDFooter').val(),
            },
            success : function (data){
                if(data){ 
					fCloseFollowupFromModalFooter();
                	alert("Follow-up added successfully.");  
                }else{
                	alert("Some error occur.");
                }                               
            }
        });
	}
</script>
<script type="text/javascript">
	function setJqueryCookie(key, value) {
        // var dExpires = new Date();
        // dExpires.setTime(dExpires.getTime() + (1 * 24 * 60 * 60 * 1000));
        // document.cookie = key + '=' + value + ';expires=' + dExpires.toUTCString();
        document.cookie = key + '=' + value + ';expires=';
    }

    function getJqueryCookie(key) {
        var keyValue = document.cookie.match('(^|;) ?' + key + '=([^;]*)(;|$)');
        return keyValue ? keyValue[2] : null;
    }

    $(window).load(function() {
        var sHrefPathname = window.location.pathname;
        var aHrefPageName = sHrefPathname.split('/');
        var aHrefPageNameLength = aHrefPageName.length;
        var sHrefPageName = aHrefPageName[aHrefPageNameLength - 1];
        if(sHrefPageName == 'appointmentCalendar.php'){
            setJqueryCookie('NAPPMNT_CLNDR_SCROLL_POSN_reload', 'Yes');
        }else{
            setJqueryCookie('NAPPMNT_CLNDR_SCROLL_POSN_reload', 'No');
       		setJqueryCookie('NAPPMNT_CLNDR_SCROLL_POSN', 0);
        }
    });
    
    $("#idFooterNotifier").click(function () {
  		var url = "viewMessageHistory.php?iType=2&iStatus=1&sAddedFor=1,2,4,5";
  		window.open(url, '_blank');
	}); 
</script>
		<script type="text/javascript">
			sessionStorage.setItem('sessToken', 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE3NjI2Njc3MTcsImp0aSI6IjVPRTN0ekZPMnhpemdDMWdKanlWRGQiLCJleHAiOjE3NjI2ODU3Mjd9._M7QrNkQc3zYw1tyjAV1GBCPtIUnscd8WD1hqtik1XI');
			function getAjaxAuthHeaders() {
				return {"Authorization": "Bearer "+sessionStorage.getItem('sessToken')}
			}
		</script>
		        	</div>
		</div>
		<script>
			/*$('#idTableView').DataTable({
                "aLengthMenu": [[20, 50, 100, 200, -1], [20, 50, 100, 200, "All"]],
                "bLengthChange": false,
                "bFilter":false,
                "bSort":false,
                 "bInfo" : false
            });*/

            $(document).ready(function() {
              $(".classBabyRegisterForm").click(function() {
                var iPatientID = $(this).attr('data-patient-id');
                fGetPatientFinalPregnancyDetails(iPatientID);
               });
            });


            function fGetPatientFinalPregnancyDetails(iPatientID)
            {
               var curEle = $(`#idPregnancies_${iPatientID}`).selector;
                $.ajax({
                    url: "ajaxIPDManager.php?sFlag=getPatientFinalPregnancyDetails",
                    data: {iPatientID:iPatientID},
                    success: function (data){
                        if($.trim(data) != false) {
                            var sTemplate = '';
                            var iSrNo = 1;
                            var data = $.parseJSON(data);

                            console.log(data);

                            for (var iii=0;iii<data.length;iii++) {
                                if(data[iii]['expected_due_date'] == ''){
                                    data[iii]['expected_due_date'] = 'N/A';
                                }
                                if(data[iii]['last_menstrual_date'] == ''){
                                    data[iii]['last_menstrual_date'] = 'N/A';
                                }
                                if(data[iii]['pregnancy_status_name'] == ''){
                                    data[iii]['pregnancy_status_name'] = 'N/A';
                                }
                                if(data[iii]['final_delivery_date'] == ''){
                                    data[iii]['final_delivery_date'] = 'N/A';
                                }

                                var iNewBornPatientID = data[iii]['new_born_patient_id'];
                                if(iNewBornPatientID!=null && iNewBornPatientID > 0){

                                sTemplate += '<tr>';
                                    sTemplate += '<td>'+iSrNo+'</td>';
                                    sTemplate += '<td>'+data[iii]['expected_due_date']+'</td>';
                                    sTemplate += '<td>'+data[iii]['last_menstrual_date']+'</td>';
                                    sTemplate += '<td>'+data[iii]['final_delivery_date']+'</td>';
                                    sTemplate += '<td>'+data[iii]['pregnancy_status_name']+'</td>';
                                    sTemplate += '<td>';
                                            sTemplate += ' <a href="babyPatientRegistration.php?iNewBornPatientID='+iNewBornPatientID+ '" class="btn btn-small btn-success classShowNewBornHelper" id="idShowNewBornHelper_'+data[iii]['pregnancy_id']+'" name="idShowNewBornHelper_'+data[iii]['pregnancy_id']+'" data-pregnancy-id="'+data[iii]['pregnancy_id']+'" target="_blank">Baby Registration Form</a>';

                                    sTemplate += '</td>';
                                sTemplate += '</tr>';
                                iSrNo++;
                            }
                            }
                            $('.classPregnancyHistoryTableBody').html(sTemplate);
                        }else{
                            sTemplate = '<tr class="odd"><td valign="top" colspan="5">No Baby Found.</td></tr>';
                            $('.classPregnancyHistoryTableBody').html(sTemplate);
                            // $(curEle).hide();
                            // $(curEle).replaceWith( ('<div>No Baby Found.</div>') );
                        }
                    }
                });
            }

		</script>


<div id="idModalPregnancies" class="modal fade" style="width:40%;" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Baby Registration</h4>
                </div>
                <div class="modal-body">
                    <div id='idPregnancyHistory'>
                        <table class='table table-condensed classTableView table-bordered' id='idPregnancyHistoryTable' style="table-layout:fixed;">
                            <thead>
                                <tr class='classTableHeader' id='idTableHeader'>
                                    <th width='10%'>Sr.No.</th>
                                    <th width='15%'>EDD</th>
                                    <th width='15%'>LMP</th>
                                    <th width='15%'>Final Date</th>
                                    <th width='15%'>Status</th>
                                    <th width='30%'>View</th>
                                </tr>
                            </thead>
                            <tbody class="classPregnancyHistoryTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal" aria-hidden="true">Close</button>
                </div>
            </div>
        </div>
    </div>


	</body>
</html>